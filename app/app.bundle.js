!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,a;const s=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(m(this),t,...n);return c.set(r,t.sort?t.sort():[t]),h(r)}:(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(m(this),t),h(s.get(this))}:function(...t){return h(e.apply(m(this),t))}}function p(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});i.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function h(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(h(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=p(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const m=e=>l.get(e);function g(e,t,{blocked:n,upgrade:r,blocking:o}={}){const a=indexedDB.open(e,t),s=h(a);return r&&a.addEventListener("upgradeneeded",e=>{r(h(a.result),e.oldVersion,e.newVersion,h(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o&&s.then(e=>e.addEventListener("versionchange",o)),s}n.d(t,"a",function(){return g});const b=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],y=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return b.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),v.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&y.set(t,o),o}d=(e=>({get:(t,n,r)=>w(t,n)||e.get(t,n,r),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(d)},function(e,t,n){"use strict";n.r(t);var r=n(0);const o=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});class a{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get DATABASE_REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){fetch(a.DATABASE_URL).then(function(t){t.json().then(function(t){e(null,t)})})}static fetchReviews(e,t){let n=a.DATABASE_REVIEWS_URL+"/?restaurant_id="+e;fetch(n).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){a.fetchRestaurants((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return e.photograph?`/img/${e.photograph}.jpg`:`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:a.urlForRestaurant(e)});return n.addTo(newMap),n}static updateCachedRestaurantReview(e){return console.log("updating cache for new review",e),o.then(t=>{const n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return console.log("putting review in store"),r.put(e),console.log("successfully put review in store"),n.done})}static saveNewReview(e,t){const n=a.DATABASE_REVIEWS_URL;a.updateCachedRestaurantReview(e),a.addPendingRequestToQue(n,"POST",e).then(e=>{t(null,e)})}static addPendingRequestToQue(e,t,n){return new Promise((r,s)=>{o.then(r=>{r.transaction("pending","readwrite").objectStore("pending").put({data:{url:e,method:t,formData:n}})}).catch(e=>{console.log(e)}).then(a.nextPending((e,t)=>(console.log(t),r(t))))})}static nextPending(e){a.attemptCommitPending(a.nextPending).then(t=>{console.log(t),e(null,t)})}static attemptCommitPending(e){let t,n,r;return new Promise((a,s)=>{o.then(o=>{if(!o.objectStoreNames.length)return console.log("DB not available"),void o.close();o.transaction("pending","readwrite").objectStore("pending").openCursor().then(s=>{if(!s)return;s.value;if(t=s.value.data.url,n=s.value.data.method,r=s.value.data.formData,!t||!n||"POST"===n&&!r)return void s.delete().then(e());const i={body:JSON.stringify(r),method:n};fetch(t,i).then(e=>{if(e.ok||e.redirected)return e.json()}).then(t=>{o.transaction("pending","readwrite").objectStore("pending").openCursor().then(n=>{n.delete().then(()=>(e(),console.log(t),a(t)))}),console.log("deleted item from pending store")}).catch(e=>{console.log(e)})})})})}static syncRestaurant(e){try{let t=`http://localhost:1337/restaurants/${e.id}/?is_favorite=${e.is_favorite}`;return fetch(t,{method:"PUT"}).then(function(e){return e.json()})}catch(t){console.log("error updating restaurant backend data...",t,e)}}static updateRestaurantInDB(e){return o.then(function(t){let n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(e),n.complete}).then(function(){return Promise.resolve(e)})}static toggleFavBtn(e){return o.then(t=>{return t.transaction("restaurants").objectStore("restaurants").get(e)}).then(e=>{console.log(e);const t=Object.assign({},e);return t.is_favorite="true"===e.is_favorite||!0===e.is_favorite?"false":"true",a.syncRestaurant(t),a.updateRestaurantInDB(t)}).then(e=>{const t=document.getElementById(`fav-btn-${e.id}`);"true"===e.is_favorite||!0===e.is_favorite?(t.innerHTML="Favorited!",t.style.background="hotpink"):(t.innerHTML="Add to favorite",t.style.background="grey")})}}window.DBHelper=a},function(e,t,n){n(1),e.exports=n(3)},function(e,t){var n;document.addEventListener("DOMContentLoaded",e=>{i(),r(),a()});const r=()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,o())})},o=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");t.addEventListener("change",c),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},a=()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,s())})},s=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");t.addEventListener("change",c),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},i=()=>{n=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),self.newMap=n,L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoid2VudGluIiwiYSI6ImNqaXJ0N25iZjFwdjYza3A4MGt1aHU2bjEifQ.DnNFUoN5uzw01l_XK_c7nQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(n),c()},c=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,a,(e,t)=>{e?console.error(e):(u(t),l())})},u=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(e=>e.remove()),self.markers=[],self.restaurants=e},l=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{console.log(e),t.append(d(e))}),f()},d=e=>{const t=document.createElement("li"),n=document.createElement("img"),r=document.createElement("div");n.className="restaurant-img",n.setAttribute("alt",e.name),n.src=DBHelper.imageUrlForRestaurant(e),console.log(n.src),r.append(n),t.append(r);const o=document.createElement("h1");o.innerHTML=e.name,t.append(o);const a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);const s=document.createElement("p");s.innerHTML=e.address,t.append(s),console.log("is_favorite: ",e.is_favorite);const i=document.createElement("button");!e.is_favorite||e.is_favorite.toString();"true"===e.is_favorite||!0===e.is_favorite?(i.innerHTML="Favorited!",i.style.background="hotpink"):(i.innerHTML="Add to favorite",i.style.background="grey"),i.setAttribute("title",`toggle favorites for: ${e.name}`),i.setAttribute("id",`fav-btn-${e.id}`),i.setAttribute("data-restaurant-id",e.id),i.addEventListener("click",()=>{console.log("clicked favbtn"),DBHelper.toggleFavBtn(e.id)}),t.append(i);const c=document.createElement("button");return c.classList="button button--success",c.innerHTML="View Details",c.setAttribute("aria-label",e.name+e.neighborhood+e.address+"View Details"),c.onclick=(()=>{const t=DBHelper.urlForRestaurant(e);window.location=t}),t.append(c),t},f=(e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,n);t.on("click",function(){window.location.href=t.options.url}),self.markers.push(t)})}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vY2h1bmsuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vYXBwL3NyYy9kYmhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL21haW4uanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJpbnN0YW5jZU9mQW55IiwiY29uc3RydWN0b3JzIiwic29tZSIsImlkYlByb3h5YWJsZVR5cGVzIiwiY3Vyc29yQWR2YW5jZU1ldGhvZHMiLCJjdXJzb3JSZXF1ZXN0TWFwIiwiV2Vha01hcCIsInRyYW5zYWN0aW9uRG9uZU1hcCIsInRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCIsInRyYW5zZm9ybUNhY2hlIiwicmV2ZXJzZVRyYW5zZm9ybUNhY2hlIiwiaWRiUHJveHlUcmFwcyIsIltvYmplY3QgT2JqZWN0XSIsInRhcmdldCIsInByb3AiLCJyZWNlaXZlciIsIklEQlRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmVOYW1lcyIsInVuZGVmaW5lZCIsIm9iamVjdFN0b3JlIiwid3JhcCIsImhhcyIsIndyYXBGdW5jdGlvbiIsImZ1bmMiLCJJREJEYXRhYmFzZSIsInRyYW5zYWN0aW9uIiwic3RvcmVOYW1lcyIsImFyZ3MiLCJ0eCIsInVud3JhcCIsInRoaXMiLCJzZXQiLCJzb3J0IiwiSURCQ3Vyc29yIiwiYWR2YW5jZSIsImNvbnRpbnVlIiwiY29udGludWVQcmltYXJ5S2V5IiwiaW5jbHVkZXMiLCJhcHBseSIsInRyYW5zZm9ybUNhY2hhYmxlVmFsdWUiLCJkb25lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ1bmxpc3RlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjb21wbGV0ZSIsImVycm9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbiIsIklEQk9iamVjdFN0b3JlIiwiSURCSW5kZXgiLCJQcm94eSIsIklEQlJlcXVlc3QiLCJyZXF1ZXN0IiwicHJvbWlzZSIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJ0aGVuIiwicHJvbWlzaWZ5UmVxdWVzdCIsIm5ld1ZhbHVlIiwib3BlbkRCIiwidmVyc2lvbiIsImJsb2NrZWQiLCJ1cGdyYWRlIiwiYmxvY2tpbmciLCJpbmRleGVkREIiLCJvcGVuIiwib3BlblByb21pc2UiLCJldmVudCIsIm9sZFZlcnNpb24iLCJuZXdWZXJzaW9uIiwiZGIiLCJfX3dlYnBhY2tfZXhwb3J0c19fIiwicmVhZE1ldGhvZHMiLCJ3cml0ZU1ldGhvZHMiLCJjYWNoZWRNZXRob2RzIiwiTWFwIiwiZ2V0TWV0aG9kIiwidGFyZ2V0RnVuY05hbWUiLCJyZXBsYWNlIiwidXNlSW5kZXgiLCJtZXRob2QiLCJzdG9yZU5hbWUiLCJzdG9yZSIsImluZGV4Iiwic2hpZnQiLCJvbGRUcmFwcyIsImNhbGxiYWNrIiwiaWRiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18iLCJkYlByb21pc2UiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImF1dG9JbmNyZW1lbnQiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIkRBVEFCQVNFX1JFVklFV1NfVVJMIiwiZmV0Y2giLCJyZXNwb25zZSIsImpzb24iLCJyZXN0YXVyYW50cyIsInJlc3RhdXJhbnRfaWQiLCJmZXRjaFVSTCIsInJldmlld3MiLCJjYXRjaCIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJuZXdNYXAiLCJmb3JtRGF0YSIsImNvbnNvbGUiLCJsb2ciLCJwdXQiLCJ1cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3IiwiYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSIsImRhdGEiLCJuZXh0UGVuZGluZyIsImF0dGVtcHRDb21taXRQZW5kaW5nIiwiaiIsImJvZHkiLCJsZW5ndGgiLCJjbG9zZSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJkZWxldGUiLCJwcm9wZXJ0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwicmVkaXJlY3RlZCIsImlzX2Zhdm9yaXRlIiwiZSIsIm5ld19yZXN0YXVyYW50IiwiYXNzaWduIiwic3luY1Jlc3RhdXJhbnQiLCJ1cGRhdGVSZXN0YXVyYW50SW5EQiIsImZhdkJ0biIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJzdHlsZSIsImJhY2tncm91bmQiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImZvckVhY2giLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImNlbnRlciIsInpvb20iLCJzY3JvbGxXaGVlbFpvb20iLCJ0aWxlTGF5ZXIiLCJtYXBib3hUb2tlbiIsIm1heFpvb20iLCJhdHRyaWJ1dGlvbiIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibWFya2VycyIsInJlbW92ZSIsInVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlIiwiZGl2IiwiY2xhc3NOYW1lIiwic2V0QXR0cmlidXRlIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWRkcmVzcyIsInRvU3RyaW5nIiwidG9nZ2xlRmF2QnRuIiwibW9yZSIsImNsYXNzTGlzdCIsIm9uY2xpY2siLCJsb2NhdGlvbiIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJvbiIsImhyZWYiLCJvcHRpb25zIiwicHVzaCJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9B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QVVwQyxPQVRBaUMsRUFBS0MsVUFBWSx5QkFDakJELEVBQUs5QyxVQUFZLGVBQ2pCOEMsRUFBS04sYUFBYSxhQUFjaEcsRUFBV3JJLEtBQU9xSSxFQUFXTSxhQUFlTixFQUFXbUcsUUFBVSxnQkFDakdHLEVBQUtFLFFBQVUsTUFDYixNQUFNbEYsRUFBTW5DLFNBQVNvQyxpQkFBaUJ2QixHQUN0QzJELE9BQU84QyxTQUFXbkYsSUFFcEJzRSxFQUFHdEIsT0FBT2dDLEdBRUhWLEdBTUhELEVBQWtCLENBQUNsRyxFQUFjc0UsS0FBS3RFLGVBQzFDQSxFQUFZMEUsUUFBUW5FLElBRWxCLE1BQU1lLEVBQVM1QixTQUFTdUgsdUJBQXVCMUcsRUFBWXlCLEdBQzNEVixFQUFPNEYsR0FBRyxRQUNWLFdBQ0VoRCxPQUFPOEMsU0FBU0csS0FBTzdGLEVBQU84RixRQUFRdkYsTUFFeEN5QyxLQUFLd0IsUUFBUXVCLEtBQUsvRiIsImZpbGUiOiJhcHAuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoYyA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTtcblxubGV0IGlkYlByb3h5YWJsZVR5cGVzO1xyXG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XHJcbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxyXG5mdW5jdGlvbiBnZXRJZGJQcm94eWFibGVUeXBlcygpIHtcclxuICAgIHJldHVybiBpZGJQcm94eWFibGVUeXBlcyB8fFxyXG4gICAgICAgIChpZGJQcm94eWFibGVUeXBlcyA9IFtJREJEYXRhYmFzZSwgSURCT2JqZWN0U3RvcmUsIElEQkluZGV4LCBJREJDdXJzb3IsIElEQlRyYW5zYWN0aW9uXSk7XHJcbn1cclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkge1xyXG4gICAgcmV0dXJuIGN1cnNvckFkdmFuY2VNZXRob2RzIHx8IChjdXJzb3JBZHZhbmNlTWV0aG9kcyA9IFtcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXHJcbiAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlUHJpbWFyeUtleSxcclxuICAgIF0pO1xyXG59XHJcbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvbkRvbmVNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xyXG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjb25zdCB1bmxpc3RlbiA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICBwcm9taXNlLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxyXG4gICAgICAgIC8vIChzZWUgd3JhcEZ1bmN0aW9uKS5cclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJDdXJzb3IpIHtcclxuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gVGhpcyBtYXBwaW5nIGV4aXN0cyBpbiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYnV0IGRvZXNuJ3QgZG9lc24ndCBleGlzdCBpbiB0cmFuc2Zvcm1DYWNoZS4gVGhpc1xyXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXHJcbiAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KHByb21pc2UsIHJlcXVlc3QpO1xyXG4gICAgcmV0dXJuIHByb21pc2U7XHJcbn1cclxuZnVuY3Rpb24gY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHR4KSB7XHJcbiAgICAvLyBFYXJseSBiYWlsIGlmIHdlJ3ZlIGFscmVhZHkgY3JlYXRlZCBhIGRvbmUgcHJvbWlzZSBmb3IgdGhpcyB0cmFuc2FjdGlvbi5cclxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBjb25zdCBkb25lID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY29tcGxldGUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QodHguZXJyb3IpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIENhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwuXHJcbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcclxufVxyXG5sZXQgaWRiUHJveHlUcmFwcyA9IHtcclxuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHRyYW5zYWN0aW9uLmRvbmUuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25Eb25lTWFwLmdldCh0YXJnZXQpO1xyXG4gICAgICAgICAgICAvLyBQb2x5ZmlsbCBmb3Igb2JqZWN0U3RvcmVOYW1lcyBiZWNhdXNlIG9mIEVkZ2UuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQub2JqZWN0U3RvcmVOYW1lcyB8fCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnc3RvcmUnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1sxXSA/XHJcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXHJcbiAgICAgICAgcmV0dXJuIHdyYXAodGFyZ2V0W3Byb3BdKTtcclxuICAgIH0sXHJcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uICYmIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDtcclxuICAgIH0sXHJcbn07XHJcbmZ1bmN0aW9uIGFkZFRyYXBzKGNhbGxiYWNrKSB7XHJcbiAgICBpZGJQcm94eVRyYXBzID0gY2FsbGJhY2soaWRiUHJveHlUcmFwcyk7XHJcbn1cclxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcclxuICAgIC8vIER1ZSB0byBleHBlY3RlZCBvYmplY3QgZXF1YWxpdHkgKHdoaWNoIGlzIGVuZm9yY2VkIGJ5IHRoZSBjYWNoaW5nIGluIGB3cmFwYCksIHdlXHJcbiAgICAvLyBvbmx5IGNyZWF0ZSBvbmUgbmV3IGZ1bmMgcGVyIGZ1bmMuXHJcbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cclxuICAgIGlmIChmdW5jID09PSBJREJEYXRhYmFzZS5wcm90b3R5cGUudHJhbnNhY3Rpb24gJiZcclxuICAgICAgICAnb2JqZWN0U3RvcmVOYW1lcycgaW4gSURCVHJhbnNhY3Rpb24ucHJvdG90eXBlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZnVuYy5jYWxsKHVud3JhcCh0aGlzKSwgc3RvcmVOYW1lcywgLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5zZXQodHgsIHN0b3JlTmFtZXMuc29ydCA/IHN0b3JlTmFtZXMuc29ydCgpIDogW3N0b3JlTmFtZXNdKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXHJcbiAgICAvLyBJREIsIHlvdSBhZHZhbmNlIHRoZSBjdXJzb3IgYW5kIHdhaXQgZm9yIGEgbmV3ICdzdWNjZXNzJyBvbiB0aGUgSURCUmVxdWVzdCB0aGF0IGdhdmUgeW91IHRoZVxyXG4gICAgLy8gY3Vyc29yLiBJdCdzIGtpbmRhIGxpa2UgYSBwcm9taXNlIHRoYXQgY2FuIHJlc29sdmUgd2l0aCBtYW55IHZhbHVlcy4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2VcclxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcclxuICAgIC8vIHVuZGVmaW5lZCBpZiB0aGUgZW5kIG9mIHRoZSBjdXJzb3IgaGFzIGJlZW4gcmVhY2hlZC5cclxuICAgIGlmIChnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpLmluY2x1ZGVzKGZ1bmMpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cclxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcChjdXJzb3JSZXF1ZXN0TWFwLmdldCh0aGlzKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xyXG4gICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgIHJldHVybiB3cmFwKGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXHJcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XHJcbiAgICAvLyBUaGlzIGRvZXNuJ3QgcmV0dXJuLCBpdCBqdXN0IGNyZWF0ZXMgYSAnZG9uZScgcHJvbWlzZSBmb3IgdGhlIHRyYW5zYWN0aW9uLFxyXG4gICAgLy8gd2hpY2ggaXMgbGF0ZXIgcmV0dXJuZWQgZm9yIHRyYW5zYWN0aW9uLmRvbmUgKHNlZSBpZGJPYmplY3RIYW5kbGVyKS5cclxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxyXG4gICAgICAgIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih2YWx1ZSk7XHJcbiAgICBpZiAoaW5zdGFuY2VPZkFueSh2YWx1ZSwgZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSkpXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XHJcbiAgICAvLyBSZXR1cm4gdGhlIHNhbWUgdmFsdWUgYmFjayBpZiB3ZSdyZSBub3QgZ29pbmcgdG8gdHJhbnNmb3JtIGl0LlxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXAodmFsdWUpIHtcclxuICAgIC8vIFdlIHNvbWV0aW1lcyBnZW5lcmF0ZSBtdWx0aXBsZSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QgKGVnIHdoZW4gY3Vyc29yaW5nKSwgYmVjYXVzZVxyXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCUmVxdWVzdClcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdCh2YWx1ZSk7XHJcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXHJcbiAgICAvLyBUaGlzIGlzIGZhc3RlciwgYnV0IGl0IGFsc28gcHJvdmlkZXMgb2JqZWN0IGVxdWFsaXR5LlxyXG4gICAgaWYgKHRyYW5zZm9ybUNhY2hlLmhhcyh2YWx1ZSkpXHJcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpO1xyXG4gICAgLy8gTm90IGFsbCB0eXBlcyBhcmUgdHJhbnNmb3JtZWQuXHJcbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cclxuICAgIGlmIChuZXdWYWx1ZSAhPT0gdmFsdWUpIHtcclxuICAgICAgICB0cmFuc2Zvcm1DYWNoZS5zZXQodmFsdWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VmFsdWU7XHJcbn1cclxuY29uc3QgdW53cmFwID0gKHZhbHVlKSA9PiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcblxuZXhwb3J0IHsgd3JhcCBhcyBhLCBhZGRUcmFwcyBhcyBiLCBpbnN0YW5jZU9mQW55IGFzIGMsIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBkLCB1bndyYXAgYXMgZSB9O1xuIiwiaW1wb3J0IHsgYSBhcyB3cmFwLCBiIGFzIGFkZFRyYXBzIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5leHBvcnQgeyBlIGFzIHVud3JhcCwgYSBhcyB3cmFwIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5cbi8qKlxyXG4gKiBPcGVuIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKiBAcGFyYW0gdmVyc2lvbiBTY2hlbWEgdmVyc2lvbi5cclxuICogQHBhcmFtIGNhbGxiYWNrcyBBZGRpdGlvbmFsIGNhbGxiYWNrcy5cclxuICovXHJcbmZ1bmN0aW9uIG9wZW5EQihuYW1lLCB2ZXJzaW9uLCB7IGJsb2NrZWQsIHVwZ3JhZGUsIGJsb2NraW5nIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xyXG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xyXG4gICAgaWYgKHVwZ3JhZGUpIHtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgaWYgKGJsb2NraW5nKVxyXG4gICAgICAgIG9wZW5Qcm9taXNlLnRoZW4oZGIgPT4gZGIuYWRkRXZlbnRMaXN0ZW5lcigndmVyc2lvbmNoYW5nZScsIGJsb2NraW5nKSk7XHJcbiAgICByZXR1cm4gb3BlblByb21pc2U7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZSBhIGRhdGFiYXNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cclxuICovXHJcbmZ1bmN0aW9uIGRlbGV0ZURCKG5hbWUsIHsgYmxvY2tlZCB9ID0ge30pIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgcmV0dXJuIHdyYXAocmVxdWVzdCkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xyXG59XG5cbmNvbnN0IHJlYWRNZXRob2RzID0gWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J107XHJcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcclxuY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTtcclxuZnVuY3Rpb24gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkge1xyXG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcclxuICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJlxyXG4gICAgICAgIHR5cGVvZiBwcm9wID09PSAnc3RyaW5nJykpXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgaWYgKGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApKVxyXG4gICAgICAgIHJldHVybiBjYWNoZWRNZXRob2RzLmdldChwcm9wKTtcclxuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xyXG4gICAgY29uc3QgdXNlSW5kZXggPSBwcm9wICE9PSB0YXJnZXRGdW5jTmFtZTtcclxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cclxuICAgIGlmICghKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgbWV0aG9kO1xyXG4gICAgaWYgKHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgbGV0IHRhcmdldCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lKS5zdG9yZTtcclxuICAgICAgICAgICAgaWYgKHVzZUluZGV4KVxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmluZGV4KGFyZ3Muc2hpZnQoKSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRbdGFyZ2V0RnVuY05hbWVdKC4uLmFyZ3MpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAod3JpdGVNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSB0aGlzLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICB0eC5zdG9yZVt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAobWV0aG9kKVxyXG4gICAgICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XHJcbiAgICByZXR1cm4gbWV0aG9kO1xyXG59XHJcbmFkZFRyYXBzKG9sZFRyYXBzID0+ICh7XHJcbiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksXHJcbiAgICBoYXM6ICh0YXJnZXQsIHByb3ApID0+ICEhZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuaGFzKHRhcmdldCwgcHJvcCksXHJcbn0pKTtcblxuZXhwb3J0IHsgb3BlbkRCLCBkZWxldGVEQiB9O1xuIiwiLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xuaW1wb3J0IHsgb3BlbkRCLCBkZWxldGVEQiwgd3JhcCwgdW53cmFwIH0gZnJvbSAnaWRiJztcblxuY29uc3QgZGJQcm9taXNlID0gb3BlbkRCKCdyci1kYicsIDMsIHtcbiAgdXBncmFkZShkYiwgb2xkVmVyc2lvbikge1xuICAgIHN3aXRjaCAob2xkVmVyc2lvbikge1xuICAgICAgY2FzZSAwOlxuICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHsga2V5UGF0aDogJ2lkJywgfSk7XG4gICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjb25zdCByZXZpZXdzU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleChcInJlc3RhdXJhbnRfaWRcIiwgXCJyZXN0YXVyYW50X2lkXCIpO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjb25zdCBwZW5kaW5nU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncGVuZGluZycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSlcbiAgICB9XG4gIH1cbn0pO1xuXG5jbGFzcyBEQkhlbHBlciB7XG5cbiAgLyoqXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgY29uc3QgcG9ydCA9IDEzMzcvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xuICB9XG5cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9SRVZJRVdTX1VSTCgpIHtcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3c2A7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKi9cblxuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG4gICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbihyZXN0YXVyYW50cykge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoIHJlc3RhdXJhbnRfaWQsIGNhbGxiYWNrKSB7XG4gICAgbGV0IGZldGNoVVJMID0gREJIZWxwZXIuREFUQUJBU0VfUkVWSUVXU19VUkwgKyBcIi8/cmVzdGF1cmFudF9pZD1cIiArIHJlc3RhdXJhbnRfaWQ7XG4gICAgZmV0Y2goZmV0Y2hVUkwpLnRoZW4oIHJlc3BvbnNlID0+IHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSkudGhlbihyZXZpZXdzID0+IHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8gICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50UmV2aWV3c0J5SWQoaWQsIGNhbGxiYWNrKSB7XG4gIC8vICAgLy8gRmV0Y2ggYWxsIHJldmlld3MgZm9yIHRoZSBzcGVjaWZpYyByZXN0YXVyYW50XG4gIC8vICAgY29uc3QgZmV0Y2hVUkwgPSBEQkhlbHBlci5EQVRBQkFTRV9SRVZJRVdTX1VSTCArIFwiLz9yZXN0YXVyYW50X2lkPVwiICsgaWQ7XG4gIC8vICAgZmV0Y2goZmV0Y2hVUkwsIHttZXRob2Q6IFwiR0VUXCJ9KS50aGVuKHJlc3BvbnNlID0+IHtcbiAgLy8gICAgIGlmICghcmVzcG9uc2UuY2xvbmUoKS5vayAmJiAhcmVzcG9uc2UuY2xvbmUoKS5yZWRpcmVjdGVkKSB7XG4gIC8vICAgICAgIHRocm93IFwiTm8gcmV2aWV3cyBhdmFpbGFibGVcIjtcbiAgLy8gICAgIH1cbiAgLy8gICAgIHJlc3BvbnNlXG4gIC8vICAgICAgIC5qc29uKClcbiAgLy8gICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgLy8gICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAvLyAgICAgICB9KVxuICAvLyAgIH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG4gIC8vIH1cbiAgLyoqXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICovXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAqL1xuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICBpZighcmVzdGF1cmFudC5waG90b2dyYXBoKSB7XG4gICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYClcbiAgICB9XG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XG4gIH1cblxuICAvKipcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgKi9cbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgLy8gaHR0cHM6Ly9sZWFmbGV0anMuY29tL3JlZmVyZW5jZS0xLjMuMC5odG1sI21hcmtlclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBMLm1hcmtlcihbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAge3RpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxuICAgICAgfSlcbiAgICAgIG1hcmtlci5hZGRUbyhuZXdNYXApO1xuICAgIHJldHVybiBtYXJrZXI7XG4gIH1cblxuICBzdGF0aWMgdXBkYXRlQ2FjaGVkUmVzdGF1cmFudFJldmlldyhmb3JtRGF0YSkge1xuICAgIGNvbnNvbGUubG9nKCd1cGRhdGluZyBjYWNoZSBmb3IgbmV3IHJldmlldycsIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XG4gICAgICBjb25zb2xlLmxvZygncHV0dGluZyByZXZpZXcgaW4gc3RvcmUnKTtcbiAgICAgIHN0b3JlLnB1dChmb3JtRGF0YSk7XG4gICAgICBjb25zb2xlLmxvZygnc3VjY2Vzc2Z1bGx5IHB1dCByZXZpZXcgaW4gc3RvcmUnKTtcbiAgICAgIHJldHVybiB0eC5kb25lO1xuICAgIH0pXG4gIH1cblxuICBzdGF0aWMgc2F2ZU5ld1Jldmlldyhmb3JtRGF0YSwgY2FsbGJhY2spIHtcbiAgICAvLyBCbG9jayBhbnkgbW9yZSBjbGlja3Mgb24gdGhlIHN1Ym1pdCBidXR0b24gdW50aWwgdGhlIGNhbGxiYWNrXG4gICAgLy8gY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdWJtaXQtZm9ybS1idG5cIik7XG4gICAgLy8gYnRuLm9uY2xpY2sgPSBudWxsO1xuICAgIGNvbnN0IHVybCA9IERCSGVscGVyLkRBVEFCQVNFX1JFVklFV1NfVVJMO1xuICAgIGNvbnN0IG1ldGhvZCA9IFwiUE9TVFwiO1xuICAgIERCSGVscGVyLnVwZGF0ZUNhY2hlZFJlc3RhdXJhbnRSZXZpZXcoZm9ybURhdGEpO1xuICAgIERCSGVscGVyLmFkZFBlbmRpbmdSZXF1ZXN0VG9RdWUodXJsLCBtZXRob2QsIGZvcm1EYXRhKS50aGVuKGpzb24gPT4ge1xuICAgICAgY2FsbGJhY2sobnVsbCwganNvbik7XG4gICAgfSk7XG5cbiAgfVxuXG4gIHN0YXRpYyBhZGRQZW5kaW5nUmVxdWVzdFRvUXVlKHVybCwgbWV0aG9kLCBmb3JtRGF0YSkge1xuICAgIC8vb3BlbiBkYXRhYmFzZSBhbmQgYWRkIHJlcXVlc3QgZGV0YWlscyB0byB0aGUgcGVuZGluZyBzdG9yZVxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwZW5kaW5nJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgc3RvcmUucHV0KHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVybCxcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgZm9ybURhdGFcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfSkudGhlbihEQkhlbHBlci5uZXh0UGVuZGluZygoZXJyb3IsIGpzb24pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGpzb24pO1xuICAgICAgcmV0dXJuIHJlc29sdmUoanNvbik7XG4gICAgfSkpO1xuICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBuZXh0UGVuZGluZyhjYWxsYmFjaykge1xuICAgIERCSGVscGVyLmF0dGVtcHRDb21taXRQZW5kaW5nKERCSGVscGVyLm5leHRQZW5kaW5nKS50aGVuKGogPT4ge1xuICAgICAgY29uc29sZS5sb2coaik7XG4gICAgICBjYWxsYmFjayhudWxsLCBqKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBhdHRlbXB0Q29tbWl0UGVuZGluZyhjYWxsYmFjaykge1xuICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgcGVuZGluZyBpdGVtcyB1bnRpbCB0aGVyZSBpcyBhIG5ldHdvcmsgZmFpbHVyZVxuICAgIGxldCB1cmw7XG4gICAgbGV0IG1ldGhvZDtcbiAgICBsZXQgYm9keTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSggKHJlc29sdmUsIHJlamVjdCkgPT4geyBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiREIgbm90IGF2YWlsYWJsZVwiKTtcbiAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncGVuZGluZycsICdyZWFkd3JpdGUnKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3BlbmRpbmcnKTtcbiAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS50aGVuKCBjdXJzb3IgPT4ge1xuICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJzb3IudmFsdWU7XG4gICAgICAgIHVybCA9IGN1cnNvci52YWx1ZS5kYXRhLnVybDtcbiAgICAgICAgbWV0aG9kID0gY3Vyc29yLnZhbHVlLmRhdGEubWV0aG9kO1xuICAgICAgICBib2R5ID0gY3Vyc29yLnZhbHVlLmRhdGEuZm9ybURhdGE7XG5cblxuICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIGEgcGFyYW1ldGVyIHRoZW4gd2UncmUgb24gYSBiYWQgcmVjb3JkIHRoYXQgc2hvdWxkIGJlIHRvc3NlZFxuICAgICAgICAvLyBhbmQgdGhlbiBtb3ZlIG9uXG4gICAgICAgIGlmICgoIXVybCB8fCAhbWV0aG9kKSB8fCAobWV0aG9kID09PSBcIlBPU1RcIiAmJiAhYm9keSkpIHtcbiAgICAgICAgICBjdXJzb3JcbiAgICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgICAgLnRoZW4oY2FsbGJhY2soKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICAgICAgbWV0aG9kOiBtZXRob2RcbiAgICAgICAgfVxuICAgICAgICBmZXRjaCh1cmwsIHByb3BlcnRpZXMpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAvLyBJZiB3ZSBkb24ndCBnZXQgYSBnb29kIHJlc3BvbnNlIHRoZW4gYXNzdW1lIHdlJ3JlIG9mZmxpbmVcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rICYmICFyZXNwb25zZS5yZWRpcmVjdGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0pLnRoZW4oIGogPT4ge1xuICAgICAgICAgIGNvbnN0IGRlbHR4ID0gZGIudHJhbnNhY3Rpb24oJ3BlbmRpbmcnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSBkZWx0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKVxuICAgICAgICAgICAgLnRoZW4oIGN1cnNvciA9PiB7XG4gICAgICAgICAgICAgIGN1cnNvci5kZWxldGUoKVxuICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShqKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZWQgaXRlbSBmcm9tIHBlbmRpbmcgc3RvcmUnKTtcbiAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIHN0YXRpYyBzeW5jUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgIHRyeSB7XG4gICAgICAgbGV0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50LmlkfS8/aXNfZmF2b3JpdGU9JHtyZXN0YXVyYW50LmlzX2Zhdm9yaXRlfWA7XG4gICAgICAgbGV0IHBhcmFtcyA9IHttZXRob2Q6ICdQVVQnfTtcbiAgICAgICByZXR1cm4gZmV0Y2godXJsLCBwYXJhbXMpLnRoZW4oZnVuY3Rpb24ocil7IHJldHVybiByLmpzb24oKSB9KTtcbiAgICAgfVxuICAgICBjYXRjaChlKSB7XG4gICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHVwZGF0aW5nIHJlc3RhdXJhbnQgYmFja2VuZCBkYXRhLi4uJywgZSwgcmVzdGF1cmFudCk7XG4gICAgIH1cbiAgfVxuICAgICBzdGF0aWMgdXBkYXRlUmVzdGF1cmFudEluREIobmV3X3Jlc3RhdXJhbnQpIHtcbiAgICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZnVuY3Rpb24oZGIpe1xuICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICAgICBzdG9yZS5wdXQobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlXG4gICAgICAgfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgIH0pO1xuICAgICB9XG5cbiAgc3RhdGljIHRvZ2dsZUZhdkJ0bihyZXN0YXVyYW50X2lkKSB7XG4gICAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKTtcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldChyZXN0YXVyYW50X2lkKTtcbiAgICB9KS50aGVuKCByZXN0YXVyYW50ID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnQpO1xuICAgICAgY29uc3QgbmV3X3Jlc3RhdXJhbnQgPSBPYmplY3QuYXNzaWduKHt9LCByZXN0YXVyYW50KTtcbiAgICAgIG5ld19yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8fCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSA/XG4gICAgICAnZmFsc2UnIDogJ3RydWUnO1xuICAgICAgREJIZWxwZXIuc3luY1Jlc3RhdXJhbnQobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgcmV0dXJuIERCSGVscGVyLnVwZGF0ZVJlc3RhdXJhbnRJbkRCKG5ld19yZXN0YXVyYW50KTtcbiAgICB9KS50aGVuKCBuZXdfcmVzdGF1cmFudCA9PiB7XG4gICAgICBjb25zdCBmYXZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZmF2LWJ0bi0ke25ld19yZXN0YXVyYW50LmlkfWApO1xuICAgICAgaWYobmV3X3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8fCBuZXdfcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICBmYXZCdG4uaW5uZXJIVE1MID0gJ0Zhdm9yaXRlZCEnO1xuICAgICAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdob3RwaW5rJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZhdkJ0bi5pbm5lckhUTUwgPSAnQWRkIHRvIGZhdm9yaXRlJztcbiAgICAgICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnZ3JleSc7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG59XG5cbndpbmRvdy5EQkhlbHBlciA9IERCSGVscGVyO1xuXG4iLCJsZXQgcmVzdGF1cmFudHMsXG4gIG5laWdoYm9yaG9vZHMsXG4gIGN1aXNpbmVzXG52YXIgbmV3TWFwO1xudmFyIG1hcmtlcnMgPSBbXTtcblxuLy8gY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oJ3JyLWRiJywgMSwgdXBncmFkZURCID0+IHtcbi8vICAgdmFyIHJlc3RhdXJhbnRzX3N0b3JlID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHsga2V5UGF0aDogJ2lkJyB9KTtcbi8vICAgcmVzdGF1cmFudHNfc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG5cbi8vICAgdmFyIHJldmlld3Nfc3RvcmUgPSB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7IGtleVBhdGg6ICdpZCcgfSk7XG4vLyAgIHJldmlld3Nfc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG4vLyAgIHJldmlld3Nfc3RvcmUuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuLy8gfSk7XG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGluaXRNYXAoKTsgLy8gYWRkZWRcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlUmVzdGF1cmFudHMpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZVJlc3RhdXJhbnRzKTtcblxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG5jb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICBuZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFs0MC43MjIyMTYsIC03My45ODc1MDFdLFxuICAgICAgICB6b29tOiAxMixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxuICAgICAgfSk7XG4gIHNlbGYubmV3TWFwID0gbmV3TWFwO1xuICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xuICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2lkMlZ1ZEdsdUlpd2lZU0k2SW1OcWFYSjBOMjVpWmpGd2RqWXphM0E0TUd0MWFIVTJiakVpZlEuRG5ORlVvTjV1encwMWxfWEtfYzduUScsXG4gICAgbWF4Wm9vbTogMTgsXG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXG4gICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcbiAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXG4gIH0pLmFkZFRvKG5ld01hcCk7XG5cbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn1cbi8qIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBsZXQgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufSAqL1xuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgIH1cbiAgfSlcbn1cblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbmNvbnN0IHJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBpZiAoc2VsZi5tYXJrZXJzKSB7XG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5yZW1vdmUoKSk7XG4gIH1cbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgY29uc29sZS5sb2cocmVzdGF1cmFudCk7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIHJlc3RhdXJhbnQubmFtZSk7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgY29uc29sZS5sb2coaW1hZ2Uuc3JjKTtcbiAgZGl2LmFwcGVuZChpbWFnZSk7XG4gIGxpLmFwcGVuZChkaXYpO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnNvbGUubG9nKFwiaXNfZmF2b3JpdGU6IFwiLCByZXN0YXVyYW50W1wiaXNfZmF2b3JpdGVcIl0pO1xuXG4gIGNvbnN0IGZhdkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBjb25zdCBpc0Zhdm9yaXRlID0gKHJlc3RhdXJhbnRbXCJpc19mYXZvcml0ZVwiXSAmJiByZXN0YXVyYW50W1wiaXNfZmF2b3JpdGVcIl0udG9TdHJpbmcoKSA9PT0gXCJ0cnVlXCIpID8gdHJ1ZSA6IGZhbHNlO1xuICBpZihyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSBcInRydWVcIiB8fCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSB7XG4gICAgZmF2QnRuLmlubmVySFRNTCA9ICdGYXZvcml0ZWQhJztcbiAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdob3RwaW5rJztcbiAgfSBlbHNlIHtcbiAgICBmYXZCdG4uaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvcml0ZSc7XG4gICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnZ3JleSc7XG4gIH1cbiAgZmF2QnRuLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIGB0b2dnbGUgZmF2b3JpdGVzIGZvcjogJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBgZmF2LWJ0bi0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoXCJkYXRhLXJlc3RhdXJhbnQtaWRcIiwgcmVzdGF1cmFudC5pZCk7XG5cbiAgZmF2QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2NsaWNrZWQgZmF2YnRuJyk7XG4gICAgREJIZWxwZXIudG9nZ2xlRmF2QnRuKHJlc3RhdXJhbnQuaWQpO1xuICB9KVxuXG5cbiAgbGkuYXBwZW5kKGZhdkJ0bik7XG5cbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBtb3JlLmNsYXNzTGlzdCA9IFwiYnV0dG9uIGJ1dHRvbi0tc3VjY2Vzc1wiO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcmVzdGF1cmFudC5uYW1lICsgcmVzdGF1cmFudC5uZWlnaGJvcmhvb2QgKyByZXN0YXVyYW50LmFkZHJlc3MgKyBcIlZpZXcgRGV0YWlsc1wiKTtcbiAgbW9yZS5vbmNsaWNrID0gKCkgPT4ge1xuICAgIGNvbnN0IHVybCA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gICAgd2luZG93LmxvY2F0aW9uID0gdXJsO1xuICB9XG4gIGxpLmFwcGVuZChtb3JlKTtcblxuICByZXR1cm4gbGlcbn1cblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBuZXdNYXApO1xuICAgIG1hcmtlci5vbihcImNsaWNrXCIsIG9uQ2xpY2spO1xuICAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci5vcHRpb25zLnVybDtcbiAgICB9XG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgfSk7XG59XG5cbiJdLCJzb3VyY2VSb290IjoiIn0=