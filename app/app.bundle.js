!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1);const o=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});class a{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get DATABASE_REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){fetch(a.DATABASE_URL).then(function(t){t.json().then(function(t){e(null,t)})})}static fetchReviews(e,t){let n=a.DATABASE_REVIEWS_URL+"/?restaurant_id="+e;fetch(n).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){a.fetchRestaurants((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return e.photograph?`/img/${e.photograph}.jpg`:`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:a.urlForRestaurant(e)});return n.addTo(newMap),n}static updateCachedRestaurantReview(e){return console.log("updating cache for new review",e),o.then(t=>{const n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return console.log("putting review in store"),r.put(e),console.log("successfully put review in store"),n.done})}static saveNewReview(e){const t=a.DATABASE_REVIEWS_URL;return a.updateCachedRestaurantReview(e),a.addPendingRequestToQue(t,"POST",e).then(e=>e)}static addPendingRequestToQue(e,t,n){return new Promise((r,s)=>{o.then(r=>{r.transaction("pending","readwrite").objectStore("pending").put({data:{url:e,method:t,formData:n}})}).catch(e=>{console.log(e)}).then(a.nextPending((e,t)=>(console.log(t),r(t))))})}static nextPending(e){a.attemptCommitPending(a.nextPending).then(t=>{console.log(t),e(null,t)})}static attemptCommitPending(e){let t,n,r;return new Promise((a,s)=>{o.then(o=>{if(!o.objectStoreNames.length)return console.log("DB not available"),void o.close();o.transaction("pending","readwrite").objectStore("pending").openCursor().then(s=>{if(!s)return;s.value;if(t=s.value.data.url,n=s.value.data.method,r=s.value.data.formData,!t||!n||"POST"===n&&!r)return void s.delete().then(e());const i={body:JSON.stringify(r),method:n};fetch(t,i).then(e=>e.ok||e.redirected?e.json():(console.log("this is the response and we are offline"),void console.log(e))).then(t=>{o.transaction("pending","readwrite").objectStore("pending").openCursor().then(n=>{n.delete().then(()=>(e(),console.log(t),a(t)))}),console.log("deleted item from pending store")}).catch(e=>{console.log(e)})})})})}static syncRestaurant(e){try{let t=`http://localhost:1337/restaurants/${e.id}/?is_favorite=${e.is_favorite}`;return fetch(t,{method:"PUT"}).then(function(e){return e.json()})}catch(t){console.log("error updating restaurant backend data...",t,e)}}static updateRestaurantInDB(e){return o.then(function(t){let n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(e),n.complete}).then(function(){return Promise.resolve(e)})}static toggleFavBtn(e){return o.then(t=>{return t.transaction("restaurants").objectStore("restaurants").get(e)}).then(e=>{console.log(e);const t=Object.assign({},e);return t.is_favorite="true"===e.is_favorite||!0===e.is_favorite?"false":"true",a.syncRestaurant(t),a.updateRestaurantInDB(t)}).then(e=>{const t=document.getElementById(`fav-btn-${e.id}`);"true"===e.is_favorite||!0===e.is_favorite?(t.innerHTML="Favorited!",t.style.background="hotpink"):(t.innerHTML="Add to favorite",t.style.background="grey")})}}},function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,a;const s=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(g(this),t,...n);return c.set(r,t.sort?t.sort():[t]),h(r)}:(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),h(s.get(this))}:function(...t){return h(e.apply(g(this),t))}}function p(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});i.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function h(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(h(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=p(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function m(e,t,{blocked:n,upgrade:r,blocking:o}={}){const a=indexedDB.open(e,t),s=h(a);return r&&a.addEventListener("upgradeneeded",e=>{r(h(a.result),e.oldVersion,e.newVersion,h(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o&&s.then(e=>e.addEventListener("versionchange",o)),s}n.d(t,"a",function(){return m});const v=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],y=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return v.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),b.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&y.set(t,o),o}d=(e=>({get:(t,n,r)=>w(t,n)||e.get(t,n,r),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(d)},function(e,t,n){"use strict";"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceworker.bundle.js").then(e=>{console.log("SW registered: ",e),console.log("HELLO FROM REGISTRATION JS")}).catch(e=>{console.log("SW registration failed: ",e)})})},function(e,t,n){"use strict";n.r(t);n(2);var r=n(0);var o;document.addEventListener("DOMContentLoaded",e=>{u(),a(),i(),r.a.nextPending()});const a=()=>{r.a.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,s())})},s=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");t.addEventListener("change",l),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},i=()=>{r.a.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,c())})},c=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");t.addEventListener("change",l),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},u=()=>{o=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),self.newMap=o,L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoid2VudGluIiwiYSI6ImNqaXJ0N25iZjFwdjYza3A4MGt1aHU2bjEifQ.DnNFUoN5uzw01l_XK_c7nQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(o),l()},l=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,o=t.selectedIndex,a=e[n].value,s=t[o].value;r.a.fetchRestaurantByCuisineAndNeighborhood(a,s,(e,t)=>{e?console.error(e):(d(t),f())})},d=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(e=>e.remove()),self.markers=[],self.restaurants=e},f=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{console.log(e),t.append(p(e))}),h()},p=e=>{const t=document.createElement("li"),n=document.createElement("img"),o=document.createElement("div");n.className="restaurant-img",n.setAttribute("alt",e.name),n.src=r.a.imageUrlForRestaurant(e),console.log(n.src),o.append(n),t.append(o);const a=document.createElement("h1");a.innerHTML=e.name,t.append(a);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const i=document.createElement("p");i.innerHTML=e.address,t.append(i),console.log("is_favorite: ",e.is_favorite);const c=document.createElement("button");!e.is_favorite||e.is_favorite.toString();"true"===e.is_favorite||!0===e.is_favorite?(c.innerHTML="Favorited!",c.style.background="hotpink"):(c.innerHTML="Add to favorite",c.style.background="grey"),c.setAttribute("title",`toggle favorites for: ${e.name}`),c.setAttribute("id",`fav-btn-${e.id}`),c.setAttribute("data-restaurant-id",e.id),c.addEventListener("click",()=>{console.log("clicked favbtn"),r.a.toggleFavBtn(e.id)}),t.append(c);const u=document.createElement("button");return u.classList="button button--success",u.innerHTML="View Details",u.setAttribute("aria-label",e.name+e.neighborhood+e.address+"View Details"),u.onclick=(()=>{const t=r.a.urlForRestaurant(e);window.location=t}),t.append(u),t},h=(e=self.restaurants)=>{e.forEach(e=>{const t=r.a.mapMarkerForRestaurant(e,o);t.on("click",function(){window.location.href=t.options.url}),self.markers.push(t)})}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vYXBwL3NyYy9kYmhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9jaHVuay5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL3JlZ2lzdHJhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL21haW4uanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJfX3dlYnBhY2tfZXhwb3J0c19fIiwiREJIZWxwZXIiLCJpZGJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImRiUHJvbWlzZSIsIm9wZW5EQiIsInVwZ3JhZGUiLCJkYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImF1dG9JbmNyZW1lbnQiLCJEQVRBQkFTRV9VUkwiLCJEQVRBQkFTRV9SRVZJRVdTX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudHMiLCJyZXN0YXVyYW50X2lkIiwiZmV0Y2hVUkwiLCJyZXZpZXdzIiwiY2F0Y2giLCJlcnJvciIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJuZXdNYXAiLCJmb3JtRGF0YSIsImNvbnNvbGUiLCJsb2ciLCJ0eCIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsInB1dCIsImRvbmUiLCJ1cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3IiwiYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSIsIm1ldGhvZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZGF0YSIsIm5leHRQZW5kaW5nIiwiYXR0ZW1wdENvbW1pdFBlbmRpbmciLCJqIiwiYm9keSIsIm9iamVjdFN0b3JlTmFtZXMiLCJsZW5ndGgiLCJjbG9zZSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJkZWxldGUiLCJwcm9wZXJ0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwicmVkaXJlY3RlZCIsImlzX2Zhdm9yaXRlIiwiZSIsIm5ld19yZXN0YXVyYW50IiwiY29tcGxldGUiLCJhc3NpZ24iLCJzeW5jUmVzdGF1cmFudCIsInVwZGF0ZVJlc3RhdXJhbnRJbkRCIiwiZmF2QnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsInN0eWxlIiwiYmFja2dyb3VuZCIsImluc3RhbmNlT2ZBbnkiLCJjb25zdHJ1Y3RvcnMiLCJzb21lIiwiaWRiUHJveHlhYmxlVHlwZXMiLCJjdXJzb3JBZHZhbmNlTWV0aG9kcyIsImN1cnNvclJlcXVlc3RNYXAiLCJXZWFrTWFwIiwidHJhbnNhY3Rpb25Eb25lTWFwIiwidHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwIiwidHJhbnNmb3JtQ2FjaGUiLCJyZXZlcnNlVHJhbnNmb3JtQ2FjaGUiLCJpZGJQcm94eVRyYXBzIiwidGFyZ2V0IiwicHJvcCIsInJlY2VpdmVyIiwiSURCVHJhbnNhY3Rpb24iLCJ1bmRlZmluZWQiLCJ3cmFwIiwiaGFzIiwid3JhcEZ1bmN0aW9uIiwiZnVuYyIsIklEQkRhdGFiYXNlIiwic3RvcmVOYW1lcyIsImFyZ3MiLCJ1bndyYXAiLCJ0aGlzIiwic2V0Iiwic29ydCIsIklEQkN1cnNvciIsImFkdmFuY2UiLCJjb250aW51ZSIsImNvbnRpbnVlUHJpbWFyeUtleSIsImluY2x1ZGVzIiwiYXBwbHkiLCJ0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlIiwidW5saXN0ZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbiIsIklEQk9iamVjdFN0b3JlIiwiSURCSW5kZXgiLCJQcm94eSIsIklEQlJlcXVlc3QiLCJyZXF1ZXN0IiwicHJvbWlzZSIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJwcm9taXNpZnlSZXF1ZXN0IiwibmV3VmFsdWUiLCJ2ZXJzaW9uIiwiYmxvY2tlZCIsImJsb2NraW5nIiwiaW5kZXhlZERCIiwib3BlbiIsIm9wZW5Qcm9taXNlIiwiZXZlbnQiLCJuZXdWZXJzaW9uIiwicmVhZE1ldGhvZHMiLCJ3cml0ZU1ldGhvZHMiLCJjYWNoZWRNZXRob2RzIiwiTWFwIiwiZ2V0TWV0aG9kIiwidGFyZ2V0RnVuY05hbWUiLCJyZXBsYWNlIiwidXNlSW5kZXgiLCJzdG9yZU5hbWUiLCJpbmRleCIsInNoaWZ0Iiwib2xkVHJhcHMiLCJuYXZpZ2F0b3IiLCJ3aW5kb3ciLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWdpc3RyYXRpb24iLCJyZWdpc3RyYXRpb25FcnJvciIsIl9kYmhlbHBlcl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwiaW5pdE1hcCIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwidXBkYXRlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJjZW50ZXIiLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm1hcmtlcnMiLCJyZW1vdmUiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImRpdiIsImNsYXNzTmFtZSIsInNldEF0dHJpYnV0ZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFkZHJlc3MiLCJ0b1N0cmluZyIsInRvZ2dsZUZhdkJ0biIsIm1vcmUiLCJjbGFzc0xpc3QiLCJvbmNsaWNrIiwibG9jYXRpb24iLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50Iiwib24iLCJocmVmIiwib3B0aW9ucyIsInB1c2giXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVB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QWdCMEwsV0FDN0MsU0FBM0IxTCxFQUFXeUQsY0FBcUQsSUFBM0J6RCxFQUFXeUQsYUFDakRPLEVBQU9HLFVBQVksYUFDbkJILEVBQU9JLE1BQU1DLFdBQWEsWUFFMUJMLEVBQU9HLFVBQVksa0JBQ25CSCxFQUFPSSxNQUFNQyxXQUFhLFFBRTVCTCxFQUFPc0gsYUFBYSxpQ0FBa0N0TCxFQUFXckQsUUFDakVxSCxFQUFPc0gsYUFBYSxnQkFBaUJ0TCxFQUFXRixNQUNoRGtFLEVBQU9zSCxhQUFhLHFCQUFzQnRMLEVBQVdGLElBRXJEa0UsRUFBTzJDLGlCQUFpQixRQUFTLEtBQy9CaEYsUUFBUUMsSUFBSSxrQkFDWnZELElBQVNzTixhQUFhM0wsRUFBV0YsTUFJbkNvTCxFQUFHdEIsT0FBTzVGLEdBRVYsTUFBTTRILEVBQU8zSCxTQUFTMEYsY0FBYyxVQVVwQyxPQVRBaUMsRUFBS0MsVUFBWSx5QkFDakJELEVBQUt6SCxVQUFZLGVBQ2pCeUgsRUFBS04sYUFBYSxhQUFjdEwsRUFBV3JELEtBQU9xRCxFQUFXTSxhQUFlTixFQUFXeUwsUUFBVSxnQkFDakdHLEVBQUtFLFFBQVUsTUFDYixNQUFNeEssRUFBTWpELElBQVNrRCxpQkFBaUJ2QixHQUN0QzRJLE9BQU9tRCxTQUFXekssSUFFcEI0SixFQUFHdEIsT0FBT2dDLEdBRUhWLEdBTUhELEVBQWtCLENBQUN6TCxFQUFjNkosS0FBSzdKLGVBQzFDQSxFQUFZaUssUUFBUXpKLElBRWxCLE1BQU1lLEVBQVMxQyxJQUFTMk4sdUJBQXVCaE0sRUFBWXlCLEdBQzNEVixFQUFPa0wsR0FBRyxRQUNWLFdBQ0VyRCxPQUFPbUQsU0FBU0csS0FBT25MLEVBQU9vTCxRQUFRN0ssTUFFeEMrSCxLQUFLd0IsUUFBUXVCLEtBQUtyTCIsImZpbGUiOiJhcHAuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDMpO1xuIiwiLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xuaW1wb3J0IHsgb3BlbkRCLCBkZWxldGVEQiwgd3JhcCwgdW53cmFwIH0gZnJvbSAnaWRiJztcblxuY29uc3QgZGJQcm9taXNlID0gb3BlbkRCKCdyci1kYicsIDMsIHtcbiAgdXBncmFkZShkYiwgb2xkVmVyc2lvbikge1xuICAgIHN3aXRjaCAob2xkVmVyc2lvbikge1xuICAgICAgY2FzZSAwOlxuICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHsga2V5UGF0aDogJ2lkJywgfSk7XG4gICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjb25zdCByZXZpZXdzU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleChcInJlc3RhdXJhbnRfaWRcIiwgXCJyZXN0YXVyYW50X2lkXCIpO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjb25zdCBwZW5kaW5nU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncGVuZGluZycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSlcbiAgICB9XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEQkhlbHBlciB7XG5cbiAgLyoqXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgY29uc3QgcG9ydCA9IDEzMzcvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xuICB9XG5cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9SRVZJRVdTX1VSTCgpIHtcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3c2A7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKi9cblxuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG4gICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbihyZXN0YXVyYW50cykge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoIHJlc3RhdXJhbnRfaWQsIGNhbGxiYWNrKSB7XG4gICAgbGV0IGZldGNoVVJMID0gREJIZWxwZXIuREFUQUJBU0VfUkVWSUVXU19VUkwgKyBcIi8/cmVzdGF1cmFudF9pZD1cIiArIHJlc3RhdXJhbnRfaWQ7XG4gICAgZmV0Y2goZmV0Y2hVUkwpLnRoZW4oIHJlc3BvbnNlID0+IHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSkudGhlbihyZXZpZXdzID0+IHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8gICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50UmV2aWV3c0J5SWQoaWQsIGNhbGxiYWNrKSB7XG4gIC8vICAgLy8gRmV0Y2ggYWxsIHJldmlld3MgZm9yIHRoZSBzcGVjaWZpYyByZXN0YXVyYW50XG4gIC8vICAgY29uc3QgZmV0Y2hVUkwgPSBEQkhlbHBlci5EQVRBQkFTRV9SRVZJRVdTX1VSTCArIFwiLz9yZXN0YXVyYW50X2lkPVwiICsgaWQ7XG4gIC8vICAgZmV0Y2goZmV0Y2hVUkwsIHttZXRob2Q6IFwiR0VUXCJ9KS50aGVuKHJlc3BvbnNlID0+IHtcbiAgLy8gICAgIGlmICghcmVzcG9uc2UuY2xvbmUoKS5vayAmJiAhcmVzcG9uc2UuY2xvbmUoKS5yZWRpcmVjdGVkKSB7XG4gIC8vICAgICAgIHRocm93IFwiTm8gcmV2aWV3cyBhdmFpbGFibGVcIjtcbiAgLy8gICAgIH1cbiAgLy8gICAgIHJlc3BvbnNlXG4gIC8vICAgICAgIC5qc29uKClcbiAgLy8gICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgLy8gICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAvLyAgICAgICB9KVxuICAvLyAgIH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG4gIC8vIH1cbiAgLyoqXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICovXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAqL1xuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICBpZighcmVzdGF1cmFudC5waG90b2dyYXBoKSB7XG4gICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYClcbiAgICB9XG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XG4gIH1cblxuICAvKipcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgKi9cbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgLy8gaHR0cHM6Ly9sZWFmbGV0anMuY29tL3JlZmVyZW5jZS0xLjMuMC5odG1sI21hcmtlclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBMLm1hcmtlcihbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAge3RpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxuICAgICAgfSlcbiAgICAgIG1hcmtlci5hZGRUbyhuZXdNYXApO1xuICAgIHJldHVybiBtYXJrZXI7XG4gIH1cblxuICBzdGF0aWMgdXBkYXRlQ2FjaGVkUmVzdGF1cmFudFJldmlldyhmb3JtRGF0YSkge1xuICAgIGNvbnNvbGUubG9nKCd1cGRhdGluZyBjYWNoZSBmb3IgbmV3IHJldmlldycsIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XG4gICAgICBjb25zb2xlLmxvZygncHV0dGluZyByZXZpZXcgaW4gc3RvcmUnKTtcbiAgICAgIHN0b3JlLnB1dChmb3JtRGF0YSk7XG4gICAgICBjb25zb2xlLmxvZygnc3VjY2Vzc2Z1bGx5IHB1dCByZXZpZXcgaW4gc3RvcmUnKTtcbiAgICAgIHJldHVybiB0eC5kb25lO1xuICAgIH0pXG4gIH1cblxuICBzdGF0aWMgc2F2ZU5ld1Jldmlldyhmb3JtRGF0YSkge1xuICAgIC8vIEJsb2NrIGFueSBtb3JlIGNsaWNrcyBvbiB0aGUgc3VibWl0IGJ1dHRvbiB1bnRpbCB0aGUgY2FsbGJhY2tcbiAgICAvLyBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN1Ym1pdC1mb3JtLWJ0blwiKTtcbiAgICAvLyBidG4ub25jbGljayA9IG51bGw7XG4gICAgY29uc3QgdXJsID0gREJIZWxwZXIuREFUQUJBU0VfUkVWSUVXU19VUkw7XG4gICAgY29uc3QgbWV0aG9kID0gXCJQT1NUXCI7XG4gICAgREJIZWxwZXIudXBkYXRlQ2FjaGVkUmVzdGF1cmFudFJldmlldyhmb3JtRGF0YSk7XG4gICAgcmV0dXJuIERCSGVscGVyLmFkZFBlbmRpbmdSZXF1ZXN0VG9RdWUodXJsLCBtZXRob2QsIGZvcm1EYXRhKS50aGVuKGpzb24gPT4ganNvbik7XG5cbiAgfVxuXG4gIHN0YXRpYyBhZGRQZW5kaW5nUmVxdWVzdFRvUXVlKHVybCwgbWV0aG9kLCBmb3JtRGF0YSkge1xuICAgIC8vb3BlbiBkYXRhYmFzZSBhbmQgYWRkIHJlcXVlc3QgZGV0YWlscyB0byB0aGUgcGVuZGluZyBzdG9yZVxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwZW5kaW5nJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgc3RvcmUucHV0KHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVybCxcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgZm9ybURhdGFcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfSkudGhlbihEQkhlbHBlci5uZXh0UGVuZGluZygoZXJyb3IsIGpzb24pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGpzb24pO1xuICAgICAgcmV0dXJuIHJlc29sdmUoanNvbik7XG4gICAgfSkpO1xuICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBuZXh0UGVuZGluZyhjYWxsYmFjaykge1xuICAgIERCSGVscGVyLmF0dGVtcHRDb21taXRQZW5kaW5nKERCSGVscGVyLm5leHRQZW5kaW5nKS50aGVuKGogPT4ge1xuICAgICAgY29uc29sZS5sb2coaik7XG4gICAgICBjYWxsYmFjayhudWxsLCBqKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBhdHRlbXB0Q29tbWl0UGVuZGluZyhjYWxsYmFjaykge1xuICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgcGVuZGluZyBpdGVtcyB1bnRpbCB0aGVyZSBpcyBhIG5ldHdvcmsgZmFpbHVyZVxuICAgIGxldCB1cmw7XG4gICAgbGV0IG1ldGhvZDtcbiAgICBsZXQgYm9keTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSggKHJlc29sdmUsIHJlamVjdCkgPT4geyBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiREIgbm90IGF2YWlsYWJsZVwiKTtcbiAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncGVuZGluZycsICdyZWFkd3JpdGUnKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3BlbmRpbmcnKTtcbiAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS50aGVuKCBjdXJzb3IgPT4ge1xuICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJzb3IudmFsdWU7XG4gICAgICAgIHVybCA9IGN1cnNvci52YWx1ZS5kYXRhLnVybDtcbiAgICAgICAgbWV0aG9kID0gY3Vyc29yLnZhbHVlLmRhdGEubWV0aG9kO1xuICAgICAgICBib2R5ID0gY3Vyc29yLnZhbHVlLmRhdGEuZm9ybURhdGE7XG5cblxuICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIGEgcGFyYW1ldGVyIHRoZW4gd2UncmUgb24gYSBiYWQgcmVjb3JkIHRoYXQgc2hvdWxkIGJlIHRvc3NlZFxuICAgICAgICAvLyBhbmQgdGhlbiBtb3ZlIG9uXG4gICAgICAgIGlmICgoIXVybCB8fCAhbWV0aG9kKSB8fCAobWV0aG9kID09PSBcIlBPU1RcIiAmJiAhYm9keSkpIHtcbiAgICAgICAgICBjdXJzb3JcbiAgICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgICAgLnRoZW4oY2FsbGJhY2soKSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICAgICAgbWV0aG9kOiBtZXRob2RcbiAgICAgICAgfVxuICAgICAgICBmZXRjaCh1cmwsIHByb3BlcnRpZXMpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAvLyBJZiB3ZSBkb24ndCBnZXQgYSBnb29kIHJlc3BvbnNlIHRoZW4gYXNzdW1lIHdlJ3JlIG9mZmxpbmVcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rICYmICFyZXNwb25zZS5yZWRpcmVjdGVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndGhpcyBpcyB0aGUgcmVzcG9uc2UgYW5kIHdlIGFyZSBvZmZsaW5lJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0pLnRoZW4oIGogPT4ge1xuICAgICAgICAgIGNvbnN0IGRlbHR4ID0gZGIudHJhbnNhY3Rpb24oJ3BlbmRpbmcnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSBkZWx0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKVxuICAgICAgICAgICAgLnRoZW4oIGN1cnNvciA9PiB7XG4gICAgICAgICAgICAgIGN1cnNvci5kZWxldGUoKVxuICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShqKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZWQgaXRlbSBmcm9tIHBlbmRpbmcgc3RvcmUnKTtcbiAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIHN0YXRpYyBzeW5jUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgIHRyeSB7XG4gICAgICAgbGV0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50LmlkfS8/aXNfZmF2b3JpdGU9JHtyZXN0YXVyYW50LmlzX2Zhdm9yaXRlfWA7XG4gICAgICAgbGV0IHBhcmFtcyA9IHttZXRob2Q6ICdQVVQnfTtcbiAgICAgICByZXR1cm4gZmV0Y2godXJsLCBwYXJhbXMpLnRoZW4oZnVuY3Rpb24ocil7IHJldHVybiByLmpzb24oKSB9KTtcbiAgICAgfVxuICAgICBjYXRjaChlKSB7XG4gICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHVwZGF0aW5nIHJlc3RhdXJhbnQgYmFja2VuZCBkYXRhLi4uJywgZSwgcmVzdGF1cmFudCk7XG4gICAgIH1cbiAgfVxuICAgICBzdGF0aWMgdXBkYXRlUmVzdGF1cmFudEluREIobmV3X3Jlc3RhdXJhbnQpIHtcbiAgICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZnVuY3Rpb24oZGIpe1xuICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICAgICBzdG9yZS5wdXQobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlXG4gICAgICAgfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgIH0pO1xuICAgICB9XG5cbiAgc3RhdGljIHRvZ2dsZUZhdkJ0bihyZXN0YXVyYW50X2lkKSB7XG4gICAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKTtcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldChyZXN0YXVyYW50X2lkKTtcbiAgICB9KS50aGVuKCByZXN0YXVyYW50ID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnQpO1xuICAgICAgY29uc3QgbmV3X3Jlc3RhdXJhbnQgPSBPYmplY3QuYXNzaWduKHt9LCByZXN0YXVyYW50KTtcbiAgICAgIG5ld19yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8fCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSA/XG4gICAgICAnZmFsc2UnIDogJ3RydWUnO1xuICAgICAgREJIZWxwZXIuc3luY1Jlc3RhdXJhbnQobmV3X3Jlc3RhdXJhbnQpO1xuICAgICAgcmV0dXJuIERCSGVscGVyLnVwZGF0ZVJlc3RhdXJhbnRJbkRCKG5ld19yZXN0YXVyYW50KTtcbiAgICB9KS50aGVuKCBuZXdfcmVzdGF1cmFudCA9PiB7XG4gICAgICBjb25zdCBmYXZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZmF2LWJ0bi0ke25ld19yZXN0YXVyYW50LmlkfWApO1xuICAgICAgaWYobmV3X3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8fCBuZXdfcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICBmYXZCdG4uaW5uZXJIVE1MID0gJ0Zhdm9yaXRlZCEnO1xuICAgICAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdob3RwaW5rJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZhdkJ0bi5pbm5lckhUTUwgPSAnQWRkIHRvIGZhdm9yaXRlJztcbiAgICAgICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnZ3JleSc7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG59XG5cbiIsImNvbnN0IGluc3RhbmNlT2ZBbnkgPSAob2JqZWN0LCBjb25zdHJ1Y3RvcnMpID0+IGNvbnN0cnVjdG9ycy5zb21lKGMgPT4gb2JqZWN0IGluc3RhbmNlb2YgYyk7XG5cbmxldCBpZGJQcm94eWFibGVUeXBlcztcclxubGV0IGN1cnNvckFkdmFuY2VNZXRob2RzO1xyXG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cclxuZnVuY3Rpb24gZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSB7XHJcbiAgICByZXR1cm4gaWRiUHJveHlhYmxlVHlwZXMgfHxcclxuICAgICAgICAoaWRiUHJveHlhYmxlVHlwZXMgPSBbSURCRGF0YWJhc2UsIElEQk9iamVjdFN0b3JlLCBJREJJbmRleCwgSURCQ3Vyc29yLCBJREJUcmFuc2FjdGlvbl0pO1xyXG59XHJcbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxyXG5mdW5jdGlvbiBnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpIHtcclxuICAgIHJldHVybiBjdXJzb3JBZHZhbmNlTWV0aG9kcyB8fCAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgPSBbXHJcbiAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5hZHZhbmNlLFxyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWUsXHJcbiAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZVByaW1hcnlLZXksXHJcbiAgICBdKTtcclxufVxyXG5jb25zdCBjdXJzb3JSZXF1ZXN0TWFwID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgdHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xyXG5mdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcclxuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZSh3cmFwKHJlcXVlc3QucmVzdWx0KSk7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gICAgcHJvbWlzZS50aGVuKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgIC8vIFNpbmNlIGN1cnNvcmluZyByZXVzZXMgdGhlIElEQlJlcXVlc3QgKCpzaWdoKiksIHdlIGNhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWxcclxuICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuXHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCQ3Vyc29yKSB7XHJcbiAgICAgICAgICAgIGN1cnNvclJlcXVlc3RNYXAuc2V0KHZhbHVlLCByZXF1ZXN0KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIFRoaXMgbWFwcGluZyBleGlzdHMgaW4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlIGJ1dCBkb2Vzbid0IGRvZXNuJ3QgZXhpc3QgaW4gdHJhbnNmb3JtQ2FjaGUuIFRoaXNcclxuICAgIC8vIGlzIGJlY2F1c2Ugd2UgY3JlYXRlIG1hbnkgcHJvbWlzZXMgZnJvbSBhIHNpbmdsZSBJREJSZXF1ZXN0LlxyXG4gICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChwcm9taXNlLCByZXF1ZXN0KTtcclxuICAgIHJldHVybiBwcm9taXNlO1xyXG59XHJcbmZ1bmN0aW9uIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih0eCkge1xyXG4gICAgLy8gRWFybHkgYmFpbCBpZiB3ZSd2ZSBhbHJlYWR5IGNyZWF0ZWQgYSBkb25lIHByb21pc2UgZm9yIHRoaXMgdHJhbnNhY3Rpb24uXHJcbiAgICBpZiAodHJhbnNhY3Rpb25Eb25lTWFwLmhhcyh0eCkpXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgY29uc3QgZG9uZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjb25zdCB1bmxpc3RlbiA9ICgpID0+IHtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbXBsZXRlID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVqZWN0KHR4LmVycm9yKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xyXG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICAvLyBDYWNoZSBpdCBmb3IgbGF0ZXIgcmV0cmlldmFsLlxyXG4gICAgdHJhbnNhY3Rpb25Eb25lTWFwLnNldCh0eCwgZG9uZSk7XHJcbn1cclxubGV0IGlkYlByb3h5VHJhcHMgPSB7XHJcbiAgICBnZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikge1xyXG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciB0cmFuc2FjdGlvbi5kb25lLlxyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2RvbmUnKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uRG9uZU1hcC5nZXQodGFyZ2V0KTtcclxuICAgICAgICAgICAgLy8gUG9seWZpbGwgZm9yIG9iamVjdFN0b3JlTmFtZXMgYmVjYXVzZSBvZiBFZGdlLlxyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ29iamVjdFN0b3JlTmFtZXMnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0Lm9iamVjdFN0b3JlTmFtZXMgfHwgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLmdldCh0YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIE1ha2UgdHguc3RvcmUgcmV0dXJuIHRoZSBvbmx5IHN0b3JlIGluIHRoZSB0cmFuc2FjdGlvbiwgb3IgdW5kZWZpbmVkIGlmIHRoZXJlIGFyZSBtYW55LlxyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3N0b3JlJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVyLm9iamVjdFN0b3JlTmFtZXNbMV0gP1xyXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCA6IHJlY2VpdmVyLm9iamVjdFN0b3JlKHJlY2VpdmVyLm9iamVjdFN0b3JlTmFtZXNbMF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVsc2UgdHJhbnNmb3JtIHdoYXRldmVyIHdlIGdldCBiYWNrLlxyXG4gICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7XHJcbiAgICB9LFxyXG4gICAgaGFzKHRhcmdldCwgcHJvcCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbiAmJiAocHJvcCA9PT0gJ2RvbmUnIHx8IHByb3AgPT09ICdzdG9yZScpKVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gcHJvcCBpbiB0YXJnZXQ7XHJcbiAgICB9LFxyXG59O1xyXG5mdW5jdGlvbiBhZGRUcmFwcyhjYWxsYmFjaykge1xyXG4gICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXBGdW5jdGlvbihmdW5jKSB7XHJcbiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZVxyXG4gICAgLy8gb25seSBjcmVhdGUgb25lIG5ldyBmdW5jIHBlciBmdW5jLlxyXG4gICAgLy8gRWRnZSBkb2Vzbid0IHN1cHBvcnQgb2JqZWN0U3RvcmVOYW1lcyAoYm9vbyksIHNvIHdlIHBvbHlmaWxsIGl0IGhlcmUuXHJcbiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmXHJcbiAgICAgICAgJ29iamVjdFN0b3JlTmFtZXMnIGluIElEQlRyYW5zYWN0aW9uLnByb3RvdHlwZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RvcmVOYW1lcywgLi4uYXJncykge1xyXG4gICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpO1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuc2V0KHR4LCBzdG9yZU5hbWVzLnNvcnQgPyBzdG9yZU5hbWVzLnNvcnQoKSA6IFtzdG9yZU5hbWVzXSk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cmFwKHR4KTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLy8gQ3Vyc29yIG1ldGhvZHMgYXJlIHNwZWNpYWwsIGFzIHRoZSBiZWhhdmlvdXIgaXMgYSBsaXR0bGUgbW9yZSBkaWZmZXJlbnQgdG8gc3RhbmRhcmQgSURCLiBJblxyXG4gICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGVcclxuICAgIC8vIGN1cnNvci4gSXQncyBraW5kYSBsaWtlIGEgcHJvbWlzZSB0aGF0IGNhbiByZXNvbHZlIHdpdGggbWFueSB2YWx1ZXMuIFRoYXQgZG9lc24ndCBtYWtlIHNlbnNlXHJcbiAgICAvLyB3aXRoIHJlYWwgcHJvbWlzZXMsIHNvIGVhY2ggYWR2YW5jZSBtZXRob2RzIHJldHVybnMgYSBuZXcgcHJvbWlzZSBmb3IgdGhlIGN1cnNvciBvYmplY3QsIG9yXHJcbiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuXHJcbiAgICBpZiAoZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKS5pbmNsdWRlcyhmdW5jKSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xyXG4gICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXHJcbiAgICAgICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuXHJcbiAgICAgICAgICAgIGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcclxuICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXHJcbiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cclxuICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxyXG4gICAgICAgIHJldHVybiB3cmFwRnVuY3Rpb24odmFsdWUpO1xyXG4gICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbixcclxuICAgIC8vIHdoaWNoIGlzIGxhdGVyIHJldHVybmVkIGZvciB0cmFuc2FjdGlvbi5kb25lIChzZWUgaWRiT2JqZWN0SGFuZGxlcikuXHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbilcclxuICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpO1xyXG4gICAgaWYgKGluc3RhbmNlT2ZBbnkodmFsdWUsIGdldElkYlByb3h5YWJsZVR5cGVzKCkpKVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJveHkodmFsdWUsIGlkYlByb3h5VHJhcHMpO1xyXG4gICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC5cclxuICAgIHJldHVybiB2YWx1ZTtcclxufVxyXG5mdW5jdGlvbiB3cmFwKHZhbHVlKSB7XHJcbiAgICAvLyBXZSBzb21ldGltZXMgZ2VuZXJhdGUgbXVsdGlwbGUgcHJvbWlzZXMgZnJvbSBhIHNpbmdsZSBJREJSZXF1ZXN0IChlZyB3aGVuIGN1cnNvcmluZyksIGJlY2F1c2VcclxuICAgIC8vIElEQiBpcyB3ZWlyZCBhbmQgYSBzaW5nbGUgSURCUmVxdWVzdCBjYW4geWllbGQgbWFueSByZXNwb25zZXMsIHNvIHRoZXNlIGNhbid0IGJlIGNhY2hlZC5cclxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpXHJcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QodmFsdWUpO1xyXG4gICAgLy8gSWYgd2UndmUgYWxyZWFkeSB0cmFuc2Zvcm1lZCB0aGlzIHZhbHVlIGJlZm9yZSwgcmV1c2UgdGhlIHRyYW5zZm9ybWVkIHZhbHVlLlxyXG4gICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS5cclxuICAgIGlmICh0cmFuc2Zvcm1DYWNoZS5oYXModmFsdWUpKVxyXG4gICAgICAgIHJldHVybiB0cmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xyXG4gICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTtcclxuICAgIC8vIE5vdCBhbGwgdHlwZXMgYXJlIHRyYW5zZm9ybWVkLlxyXG4gICAgLy8gVGhlc2UgbWF5IGJlIHByaW1pdGl2ZSB0eXBlcywgc28gdGhleSBjYW4ndCBiZSBXZWFrTWFwIGtleXMuXHJcbiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7XHJcbiAgICAgICAgdHJhbnNmb3JtQ2FjaGUuc2V0KHZhbHVlLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChuZXdWYWx1ZSwgdmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld1ZhbHVlO1xyXG59XHJcbmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG5cbmV4cG9ydCB7IHdyYXAgYXMgYSwgYWRkVHJhcHMgYXMgYiwgaW5zdGFuY2VPZkFueSBhcyBjLCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYXMgZCwgdW53cmFwIGFzIGUgfTtcbiIsImltcG9ydCB7IGEgYXMgd3JhcCwgYiBhcyBhZGRUcmFwcyB9IGZyb20gJy4vY2h1bmsuanMnO1xuZXhwb3J0IHsgZSBhcyB1bndyYXAsIGEgYXMgd3JhcCB9IGZyb20gJy4vY2h1bmsuanMnO1xuXG4vKipcclxuICogT3BlbiBhIGRhdGFiYXNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cclxuICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uXHJcbiAqIEBwYXJhbSBjYWxsYmFja3MgQWRkaXRpb25hbCBjYWxsYmFja3MuXHJcbiAqL1xyXG5mdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZyB9ID0ge30pIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihuYW1lLCB2ZXJzaW9uKTtcclxuICAgIGNvbnN0IG9wZW5Qcm9taXNlID0gd3JhcChyZXF1ZXN0KTtcclxuICAgIGlmICh1cGdyYWRlKSB7XHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd1cGdyYWRlbmVlZGVkJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHVwZ3JhZGUod3JhcChyZXF1ZXN0LnJlc3VsdCksIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIHdyYXAocmVxdWVzdC50cmFuc2FjdGlvbikpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGJsb2NrZWQpXHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKCkgPT4gYmxvY2tlZCgpKTtcclxuICAgIGlmIChibG9ja2luZylcclxuICAgICAgICBvcGVuUHJvbWlzZS50aGVuKGRiID0+IGRiLmFkZEV2ZW50TGlzdGVuZXIoJ3ZlcnNpb25jaGFuZ2UnLCBibG9ja2luZykpO1xyXG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xyXG59XHJcbi8qKlxyXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cclxuICpcclxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgZGF0YWJhc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWxldGVEQihuYW1lLCB7IGJsb2NrZWQgfSA9IHt9KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKG5hbWUpO1xyXG4gICAgaWYgKGJsb2NrZWQpXHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKCkgPT4gYmxvY2tlZCgpKTtcclxuICAgIHJldHVybiB3cmFwKHJlcXVlc3QpLnRoZW4oKCkgPT4gdW5kZWZpbmVkKTtcclxufVxuXG5jb25zdCByZWFkTWV0aG9kcyA9IFsnZ2V0JywgJ2dldEtleScsICdnZXRBbGwnLCAnZ2V0QWxsS2V5cycsICdjb3VudCddO1xyXG5jb25zdCB3cml0ZU1ldGhvZHMgPSBbJ3B1dCcsICdhZGQnLCAnZGVsZXRlJywgJ2NsZWFyJ107XHJcbmNvbnN0IGNhY2hlZE1ldGhvZHMgPSBuZXcgTWFwKCk7XHJcbmZ1bmN0aW9uIGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHtcclxuICAgIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIElEQkRhdGFiYXNlICYmXHJcbiAgICAgICAgIShwcm9wIGluIHRhcmdldCkgJiZcclxuICAgICAgICB0eXBlb2YgcHJvcCA9PT0gJ3N0cmluZycpKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIGlmIChjYWNoZWRNZXRob2RzLmdldChwcm9wKSlcclxuICAgICAgICByZXR1cm4gY2FjaGVkTWV0aG9kcy5nZXQocHJvcCk7XHJcbiAgICBjb25zdCB0YXJnZXRGdW5jTmFtZSA9IHByb3AucmVwbGFjZSgvRnJvbUluZGV4JC8sICcnKTtcclxuICAgIGNvbnN0IHVzZUluZGV4ID0gcHJvcCAhPT0gdGFyZ2V0RnVuY05hbWU7XHJcbiAgICAvLyBCYWlsIGlmIHRoZSB0YXJnZXQgZG9lc24ndCBleGlzdCBvbiB0aGUgdGFyZ2V0LiBFZywgZ2V0QWxsIGlzbid0IGluIEVkZ2UuXHJcbiAgICBpZiAoISh0YXJnZXRGdW5jTmFtZSBpbiAodXNlSW5kZXggPyBJREJJbmRleCA6IElEQk9iamVjdFN0b3JlKS5wcm90b3R5cGUpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IG1ldGhvZDtcclxuICAgIGlmIChyZWFkTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSkpIHtcclxuICAgICAgICBtZXRob2QgPSBmdW5jdGlvbiAoc3RvcmVOYW1lLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSkuc3RvcmU7XHJcbiAgICAgICAgICAgIGlmICh1c2VJbmRleClcclxuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5pbmRleChhcmdzLnNoaWZ0KCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0W3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgaWYgKHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSkpIHtcclxuICAgICAgICBtZXRob2QgPSBmdW5jdGlvbiAoc3RvcmVOYW1lLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgdHguc3RvcmVbdGFyZ2V0RnVuY05hbWVdKC4uLmFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHguZG9uZTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgaWYgKG1ldGhvZClcclxuICAgICAgICBjYWNoZWRNZXRob2RzLnNldChwcm9wLCBtZXRob2QpO1xyXG4gICAgcmV0dXJuIG1ldGhvZDtcclxufVxyXG5hZGRUcmFwcyhvbGRUcmFwcyA9PiAoe1xyXG4gICAgZ2V0OiAodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikgPT4gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpLFxyXG4gICAgaGFzOiAodGFyZ2V0LCBwcm9wKSA9PiAhIWdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmhhcyh0YXJnZXQsIHByb3ApLFxyXG59KSk7XG5cbmV4cG9ydCB7IG9wZW5EQiwgZGVsZXRlREIgfTtcbiIsImV4cG9ydCBkZWZhdWx0IChmdW5jdGlvbiAoKSB7XG5cbiAgaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3NlcnZpY2V3b3JrZXIuYnVuZGxlLmpzJykudGhlbihyZWdpc3RyYXRpb24gPT4ge1xuICAgICAgIGNvbnNvbGUubG9nKCdTVyByZWdpc3RlcmVkOiAnLCByZWdpc3RyYXRpb24pO1xuICAgICAgIGNvbnNvbGUubG9nKCdIRUxMTyBGUk9NIFJFR0lTVFJBVElPTiBKUycpO1xuICAgICB9KS5jYXRjaChyZWdpc3RyYXRpb25FcnJvciA9PiB7XG4gICAgICAgY29uc29sZS5sb2coJ1NXIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6ICcsIHJlZ2lzdHJhdGlvbkVycm9yKTtcbiAgICAgfSk7XG4gICB9KTtcbiAgfVxuXG59KSgpO1xuXG5cbiIsImltcG9ydCByZWdpc3RyYXRpb24gZnJvbSAnLi9yZWdpc3RyYXRpb24nO1xuaW1wb3J0IERCSGVscGVyIGZyb20gJy4vZGJoZWxwZXInO1xuXG5sZXQgcmVzdGF1cmFudHMsXG4gIG5laWdoYm9yaG9vZHMsXG4gIGN1aXNpbmVzXG52YXIgbmV3TWFwO1xudmFyIG1hcmtlcnMgPSBbXTtcblxuLy8gY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oJ3JyLWRiJywgMSwgdXBncmFkZURCID0+IHtcbi8vICAgdmFyIHJlc3RhdXJhbnRzX3N0b3JlID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHsga2V5UGF0aDogJ2lkJyB9KTtcbi8vICAgcmVzdGF1cmFudHNfc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG5cbi8vICAgdmFyIHJldmlld3Nfc3RvcmUgPSB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7IGtleVBhdGg6ICdpZCcgfSk7XG4vLyAgIHJldmlld3Nfc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG4vLyAgIHJldmlld3Nfc3RvcmUuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuLy8gfSk7XG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGluaXRNYXAoKTsgLy8gYWRkZWRcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbiAgREJIZWxwZXIubmV4dFBlbmRpbmcoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlUmVzdGF1cmFudHMpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZVJlc3RhdXJhbnRzKTtcblxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG5jb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICBuZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFs0MC43MjIyMTYsIC03My45ODc1MDFdLFxuICAgICAgICB6b29tOiAxMixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxuICAgICAgfSk7XG4gIHNlbGYubmV3TWFwID0gbmV3TWFwO1xuICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xuICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2lkMlZ1ZEdsdUlpd2lZU0k2SW1OcWFYSjBOMjVpWmpGd2RqWXphM0E0TUd0MWFIVTJiakVpZlEuRG5ORlVvTjV1encwMWxfWEtfYzduUScsXG4gICAgbWF4Wm9vbTogMTgsXG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXG4gICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcbiAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXG4gIH0pLmFkZFRvKG5ld01hcCk7XG5cbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn1cbi8qIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBsZXQgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufSAqL1xuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgIH1cbiAgfSlcbn1cblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbmNvbnN0IHJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBpZiAoc2VsZi5tYXJrZXJzKSB7XG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5yZW1vdmUoKSk7XG4gIH1cbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgY29uc29sZS5sb2cocmVzdGF1cmFudCk7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIHJlc3RhdXJhbnQubmFtZSk7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgY29uc29sZS5sb2coaW1hZ2Uuc3JjKTtcbiAgZGl2LmFwcGVuZChpbWFnZSk7XG4gIGxpLmFwcGVuZChkaXYpO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnNvbGUubG9nKFwiaXNfZmF2b3JpdGU6IFwiLCByZXN0YXVyYW50W1wiaXNfZmF2b3JpdGVcIl0pO1xuXG4gIGNvbnN0IGZhdkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBjb25zdCBpc0Zhdm9yaXRlID0gKHJlc3RhdXJhbnRbXCJpc19mYXZvcml0ZVwiXSAmJiByZXN0YXVyYW50W1wiaXNfZmF2b3JpdGVcIl0udG9TdHJpbmcoKSA9PT0gXCJ0cnVlXCIpID8gdHJ1ZSA6IGZhbHNlO1xuICBpZihyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSBcInRydWVcIiB8fCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSB7XG4gICAgZmF2QnRuLmlubmVySFRNTCA9ICdGYXZvcml0ZWQhJztcbiAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdob3RwaW5rJztcbiAgfSBlbHNlIHtcbiAgICBmYXZCdG4uaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvcml0ZSc7XG4gICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnZ3JleSc7XG4gIH1cbiAgZmF2QnRuLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIGB0b2dnbGUgZmF2b3JpdGVzIGZvcjogJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBgZmF2LWJ0bi0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoXCJkYXRhLXJlc3RhdXJhbnQtaWRcIiwgcmVzdGF1cmFudC5pZCk7XG5cbiAgZmF2QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2NsaWNrZWQgZmF2YnRuJyk7XG4gICAgREJIZWxwZXIudG9nZ2xlRmF2QnRuKHJlc3RhdXJhbnQuaWQpO1xuICB9KVxuXG5cbiAgbGkuYXBwZW5kKGZhdkJ0bik7XG5cbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBtb3JlLmNsYXNzTGlzdCA9IFwiYnV0dG9uIGJ1dHRvbi0tc3VjY2Vzc1wiO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcmVzdGF1cmFudC5uYW1lICsgcmVzdGF1cmFudC5uZWlnaGJvcmhvb2QgKyByZXN0YXVyYW50LmFkZHJlc3MgKyBcIlZpZXcgRGV0YWlsc1wiKTtcbiAgbW9yZS5vbmNsaWNrID0gKCkgPT4ge1xuICAgIGNvbnN0IHVybCA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gICAgd2luZG93LmxvY2F0aW9uID0gdXJsO1xuICB9XG4gIGxpLmFwcGVuZChtb3JlKTtcblxuICByZXR1cm4gbGlcbn1cblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBuZXdNYXApO1xuICAgIG1hcmtlci5vbihcImNsaWNrXCIsIG9uQ2xpY2spO1xuICAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci5vcHRpb25zLnVybDtcbiAgICB9XG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgfSk7XG59XG5cbiJdLCJzb3VyY2VSb290IjoiIn0=