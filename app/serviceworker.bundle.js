!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}({1:function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,s;const a=new WeakMap,c=new WeakMap,i=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||i.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(g(this),t,...n);return i.set(r,t.sort?t.sort():[t]),p(r)}:(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),p(a.get(this))}:function(...t){return p(e.apply(g(this),t))}}function h(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(c.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),r()},s=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});c.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(p(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&a.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=h(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function v(e,t,{blocked:n,upgrade:r,blocking:o}={}){const s=indexedDB.open(e,t),a=p(s);return r&&s.addEventListener("upgradeneeded",e=>{r(p(s.result),e.oldVersion,e.newVersion,p(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),o&&a.then(e=>e.addEventListener("versionchange",o)),a}n.d(t,"a",function(){return v});const b=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],w=new Map;function y(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return b.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),m.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&w.set(t,o),o}d=(e=>({get:(t,n,r)=>y(t,n)||e.get(t,n,r),has:(t,n)=>!!y(t,n)||e.has(t,n)}))(d)},12:function(e,t,n){"use strict";n.r(t);var r=n(1);const o=["static_cache-v5","images_cache-v"],s=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});self.addEventListener("install",e=>{e.waitUntil(caches.open("static_cache-v5").then(e=>e.addAll(["/","/app.bundle.js","/restaurant.bundle.js","/restaurant.html","/index.html","/src/rr-icon512.png"]).catch(e=>{console.log("error opening cache"+e)})))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>{Promise.all(e.map(e=>{if(!o.includes(e))return caches.delete(e)}))}))}),self.addEventListener("fetch",e=>{let t=new URL(e.request.url);if("1337"===t.port){let n=t.searchParams.get("restaurant_id")-0;return a(e,n)}u(e)});const a=(e,t)=>{"GET"!==e.request.method?e.respondWith(fetch(e.request)):e.request.url.indexOf("restaurants")>-1?c(e):(console.log("starting handling from reviews event"),i(e,t))},c=e=>{e.respondWith(s.then(e=>(console.log("starting from idb"),e.transaction("restaurants").objectStore("restaurants").getAll())).then(t=>(console.log(t),t.length&&t||(e=>new Promise(function(t,n){fetch(e.request).then(e=>e.json()).then(e=>{t(e)}).catch(e=>{console.log(e),n(e)})}))(e).then(e=>(console.log("fetched now storing"),s.then(t=>{let n=t.transaction("restaurants","readwrite"),r=n.objectStore("restaurants");return e.forEach(function(e){r.put(e)}),n.done}).then(()=>(console.log("stored restaurants, now returning"),e)))))).then(e=>(console.log(e),new Response(JSON.stringify(e)))).catch(e=>new Response("Error fetching data",{status:500})))},i=(e,t)=>{e.respondWith(s.then(e=>e.transaction("reviews").objectStore("reviews").index("restaurant_id").getAll(t)).then(t=>(console.log("serviceworker handle reviews"),console.log(t),t.length&&t||fetch(e.request).then(e=>e.json()).then(e=>(console.log("using serviceworker fetch"),console.log("starting to store reviews"),s.then(t=>{let n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return e.forEach(function(e){r.put(e)}),n.done}).then(()=>e))))).then(e=>(console.log(e),new Response(JSON.stringify(e)))).catch(e=>new Response("Error fetching data",{status:500})))},u=e=>{e.respondWith(caches.match(e.request).then(t=>t||fetch(e.request).then(t=>{let n=function(e){let t=["png","jpg","jpeg","svg","gif"],n=!1;for(let r of t)if(e.endsWith(r)){n=!0;break}return n}(e.request.url)?"images_cache-v":"static_cache-v5";return caches.open(n).then(n=>(n.put(e.request,t.clone()),t))}).catch(e=>new Response("Application is not connected to the internet",{status:404,statusText:"Application is not connected to the internet"}))))}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vY2h1bmsuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vYXBwL3N3LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiaW5zdGFuY2VPZkFueSIsImNvbnN0cnVjdG9ycyIsInNvbWUiLCJpZGJQcm94eWFibGVUeXBlcyIsImN1cnNvckFkdmFuY2VNZXRob2RzIiwiY3Vyc29yUmVxdWVzdE1hcCIsIldlYWtNYXAiLCJ0cmFuc2FjdGlvbkRvbmVNYXAiLCJ0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAiLCJ0cmFuc2Zvcm1DYWNoZSIsInJldmVyc2VUcmFuc2Zvcm1DYWNoZSIsImlkYlByb3h5VHJhcHMiLCJbb2JqZWN0IE9iamVjdF0iLCJ0YXJnZXQiLCJwcm9wIiwicmVjZWl2ZXIiLCJJREJUcmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlTmFtZXMiLCJ1bmRlZmluZWQiLCJvYmplY3RTdG9yZSIsIndyYXAiLCJoYXMiLCJ3cmFwRnVuY3Rpb24iLCJmdW5jIiwiSURCRGF0YWJhc2UiLCJ0cmFuc2FjdGlvbiIsInN0b3JlTmFtZXMiLCJhcmdzIiwidHgiLCJ1bndyYXAiLCJ0aGlzIiwic2V0Iiwic29ydCIsIklEQkN1cnNvciIsImFkdmFuY2UiLCJjb250aW51ZSIsImNvbnRpbnVlUHJpbWFyeUtleSIsImluY2x1ZGVzIiwiYXBwbHkiLCJ0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlIiwiZG9uZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidW5saXN0ZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY29tcGxldGUiLCJlcnJvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24iLCJJREJPYmplY3RTdG9yZSIsIklEQkluZGV4IiwiUHJveHkiLCJJREJSZXF1ZXN0IiwicmVxdWVzdCIsInByb21pc2UiLCJzdWNjZXNzIiwicmVzdWx0IiwidGhlbiIsInByb21pc2lmeVJlcXVlc3QiLCJuZXdWYWx1ZSIsIm9wZW5EQiIsInZlcnNpb24iLCJibG9ja2VkIiwidXBncmFkZSIsImJsb2NraW5nIiwiaW5kZXhlZERCIiwib3BlbiIsIm9wZW5Qcm9taXNlIiwiZXZlbnQiLCJvbGRWZXJzaW9uIiwibmV3VmVyc2lvbiIsImRiIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsInJlYWRNZXRob2RzIiwid3JpdGVNZXRob2RzIiwiY2FjaGVkTWV0aG9kcyIsIk1hcCIsImdldE1ldGhvZCIsInRhcmdldEZ1bmNOYW1lIiwicmVwbGFjZSIsInVzZUluZGV4IiwibWV0aG9kIiwic3RvcmVOYW1lIiwic3RvcmUiLCJpbmRleCIsInNoaWZ0Iiwib2xkVHJhcHMiLCJjYWxsYmFjayIsImlkYl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiYWxsQ2FjaGVzIiwiZGJQcm9taXNlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJhdXRvSW5jcmVtZW50Iiwic2VsZiIsIndhaXRVbnRpbCIsImNhY2hlcyIsImNhY2hlIiwiYWRkQWxsIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwia2V5cyIsImNhY2hlTmFtZXMiLCJhbGwiLCJtYXAiLCJkZWxldGUiLCJjaGVja1VybCIsIlVSTCIsInVybCIsInBvcnQiLCJpZCIsInNlYXJjaFBhcmFtcyIsImhhbmRsZUFKQVhFdmVudCIsImhhbmRsZU5vbkFKQVhFdmVudCIsInJlc3BvbmRXaXRoIiwiZmV0Y2giLCJpbmRleE9mIiwiaGFuZGxlUmVzdGF1cmFudEV2ZW50cyIsImhhbmRsZVJldmlld3NFdmVudHMiLCJnZXRBbGwiLCJkYXRhIiwibGVuZ3RoIiwicmVzcCIsImpzb24iLCJnZXRSZXN0YXVyYW50cyIsInJlc3RhdXJhbnRzIiwiZm9yRWFjaCIsInJlc3RhdXJhbnQiLCJwdXQiLCJmaW5hbFJlc3BvbnNlIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhdHVzIiwiZmV0Y2hSZXNwb25zZSIsInJldmlld3MiLCJyZXZpZXciLCJtYXRjaCIsInJlc3BvbnNlIiwidXNlQ2FjaGUiLCJpbWdUeXBlcyIsImlzSW1hZ2UiLCJ0eXBlIiwiZW5kc1dpdGgiLCJpc0ltYWdlVVJMIiwiY2xvbmUiLCJzdGF0dXNUZXh0Il0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxFQUFBLFNBQUFBLEdBQWdILE9BQUFOLEVBQUFNLElBQXFCQyxLQUFBLEtBQUFELElBQ3JJLE9BQUFGLEdBSUF6QixFQUFBNkIsRUFBQSxTQUFBMUIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBcUIsV0FDQSxXQUEyQixPQUFBckIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQWlCLEVBQUFDLEdBQXNELE9BQUFqQixPQUFBa0IsVUFBQUMsZUFBQTFCLEtBQUF1QixFQUFBQyxJQUd0RC9CLEVBQUFrQyxFQUFBLEdBSUFsQyxJQUFBbUMsRUFBQSxxQ0NsRkEsTUFBQUMsRUFBQSxDQUFBTixFQUFBTyxNQUFBQyxLQUFBN0IsR0FBQXFCLGFBQUFyQixHQUVBLElBQUE4QixFQUNBQyxFQWNBLE1BQUFDLEVBQUEsSUFBQUMsUUFDQUMsRUFBQSxJQUFBRCxRQUNBRSxFQUFBLElBQUFGLFFBQ0FHLEVBQUEsSUFBQUgsUUFDQUksRUFBQSxJQUFBSixRQXVEQSxJQUFBSyxFQUFBLENBQ0FDLElBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsR0FBQUYsYUFBQUcsZUFBQSxDQUVBLFlBQUFGLEVBQ0EsT0FBQVAsRUFBQTFCLElBQUFnQyxHQUVBLHdCQUFBQyxFQUNBLE9BQUFELEVBQUFJLGtCQUFBVCxFQUFBM0IsSUFBQWdDLEdBR0EsYUFBQUMsRUFDQSxPQUFBQyxFQUFBRSxpQkFBQSxRQUNBQyxFQUFBSCxFQUFBSSxZQUFBSixFQUFBRSxpQkFBQSxJQUlBLE9BQUFHLEVBQUFQLEVBQUFDLEtBRUFPLElBQUEsQ0FBQVIsRUFBQUMsSUFDQUQsYUFBQUcsaUJBQUEsU0FBQUYsR0FBQSxVQUFBQSxJQUVBQSxLQUFBRCxHQU1BLFNBQUFTLEVBQUFDLEdBSUEsT0FBQUEsSUFBQUMsWUFBQTVCLFVBQUE2QixhQUNBLHFCQUFBVCxlQUFBcEIsVUFDQSxTQUFBOEIsS0FBQUMsR0FDQSxNQUFBQyxFQUFBTCxFQUFBcEQsS0FBQTBELEVBQUFDLE1BQUFKLEtBQUFDLEdBRUEsT0FEQW5CLEVBQUF1QixJQUFBSCxFQUFBRixFQUFBTSxLQUFBTixFQUFBTSxPQUFBLENBQUFOLElBQ0FOLEVBQUFRLEtBdEdBeEIsTUFBQSxDQUNBNkIsVUFBQXJDLFVBQUFzQyxRQUNBRCxVQUFBckMsVUFBQXVDLFNBQ0FGLFVBQUFyQyxVQUFBd0Msc0JBMkdBQyxTQUFBZCxHQUNBLFlBQUFJLEdBSUEsT0FEQUosRUFBQWUsTUFBQVQsRUFBQUMsTUFBQUgsR0FDQVAsRUFBQWYsRUFBQXhCLElBQUFpRCxRQUdBLFlBQUFILEdBR0EsT0FBQVAsRUFBQUcsRUFBQWUsTUFBQVQsRUFBQUMsTUFBQUgsS0FHQSxTQUFBWSxFQUFBdEQsR0FDQSx5QkFBQUEsRUFDQXFDLEVBQUFyQyxJQUdBQSxhQUFBK0IsZ0JBekZBLFNBQUFZLEdBRUEsR0FBQXJCLEVBQUFjLElBQUFPLEdBQ0EsT0FDQSxNQUFBWSxFQUFBLElBQUFDLFFBQUEsQ0FBQUMsRUFBQUMsS0FDQSxNQUFBQyxFQUFBLEtBQ0FoQixFQUFBaUIsb0JBQUEsV0FBQUMsR0FDQWxCLEVBQUFpQixvQkFBQSxRQUFBRSxHQUNBbkIsRUFBQWlCLG9CQUFBLFFBQUFFLElBRUFELEVBQUEsS0FDQUosSUFDQUUsS0FFQUcsRUFBQSxLQUNBSixFQUFBZixFQUFBbUIsT0FDQUgsS0FFQWhCLEVBQUFvQixpQkFBQSxXQUFBRixHQUNBbEIsRUFBQW9CLGlCQUFBLFFBQUFELEdBQ0FuQixFQUFBb0IsaUJBQUEsUUFBQUQsS0FHQXhDLEVBQUF3QixJQUFBSCxFQUFBWSxHQW1FQVMsQ0FBQWhFLEdBQ0FlLEVBQUFmLEVBeElBa0IsSUFDQUEsRUFBQSxDQUFBcUIsWUFBQTBCLGVBQUFDLFNBQUFsQixVQUFBakIsa0JBd0lBLElBQUFvQyxNQUFBbkUsRUFBQTBCLEdBRUExQixHQUVBLFNBQUFtQyxFQUFBbkMsR0FHQSxHQUFBQSxhQUFBb0UsV0FDQSxPQWpJQSxTQUFBQyxHQUNBLE1BQUFDLEVBQUEsSUFBQWQsUUFBQSxDQUFBQyxFQUFBQyxLQUNBLE1BQUFDLEVBQUEsS0FDQVUsRUFBQVQsb0JBQUEsVUFBQVcsR0FDQUYsRUFBQVQsb0JBQUEsUUFBQUUsSUFFQVMsRUFBQSxLQUNBZCxFQUFBdEIsRUFBQWtDLEVBQUFHLFNBQ0FiLEtBRUFHLEVBQUEsS0FDQUosRUFBQVcsRUFBQVAsT0FDQUgsS0FFQVUsRUFBQU4saUJBQUEsVUFBQVEsR0FDQUYsRUFBQU4saUJBQUEsUUFBQUQsS0FZQSxPQVZBUSxFQUFBRyxLQUFBekUsSUFHQUEsYUFBQWdELFdBQ0E1QixFQUFBMEIsSUFBQTlDLEVBQUFxRSxLQUtBNUMsRUFBQXFCLElBQUF3QixFQUFBRCxHQUNBQyxFQXNHQUksQ0FBQTFFLEdBR0EsR0FBQXdCLEVBQUFZLElBQUFwQyxHQUNBLE9BQUF3QixFQUFBNUIsSUFBQUksR0FDQSxNQUFBMkUsRUFBQXJCLEVBQUF0RCxHQU9BLE9BSkEyRSxJQUFBM0UsSUFDQXdCLEVBQUFzQixJQUFBOUMsRUFBQTJFLEdBQ0FsRCxFQUFBcUIsSUFBQTZCLEVBQUEzRSxJQUVBMkUsRUFFQSxNQUFBL0IsRUFBQTVDLEdBQUF5QixFQUFBN0IsSUFBQUksR0MzSkEsU0FBQTRFLEVBQUF0RixFQUFBdUYsR0FBQUMsUUFBZ0NBLEVBQUFDLFVBQUFDLFlBQTZCLElBQzdELE1BQUFYLEVBQUFZLFVBQUFDLEtBQUE1RixFQUFBdUYsR0FDQU0sRUFBd0JoRCxFQUFJa0MsR0FVNUIsT0FUQVUsR0FDQVYsRUFBQU4saUJBQUEsZ0JBQUFxQixJQUNBTCxFQUFvQjVDLEVBQUlrQyxFQUFBRyxRQUFBWSxFQUFBQyxXQUFBRCxFQUFBRSxXQUFzRG5ELEVBQUlrQyxFQUFBN0IsZ0JBR2xGc0MsR0FDQVQsRUFBQU4saUJBQUEsY0FBQWUsS0FDQUUsR0FDQUcsRUFBQVYsS0FBQWMsS0FBQXhCLGlCQUFBLGdCQUFBaUIsSUFDQUcsRUF0QkF4RyxFQUFBVSxFQUFBbUcsRUFBQSxzQkFBQVosSUFvQ0EsTUFBQWEsRUFBQSwrQ0FDQUMsRUFBQSwrQkFDQUMsRUFBQSxJQUFBQyxJQUNBLFNBQUFDLEVBQUFqRSxFQUFBQyxHQUNBLEtBQUFELGFBQUFXLGNBQ0FWLEtBQUFELEdBQ0EsaUJBQUFDLEVBQ0EsT0FDQSxHQUFBOEQsRUFBQS9GLElBQUFpQyxHQUNBLE9BQUE4RCxFQUFBL0YsSUFBQWlDLEdBQ0EsTUFBQWlFLEVBQUFqRSxFQUFBa0UsUUFBQSxpQkFDQUMsRUFBQW5FLElBQUFpRSxFQUVBLEtBQUFBLEtBQUFFLEVBQUE5QixTQUFBRCxnQkFBQXRELFdBQ0EsT0FFQSxJQUFBc0YsRUFrQkEsT0FqQkFSLEVBQUFyQyxTQUFBMEMsS0FDQUcsRUFBQSxTQUFBQyxLQUFBeEQsR0FDQSxJQUFBZCxFQUFBaUIsS0FBQUwsWUFBQTBELEdBQUFDLE1BR0EsT0FGQUgsSUFDQXBFLElBQUF3RSxNQUFBMUQsRUFBQTJELFVBQ0F6RSxFQUFBa0UsTUFBQXBELEtBR0FnRCxFQUFBdEMsU0FBQTBDLEtBQ0FHLEVBQUEsU0FBQUMsS0FBQXhELEdBQ0EsTUFBQUMsRUFBQUUsS0FBQUwsWUFBQTBELEVBQUEsYUFFQSxPQURBdkQsRUFBQXdELE1BQUFMLE1BQUFwRCxHQUNBQyxFQUFBWSxPQUdBMEMsR0FDQU4sRUFBQTdDLElBQUFqQixFQUFBb0UsR0FDQUEsRURnQ0F2RSxFQzlCUTRFLEtBQUEsQ0FDUjFHLElBQUEsQ0FBQWdDLEVBQUFDLEVBQUFDLElBQUErRCxFQUFBakUsRUFBQUMsSUFBQXlFLEVBQUExRyxJQUFBZ0MsRUFBQUMsRUFBQUMsR0FDQU0sSUFBQSxDQUFBUixFQUFBQyxNQUFBZ0UsRUFBQWpFLEVBQUFDLElBQUF5RSxFQUFBbEUsSUFBQVIsRUFBQUMsS0Q0QkEwRSxDQUFBN0Usb0NFdEdBL0MsRUFBQWtCLEVBQUEyRixHQUFBLElBQUFnQixFQUFBN0gsRUFBQSxTQUdNOEgsRUFBWSxDQUZJLGtCQUNBLGtCQVFoQkMsRUFBWTlCLFlBQU8sUUFBUyxFQUFHLENBQ25DRyxRQUFRUSxFQUFJRixHQUNWLE9BQVFBLEdBQ04sS0FBSyxFQUNXRSxFQUFHb0Isa0JBQWtCLGNBQWUsQ0FBRUMsUUFBUyxPQUN2REMsWUFBWSxLQUFNLE1BQzFCLEtBQUssRUFDa0J0QixFQUFHb0Isa0JBQWtCLFVBQVcsQ0FDbkRDLFFBQVMsS0FDVEUsZUFBZSxJQUVKRCxZQUFZLGdCQUFpQixpQkFDNUMsS0FBSyxFQUNrQnRCLEVBQUdvQixrQkFBa0IsVUFBVyxDQUNuREMsUUFBUyxLQUNURSxlQUFlLFFBNEJ6QkMsS0FBS2hELGlCQUFpQixVQUFXcUIsSUFDL0JBLEVBQU00QixVQUNKQyxPQUFPL0IsS0F0RFcsbUJBc0RRVCxLQUFLeUMsR0FDdEJBLEVBQU1DLE9BQU8sQ0FDbEIsSUFDQSxpQkFDQSx3QkFDQSxtQkFDQSxjQUNBLHdCQUNDQyxNQUFNdEQsSUFDUHVELFFBQVFDLElBQUksc0JBQXdCeEQsU0FNNUNpRCxLQUFLaEQsaUJBQWlCLFdBQVlxQixJQUNoQ0EsRUFBTTRCLFVBQ0pDLE9BQU9NLE9BQU85QyxLQUFLK0MsSUFDakJoRSxRQUFRaUUsSUFDTEQsRUFBV0UsSUFBSVIsSUFDZCxJQUFJVCxFQUFVckQsU0FBUzhELEdBQ3JCLE9BQU9ELE9BQU9VLE9BQU9ULFdBU2pDSCxLQUFLaEQsaUJBQWlCLFFBQVNxQixJQUM3QixJQUFJd0MsRUFBVyxJQUFJQyxJQUFJekMsRUFBTWYsUUFBUXlELEtBQ3JDLEdBQXNCLFNBQWxCRixFQUFTRyxLQUFpQixDQUM1QixJQUFJQyxFQUFLSixFQUFTSyxhQUFhckksSUFBSSxpQkFBbUIsRUFDdEQsT0FBT3NJLEVBQWdCOUMsRUFBTzRDLEdBRTlCRyxFQUFtQi9DLEtBSXZCLE1BQU04QyxFQUFrQixDQUFDOUMsRUFBTzRDLEtBRUYsUUFBekI1QyxFQUFNZixRQUFRNEIsT0FDZmIsRUFBTWdELFlBQWFDLE1BQU1qRCxFQUFNZixVQUN2QmUsRUFBTWYsUUFBUXlELElBQUlRLFFBQVEsZ0JBQWtCLEVBQ3BEQyxFQUF1Qm5ELElBRXZCaUMsUUFBUUMsSUFBSSx3Q0FDWmtCLEVBQW9CcEQsRUFBTzRDLEtBSXpCTyxFQUEwQm5ELElBQzlCQSxFQUFNZ0QsWUFDRjFCLEVBQVVqQyxLQUFNYyxJQUNkOEIsUUFBUUMsSUFBSSxxQkFDTC9CLEVBQ0ovQyxZQUFZLGVBQ1pOLFlBQVksZUFDWnVHLFdBQ0ZoRSxLQUFLaUUsSUFDTnJCLFFBQVFDLElBQUlvQixHQUNIQSxFQUFLQyxRQUFVRCxHQXRGUHRELElBQ2QsSUFBSTVCLFFBQVEsU0FBU0MsRUFBU0MsR0FDbkMyRSxNQUFNakQsRUFBTWYsU0FDWEksS0FBS21FLEdBQVFBLEVBQUtDLFFBQ2xCcEUsS0FBS29FLElBQVVwRixFQUFRb0YsS0FDdkJ6QixNQUFNdEQsSUFDTHVELFFBQVFDLElBQUl4RCxHQUNaSixFQUFPSSxPQStFMEJnRixDQUFlMUQsR0FDN0NYLEtBQU1zRSxJQUNMMUIsUUFBUUMsSUFBSSx1QkFDTFosRUFBVWpDLEtBQUtjLElBQ3BCLElBQUk1QyxFQUFLNEMsRUFBRy9DLFlBQVksY0FBZSxhQUNuQzJELEVBQVF4RCxFQUFHVCxZQUFZLGVBSTNCLE9BSEE2RyxFQUFZQyxRQUFRLFNBQVNDLEdBQzNCOUMsRUFBTStDLElBQUlELEtBRUx0RyxFQUFHWSxPQUNUa0IsS0FBTSxLQUNQNEMsUUFBUUMsSUFBSSxxQ0FDTHlCLFFBS1p0RSxLQUFLMEUsSUFDSjlCLFFBQVFDLElBQUk2QixHQUNMLElBQUlDLFNBQVNDLEtBQUtDLFVBQVVILE1BQ2xDL0IsTUFBTXRELEdBQ0EsSUFBSXNGLFNBQVMsc0JBQXVCLENBQUNHLE9BQVEsU0FLeERmLEVBQXNCLENBQUNwRCxFQUFPNEMsS0FDbEM1QyxFQUFNZ0QsWUFDSjFCLEVBQVVqQyxLQUFLYyxHQUNOQSxFQUNKL0MsWUFBWSxXQUNaTixZQUFZLFdBQ1prRSxNQUFNLGlCQUNOcUMsT0FBT1QsSUFDVHZELEtBQU1pRSxJQUNQckIsUUFBUUMsSUFBSSxnQ0FDWkQsUUFBUUMsSUFBSW9CLEdBQ0pBLEVBQUtDLFFBQVVELEdBQVNMLE1BQU1qRCxFQUFNZixTQUN6Q0ksS0FBSytFLEdBQ0dBLEVBQWNYLFFBRXRCcEUsS0FBTWdGLElBQ0xwQyxRQUFRQyxJQUFJLDZCQUNaRCxRQUFRQyxJQUFJLDZCQUNMWixFQUFVakMsS0FBS2MsSUFDcEIsSUFBSTVDLEVBQUs0QyxFQUFHL0MsWUFBWSxVQUFXLGFBQy9CMkQsRUFBUXhELEVBQUdULFlBQVksV0FJM0IsT0FIQXVILEVBQVFULFFBQVEsU0FBU1UsR0FDdkJ2RCxFQUFNK0MsSUFBSVEsS0FFTC9HLEVBQUdZLE9BRVhrQixLQUFNLElBQU1nRixPQUVoQmhGLEtBQUswRSxJQUNOOUIsUUFBUUMsSUFBSTZCLEdBQ0wsSUFBSUMsU0FBU0MsS0FBS0MsVUFBVUgsTUFDbEMvQixNQUFNdEQsR0FDQSxJQUFJc0YsU0FBUyxzQkFBdUIsQ0FBQ0csT0FBUSxTQUlwRHBCLEVBQXNCL0MsSUFJMUJBLEVBQU1nRCxZQUNKbkIsT0FBTzBDLE1BQU12RSxFQUFNZixTQUFTSSxLQUFLbUYsR0FDdkJBLEdBQVl2QixNQUFNakQsRUFBTWYsU0FBU0ksS0FBSytFLElBQzVDLElBQUlLLEVBL0laLFNBQW9CL0IsR0FDbEIsSUFBSWdDLEVBQVcsQ0FBQyxNQUFPLE1BQU8sT0FBUSxNQUFPLE9BQ3pDQyxHQUFVLEVBQ2QsSUFBSyxJQUFJQyxLQUFRRixFQUNmLEdBQUloQyxFQUFJbUMsU0FBU0QsR0FBTyxDQUFFRCxHQUFVLEVBQU0sTUFFNUMsT0FBT0EsRUF5SWNHLENBQVc5RSxFQUFNZixRQUFReUQsS0F4TDFCLGlCQURBLGtCQTBMZCxPQUFPYixPQUNKL0IsS0FBSzJFLEdBQ0xwRixLQUFLeUMsSUFDSkEsRUFBTWdDLElBQUk5RCxFQUFNZixRQUFTbUYsRUFBY1csU0FDaENYLE1BRVZwQyxNQUFNdEQsR0FDQSxJQUFJc0YsU0FBUywrQ0FBZ0QsQ0FDbEVHLE9BQVEsSUFDUmEsV0FBWSIsImZpbGUiOiJzZXJ2aWNld29ya2VyLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxMik7XG4iLCJjb25zdCBpbnN0YW5jZU9mQW55ID0gKG9iamVjdCwgY29uc3RydWN0b3JzKSA9PiBjb25zdHJ1Y3RvcnMuc29tZShjID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XHJcbmxldCBjdXJzb3JBZHZhbmNlTWV0aG9kcztcclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xyXG4gICAgcmV0dXJuIGlkYlByb3h5YWJsZVR5cGVzIHx8XHJcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW0lEQkRhdGFiYXNlLCBJREJPYmplY3RTdG9yZSwgSURCSW5kZXgsIElEQkN1cnNvciwgSURCVHJhbnNhY3Rpb25dKTtcclxufVxyXG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cclxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XHJcbiAgICByZXR1cm4gY3Vyc29yQWR2YW5jZU1ldGhvZHMgfHwgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gW1xyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuYWR2YW5jZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LFxyXG4gICAgXSk7XHJcbn1cclxuY29uc3QgY3Vyc29yUmVxdWVzdE1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uRG9uZU1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUod3JhcChyZXF1ZXN0LnJlc3VsdCkpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpO1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIHByb21pc2UudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAvLyBTaW5jZSBjdXJzb3JpbmcgcmV1c2VzIHRoZSBJREJSZXF1ZXN0ICgqc2lnaCopLCB3ZSBjYWNoZSBpdCBmb3IgbGF0ZXIgcmV0cmlldmFsXHJcbiAgICAgICAgLy8gKHNlZSB3cmFwRnVuY3Rpb24pLlxyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xyXG4gICAgICAgICAgICBjdXJzb3JSZXF1ZXN0TWFwLnNldCh2YWx1ZSwgcmVxdWVzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXHJcbiAgICAvLyBpcyBiZWNhdXNlIHdlIGNyZWF0ZSBtYW55IHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdC5cclxuICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxufVxyXG5mdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHtcclxuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxyXG4gICAgaWYgKHRyYW5zYWN0aW9uRG9uZU1hcC5oYXModHgpKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cclxuICAgIHRyYW5zYWN0aW9uRG9uZU1hcC5zZXQodHgsIGRvbmUpO1xyXG59XHJcbmxldCBpZGJQcm94eVRyYXBzID0ge1xyXG4gICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdkb25lJylcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvYmplY3RTdG9yZU5hbWVzJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBNYWtlIHR4LnN0b3JlIHJldHVybiB0aGUgb25seSBzdG9yZSBpbiB0aGUgdHJhbnNhY3Rpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbWFueS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdID9cclxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQgOiByZWNlaXZlci5vYmplY3RTdG9yZShyZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbHNlIHRyYW5zZm9ybSB3aGF0ZXZlciB3ZSBnZXQgYmFjay5cclxuICAgICAgICByZXR1cm4gd3JhcCh0YXJnZXRbcHJvcF0pO1xyXG4gICAgfSxcclxuICAgIGhhcyh0YXJnZXQsIHByb3ApIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24gJiYgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSlcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xyXG4gICAgfSxcclxufTtcclxuZnVuY3Rpb24gYWRkVHJhcHMoY2FsbGJhY2spIHtcclxuICAgIGlkYlByb3h5VHJhcHMgPSBjYWxsYmFjayhpZGJQcm94eVRyYXBzKTtcclxufVxyXG5mdW5jdGlvbiB3cmFwRnVuY3Rpb24oZnVuYykge1xyXG4gICAgLy8gRHVlIHRvIGV4cGVjdGVkIG9iamVjdCBlcXVhbGl0eSAod2hpY2ggaXMgZW5mb3JjZWQgYnkgdGhlIGNhY2hpbmcgaW4gYHdyYXBgKSwgd2VcclxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cclxuICAgIC8vIEVkZ2UgZG9lc24ndCBzdXBwb3J0IG9iamVjdFN0b3JlTmFtZXMgKGJvb28pLCBzbyB3ZSBwb2x5ZmlsbCBpdCBoZXJlLlxyXG4gICAgaWYgKGZ1bmMgPT09IElEQkRhdGFiYXNlLnByb3RvdHlwZS50cmFuc2FjdGlvbiAmJlxyXG4gICAgICAgICdvYmplY3RTdG9yZU5hbWVzJyBpbiBJREJUcmFuc2FjdGlvbi5wcm90b3R5cGUpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHN0b3JlTmFtZXMsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBmdW5jLmNhbGwodW53cmFwKHRoaXMpLCBzdG9yZU5hbWVzLCAuLi5hcmdzKTtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcCh0eCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8vIEN1cnNvciBtZXRob2RzIGFyZSBzcGVjaWFsLCBhcyB0aGUgYmVoYXZpb3VyIGlzIGEgbGl0dGxlIG1vcmUgZGlmZmVyZW50IHRvIHN0YW5kYXJkIElEQi4gSW5cclxuICAgIC8vIElEQiwgeW91IGFkdmFuY2UgdGhlIGN1cnNvciBhbmQgd2FpdCBmb3IgYSBuZXcgJ3N1Y2Nlc3MnIG9uIHRoZSBJREJSZXF1ZXN0IHRoYXQgZ2F2ZSB5b3UgdGhlXHJcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxyXG4gICAgLy8gd2l0aCByZWFsIHByb21pc2VzLCBzbyBlYWNoIGFkdmFuY2UgbWV0aG9kcyByZXR1cm5zIGEgbmV3IHByb21pc2UgZm9yIHRoZSBjdXJzb3Igb2JqZWN0LCBvclxyXG4gICAgLy8gdW5kZWZpbmVkIGlmIHRoZSBlbmQgb2YgdGhlIGN1cnNvciBoYXMgYmVlbiByZWFjaGVkLlxyXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgICAgICBmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cmFwKGN1cnNvclJlcXVlc3RNYXAuZ2V0KHRoaXMpKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuXHJcbiAgICAgICAgcmV0dXJuIHdyYXAoZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcclxuICAgICAgICByZXR1cm4gd3JhcEZ1bmN0aW9uKHZhbHVlKTtcclxuICAgIC8vIFRoaXMgZG9lc24ndCByZXR1cm4sIGl0IGp1c3QgY3JlYXRlcyBhICdkb25lJyBwcm9taXNlIGZvciB0aGUgdHJhbnNhY3Rpb24sXHJcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pXHJcbiAgICAgICAgY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHZhbHVlKTtcclxuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcclxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBpZGJQcm94eVRyYXBzKTtcclxuICAgIC8vIFJldHVybiB0aGUgc2FtZSB2YWx1ZSBiYWNrIGlmIHdlJ3JlIG5vdCBnb2luZyB0byB0cmFuc2Zvcm0gaXQuXHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuZnVuY3Rpb24gd3JhcCh2YWx1ZSkge1xyXG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXHJcbiAgICAvLyBJREIgaXMgd2VpcmQgYW5kIGEgc2luZ2xlIElEQlJlcXVlc3QgY2FuIHlpZWxkIG1hbnkgcmVzcG9uc2VzLCBzbyB0aGVzZSBjYW4ndCBiZSBjYWNoZWQuXHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJSZXF1ZXN0KVxyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcclxuICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgdHJhbnNmb3JtZWQgdGhpcyB2YWx1ZSBiZWZvcmUsIHJldXNlIHRoZSB0cmFuc2Zvcm1lZCB2YWx1ZS5cclxuICAgIC8vIFRoaXMgaXMgZmFzdGVyLCBidXQgaXQgYWxzbyBwcm92aWRlcyBvYmplY3QgZXF1YWxpdHkuXHJcbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcclxuICAgICAgICByZXR1cm4gdHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcclxuICAgIGNvbnN0IG5ld1ZhbHVlID0gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSk7XHJcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cclxuICAgIC8vIFRoZXNlIG1heSBiZSBwcmltaXRpdmUgdHlwZXMsIHNvIHRoZXkgY2FuJ3QgYmUgV2Vha01hcCBrZXlzLlxyXG4gICAgaWYgKG5ld1ZhbHVlICE9PSB2YWx1ZSkge1xyXG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xyXG4gICAgICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQobmV3VmFsdWUsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXdWYWx1ZTtcclxufVxyXG5jb25zdCB1bndyYXAgPSAodmFsdWUpID0+IHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xuXG5leHBvcnQgeyB3cmFwIGFzIGEsIGFkZFRyYXBzIGFzIGIsIGluc3RhbmNlT2ZBbnkgYXMgYywgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlIGFzIGQsIHVud3JhcCBhcyBlIH07XG4iLCJpbXBvcnQgeyBhIGFzIHdyYXAsIGIgYXMgYWRkVHJhcHMgfSBmcm9tICcuL2NodW5rLmpzJztcbmV4cG9ydCB7IGUgYXMgdW53cmFwLCBhIGFzIHdyYXAgfSBmcm9tICcuL2NodW5rLmpzJztcblxuLyoqXHJcbiAqIE9wZW4gYSBkYXRhYmFzZS5cclxuICpcclxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgZGF0YWJhc2UuXHJcbiAqIEBwYXJhbSB2ZXJzaW9uIFNjaGVtYSB2ZXJzaW9uLlxyXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxyXG4gKi9cclxuZnVuY3Rpb24gb3BlbkRCKG5hbWUsIHZlcnNpb24sIHsgYmxvY2tlZCwgdXBncmFkZSwgYmxvY2tpbmcgfSA9IHt9KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XHJcbiAgICBjb25zdCBvcGVuUHJvbWlzZSA9IHdyYXAocmVxdWVzdCk7XHJcbiAgICBpZiAodXBncmFkZSkge1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB1cGdyYWRlKHdyYXAocmVxdWVzdC5yZXN1bHQpLCBldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCB3cmFwKHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICBpZiAoYmxvY2tpbmcpXHJcbiAgICAgICAgb3BlblByb21pc2UudGhlbihkYiA9PiBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgYmxvY2tpbmcpKTtcclxuICAgIHJldHVybiBvcGVuUHJvbWlzZTtcclxufVxyXG4vKipcclxuICogRGVsZXRlIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShuYW1lKTtcclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICByZXR1cm4gd3JhcChyZXF1ZXN0KS50aGVuKCgpID0+IHVuZGVmaW5lZCk7XHJcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcclxuY29uc3Qgd3JpdGVNZXRob2RzID0gWydwdXQnLCAnYWRkJywgJ2RlbGV0ZScsICdjbGVhciddO1xyXG5jb25zdCBjYWNoZWRNZXRob2RzID0gbmV3IE1hcCgpO1xyXG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XHJcbiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBJREJEYXRhYmFzZSAmJlxyXG4gICAgICAgICEocHJvcCBpbiB0YXJnZXQpICYmXHJcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBpZiAoY2FjaGVkTWV0aG9kcy5nZXQocHJvcCkpXHJcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xyXG4gICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7XHJcbiAgICBjb25zdCB1c2VJbmRleCA9IHByb3AgIT09IHRhcmdldEZ1bmNOYW1lO1xyXG4gICAgLy8gQmFpbCBpZiB0aGUgdGFyZ2V0IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHRhcmdldC4gRWcsIGdldEFsbCBpc24ndCBpbiBFZGdlLlxyXG4gICAgaWYgKCEodGFyZ2V0RnVuY05hbWUgaW4gKHVzZUluZGV4ID8gSURCSW5kZXggOiBJREJPYmplY3RTdG9yZSkucHJvdG90eXBlKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBtZXRob2Q7XHJcbiAgICBpZiAocmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBsZXQgdGFyZ2V0ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUpLnN0b3JlO1xyXG4gICAgICAgICAgICBpZiAodXNlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmICh3cml0ZU1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIHR4LnN0b3JlW3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHR4LmRvbmU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmIChtZXRob2QpXHJcbiAgICAgICAgY2FjaGVkTWV0aG9kcy5zZXQocHJvcCwgbWV0aG9kKTtcclxuICAgIHJldHVybiBtZXRob2Q7XHJcbn1cclxuYWRkVHJhcHMob2xkVHJhcHMgPT4gKHtcclxuICAgIGdldDogKHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpID0+IGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSxcclxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcclxufSkpO1xuXG5leHBvcnQgeyBvcGVuREIsIGRlbGV0ZURCIH07XG4iLCJjb25zdCBjYWNoZVZlcnNpb24gPSAnNSc7XG5jb25zdCBTVEFUSUNfQ0FDSEUgPSBgc3RhdGljX2NhY2hlLXYke2NhY2hlVmVyc2lvbn1gO1xuY29uc3QgSU1BR0VTX0NBQ0hFID0gYGltYWdlc19jYWNoZS12YDtcbmNvbnN0IGFsbENhY2hlcyA9IFtcbiAgU1RBVElDX0NBQ0hFLFxuICBJTUFHRVNfQ0FDSEVcbl07XG5cbmltcG9ydCB7IG9wZW5EQiwgZGVsZXRlREIsIHdyYXAsIHVud3JhcCB9IGZyb20gJ2lkYic7XG5cbmNvbnN0IGRiUHJvbWlzZSA9IG9wZW5EQigncnItZGInLCAzLCB7XG4gIHVwZ3JhZGUoZGIsIG9sZFZlcnNpb24pIHtcbiAgICBzd2l0Y2ggKG9sZFZlcnNpb24pIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7IGtleVBhdGg6ICdpZCcgfSk7XG4gICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjb25zdCByZXZpZXdzU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleChcInJlc3RhdXJhbnRfaWRcIiwgXCJyZXN0YXVyYW50X2lkXCIpO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjb25zdCBwZW5kaW5nU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncGVuZGluZycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG59KTtcblxuIGNvbnN0IGdldFJlc3RhdXJhbnRzID0gKGV2ZW50KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgZmV0Y2goZXZlbnQucmVxdWVzdClcbiAgICAgIC50aGVuKHJlc3AgPT4gcmVzcC5qc29uKCkpXG4gICAgICAudGhlbihqc29uID0+IHsgcmVzb2x2ZShqc29uKTsgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbmZ1bmN0aW9uIGlzSW1hZ2VVUkwodXJsKSB7XG4gIGxldCBpbWdUeXBlcyA9IFtcInBuZ1wiLCBcImpwZ1wiLCBcImpwZWdcIiwgXCJzdmdcIiwgXCJnaWZcIl07XG4gIGxldCBpc0ltYWdlID0gZmFsc2U7XG4gIGZvciAobGV0IHR5cGUgb2YgaW1nVHlwZXMpIHtcbiAgICBpZiAodXJsLmVuZHNXaXRoKHR5cGUpKSB7IGlzSW1hZ2UgPSB0cnVlOyBicmVha307XG4gIH1cbiAgcmV0dXJuIGlzSW1hZ2U7XG59XG5cblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge1xuICBldmVudC53YWl0VW50aWwoXG4gICAgY2FjaGVzLm9wZW4oU1RBVElDX0NBQ0hFKS50aGVuKGNhY2hlID0+IHtcbiAgICAgIHJldHVybiBjYWNoZS5hZGRBbGwoW1xuICAgICAgICAnLycsXG4gICAgICAgICcvYXBwLmJ1bmRsZS5qcycsXG4gICAgICAgICcvcmVzdGF1cmFudC5idW5kbGUuanMnLFxuICAgICAgICAnL3Jlc3RhdXJhbnQuaHRtbCcsXG4gICAgICAgICcvaW5kZXguaHRtbCcsXG4gICAgICAgICcvc3JjL3JyLWljb241MTIucG5nJ1xuICAgICAgXSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3Igb3BlbmluZyBjYWNoZScgKyBlcnJvcik7XG4gICAgICB9KTtcbiAgICB9KVxuICApO1xufSk7XG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7XG4gIGV2ZW50LndhaXRVbnRpbChcbiAgICBjYWNoZXMua2V5cygpLnRoZW4oY2FjaGVOYW1lcyA9PiB7XG4gICAgICBQcm9taXNlLmFsbChcbiAgICAgICAgIGNhY2hlTmFtZXMubWFwKGNhY2hlID0+IHtcbiAgICAgICAgICBpZighYWxsQ2FjaGVzLmluY2x1ZGVzKGNhY2hlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlcy5kZWxldGUoY2FjaGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIClcbiAgICB9KVxuICApO1xufSk7XG5cblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHtcbiAgbGV0IGNoZWNrVXJsID0gbmV3IFVSTChldmVudC5yZXF1ZXN0LnVybCk7XG4gIGlmIChjaGVja1VybC5wb3J0ID09PSBcIjEzMzdcIikge1xuICAgIGxldCBpZCA9IGNoZWNrVXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3Jlc3RhdXJhbnRfaWQnKSAtIDA7XG4gICAgcmV0dXJuIGhhbmRsZUFKQVhFdmVudChldmVudCwgaWQpO1xuICB9IGVsc2Uge1xuICAgIGhhbmRsZU5vbkFKQVhFdmVudChldmVudCk7XG4gIH1cbn0pO1xuXG5jb25zdCBoYW5kbGVBSkFYRXZlbnQgPSAoZXZlbnQsIGlkKSA9PiB7XG4gIC8vIE9ubHkgdXNlIGZvciBjYWNoaW5nIGZvciBHZXQgZXZlbnRzXG4gIGlmKGV2ZW50LnJlcXVlc3QubWV0aG9kICE9PSBcIkdFVFwiKSB7XG4gICAgZXZlbnQucmVzcG9uZFdpdGgoIGZldGNoKGV2ZW50LnJlcXVlc3QpKVxuICB9IGVsc2UgaWYoZXZlbnQucmVxdWVzdC51cmwuaW5kZXhPZihcInJlc3RhdXJhbnRzXCIpID4gLTEpIHtcbiAgICBoYW5kbGVSZXN0YXVyYW50RXZlbnRzKGV2ZW50KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcgaGFuZGxpbmcgZnJvbSByZXZpZXdzIGV2ZW50JylcbiAgICBoYW5kbGVSZXZpZXdzRXZlbnRzKGV2ZW50LCBpZCk7XG4gIH1cbn1cblxuY29uc3QgaGFuZGxlUmVzdGF1cmFudEV2ZW50cyA9IChldmVudCkgPT4ge1xuICBldmVudC5yZXNwb25kV2l0aChcbiAgICAgIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdGFydGluZyBmcm9tIGlkYicpO1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJylcbiAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcbiAgICAgICAgICAuZ2V0QWxsKCk7XG4gICAgICB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgcmV0dXJuICgoZGF0YS5sZW5ndGggJiYgZGF0YSkgfHwgZ2V0UmVzdGF1cmFudHMoZXZlbnQpXG4gICAgICAgICAgLnRoZW4oIHJlc3RhdXJhbnRzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmZXRjaGVkIG5vdyBzdG9yaW5nJyk7XG4gICAgICAgICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuICAgICAgICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uKHJlc3RhdXJhbnQpe1xuICAgICAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xuICAgICAgICAgICAgfSkudGhlbiggKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3RvcmVkIHJlc3RhdXJhbnRzLCBub3cgcmV0dXJuaW5nJyk7XG4gICAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIH0pXG4gICAgICAgIC50aGVuKGZpbmFsUmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGZpbmFsUmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZmluYWxSZXNwb25zZSkpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcIkVycm9yIGZldGNoaW5nIGRhdGFcIiwge3N0YXR1czogNTAwfSk7XG4gICAgfSlcbiAgKVxufVxuXG5jb25zdCBoYW5kbGVSZXZpZXdzRXZlbnRzID0gKGV2ZW50LCBpZCkgPT4ge1xuICBldmVudC5yZXNwb25kV2l0aChcbiAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnRyYW5zYWN0aW9uKCdyZXZpZXdzJylcbiAgICAgICAgLm9iamVjdFN0b3JlKCdyZXZpZXdzJylcbiAgICAgICAgLmluZGV4KFwicmVzdGF1cmFudF9pZFwiKVxuICAgICAgICAuZ2V0QWxsKGlkKTtcbiAgICB9KS50aGVuKCBkYXRhID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNld29ya2VyIGhhbmRsZSByZXZpZXdzJyk7XG4gICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgIHJldHVybiAoZGF0YS5sZW5ndGggJiYgZGF0YSkgfHwgZmV0Y2goZXZlbnQucmVxdWVzdClcbiAgICAgICAgLnRoZW4oZmV0Y2hSZXNwb25zZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZldGNoUmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbiggcmV2aWV3cyA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3VzaW5nIHNlcnZpY2V3b3JrZXIgZmV0Y2gnKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcgdG8gc3RvcmUgcmV2aWV3cycpO1xuICAgICAgICAgIHJldHVybiBkYlByb21pc2UudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKVxuICAgICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcbiAgICAgICAgICAgIHJldmlld3MuZm9yRWFjaChmdW5jdGlvbihyZXZpZXcpIHtcbiAgICAgICAgICAgICAgc3RvcmUucHV0KHJldmlldyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oICgpID0+IHJldmlld3MpXG4gICAgICAgIH0pXG4gICAgfSkudGhlbihmaW5hbFJlc3BvbnNlID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGZpbmFsUmVzcG9uc2UpO1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShmaW5hbFJlc3BvbnNlKSk7XG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcIkVycm9yIGZldGNoaW5nIGRhdGFcIiwge3N0YXR1czogNTAwfSk7XG4gICAgfSkpXG59XG5cbmNvbnN0IGhhbmRsZU5vbkFKQVhFdmVudCA9IChldmVudCkgPT4ge1xuICAvLyBDaGVjayBpZiB0aGUgSFRNTCByZXF1ZXN0IGhhcyBwcmV2aW91c2x5IGJlZW4gY2FjaGVkLiBJZiBzbywgcmV0dXJuIHRoZVxuICAvLyByZXNwb25zZSBmcm9tIHRoZSBjYWNoZS4gSWYgbm90LCBmZXRjaCB0aGUgcmVxdWVzdCwgY2FjaGUgaXQsIGFuZCB0aGVuIHJldHVyblxuICAvLyBpdC5cbiAgZXZlbnQucmVzcG9uZFdpdGgoXG4gICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgcmV0dXJuIChyZXNwb25zZSB8fCBmZXRjaChldmVudC5yZXF1ZXN0KS50aGVuKGZldGNoUmVzcG9uc2UgPT4ge1xuICAgICAgICBsZXQgdXNlQ2FjaGUgPSBpc0ltYWdlVVJMKGV2ZW50LnJlcXVlc3QudXJsKSA/ICBJTUFHRVNfQ0FDSEUgOiBTVEFUSUNfQ0FDSEU7XG4gICAgICAgIHJldHVybiBjYWNoZXNcbiAgICAgICAgICAub3Blbih1c2VDYWNoZSlcbiAgICAgICAgICAudGhlbihjYWNoZSA9PiB7XG4gICAgICAgICAgICBjYWNoZS5wdXQoZXZlbnQucmVxdWVzdCwgZmV0Y2hSZXNwb25zZS5jbG9uZSgpKTtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaFJlc3BvbnNlO1xuICAgICAgICB9KTtcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcIkFwcGxpY2F0aW9uIGlzIG5vdCBjb25uZWN0ZWQgdG8gdGhlIGludGVybmV0XCIsIHtcbiAgICAgICAgICBzdGF0dXM6IDQwNCxcbiAgICAgICAgICBzdGF0dXNUZXh0OiBcIkFwcGxpY2F0aW9uIGlzIG5vdCBjb25uZWN0ZWQgdG8gdGhlIGludGVybmV0XCJcbiAgICAgICAgfSk7XG4gICAgICB9KSk7XG4gICAgfSlcbiAgKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=