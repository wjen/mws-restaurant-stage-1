!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}({0:function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,s;const a=new WeakMap,c=new WeakMap,i=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||i.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(g(this),t,...n);return i.set(r,t.sort?t.sort():[t]),p(r)}:(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),p(a.get(this))}:function(...t){return p(e.apply(g(this),t))}}function h(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(c.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),r()},s=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});c.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(p(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&a.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=h(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function v(e,t,{blocked:n,upgrade:r,blocking:o}={}){const s=indexedDB.open(e,t),a=p(s);return r&&s.addEventListener("upgradeneeded",e=>{r(p(s.result),e.oldVersion,e.newVersion,p(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),o&&a.then(e=>e.addEventListener("versionchange",o)),a}n.d(t,"a",function(){return v});const b=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],w=new Map;function y(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return b.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),m.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&w.set(t,o),o}d=(e=>({get:(t,n,r)=>y(t,n)||e.get(t,n,r),has:(t,n)=>!!y(t,n)||e.has(t,n)}))(d)},7:function(e,t,n){"use strict";n.r(t);var r=n(0);const o=["static_cache-v5","images_cache-v"],s=Object(r.a)("rr-db",2,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id")}}});self.addEventListener("install",e=>{e.waitUntil(caches.open("static_cache-v5").then(e=>e.addAll(["/","/src/main.js","/src/dbhelper.js","/restaurant.html","/index.html","/src/restaurant_info.js","/src/styles.css","/src/rr-icon512.png"]).catch(e=>{console.log("error opening cache"+e)})))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>{Promise.all(e.map(e=>{if(!o.includes(e))return caches.delete(e)}))}))}),self.addEventListener("fetch",e=>{let t=new URL(e.request.url),n=t.searchParams.get("restaurant_id")-0;if("1337"===t.port)return a(e,n);"GET"===e.request.method?e.respondWith(caches.match(e.request).then(t=>(console.log("this should not show"),t||fetch(e.request).then(t=>{let n=function(e){let t=["png","jpg","jpeg","svg","gif"],n=!1;for(let r of t)if(e.endsWith(r)){n=!0;break}return n}(e.request.url)?"images_cache-v":"static_cache-v5";return caches.open(n).then(n=>(n.put(e.request,t.clone()),t))}))).catch(e=>{console.log(e)})):e.respondWith(fetch(e.request))});const a=(e,t)=>{"GET"!==e.request.method?e.respondWith(fetch(e.request)):e.request.url.indexOf("restaurants")>-1?c(e):(console.log("starting handling from reviews event"),i(e,t))},c=e=>{e.respondWith(s.then(e=>(console.log("starting from idb"),e.transaction("restaurants").objectStore("restaurants").getAll())).then(t=>(console.log(t),t.length&&t||(e=>new Promise(function(t,n){fetch(e.request).then(e=>e.json()).then(e=>{t(e)}).catch(e=>{console.log(e),n(e)})}))(e).then(e=>(console.log("fetched now storing"),s.then(t=>{let n=t.transaction("restaurants","readwrite"),r=n.objectStore("restaurants");return e.forEach(function(e){r.put(e)}),n.done}).then(()=>(console.log("stored restaurants, now returning"),e)))))).then(e=>(console.log(e),new Response(JSON.stringify(e)))).catch(e=>new Response("Error fetching data",{status:500})))},i=(e,t)=>{e.respondWith(s.then(e=>e.transaction("reviews").objectStore("reviews").index("restaurant_id").getAll(t)).then(t=>(console.log("serviceworker handle reviews"),console.log(t),t.length&&t||fetch(e.request).then(e=>e.json()).then(e=>(console.log("using serviceworker fetch"),console.log("starting to store reviews"),s.then(t=>{let n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return e.forEach(function(e){r.put(e)}),n.done}).then(()=>e))))).then(e=>(console.log(e),new Response(JSON.stringify(e)))).catch(e=>new Response("Error fetching data",{status:500})))}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vY2h1bmsuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vYXBwL3N3LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiaW5zdGFuY2VPZkFueSIsImNvbnN0cnVjdG9ycyIsInNvbWUiLCJpZGJQcm94eWFibGVUeXBlcyIsImN1cnNvckFkdmFuY2VNZXRob2RzIiwiY3Vyc29yUmVxdWVzdE1hcCIsIldlYWtNYXAiLCJ0cmFuc2FjdGlvbkRvbmVNYXAiLCJ0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAiLCJ0cmFuc2Zvcm1DYWNoZSIsInJldmVyc2VUcmFuc2Zvcm1DYWNoZSIsImlkYlByb3h5VHJhcHMiLCJbb2JqZWN0IE9iamVjdF0iLCJ0YXJnZXQiLCJwcm9wIiwicmVjZWl2ZXIiLCJJREJUcmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlTmFtZXMiLCJ1bmRlZmluZWQiLCJvYmplY3RTdG9yZSIsIndyYXAiLCJoYXMiLCJ3cmFwRnVuY3Rpb24iLCJmdW5jIiwiSURCRGF0YWJhc2UiLCJ0cmFuc2FjdGlvbiIsInN0b3JlTmFtZXMiLCJhcmdzIiwidHgiLCJ1bndyYXAiLCJ0aGlzIiwic2V0Iiwic29ydCIsIklEQkN1cnNvciIsImFkdmFuY2UiLCJjb250aW51ZSIsImNvbnRpbnVlUHJpbWFyeUtleSIsImluY2x1ZGVzIiwiYXBwbHkiLCJ0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlIiwiZG9uZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidW5saXN0ZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY29tcGxldGUiLCJlcnJvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24iLCJJREJPYmplY3RTdG9yZSIsIklEQkluZGV4IiwiUHJveHkiLCJJREJSZXF1ZXN0IiwicmVxdWVzdCIsInByb21pc2UiLCJzdWNjZXNzIiwicmVzdWx0IiwidGhlbiIsInByb21pc2lmeVJlcXVlc3QiLCJuZXdWYWx1ZSIsIm9wZW5EQiIsInZlcnNpb24iLCJibG9ja2VkIiwidXBncmFkZSIsImJsb2NraW5nIiwiaW5kZXhlZERCIiwib3BlbiIsIm9wZW5Qcm9taXNlIiwiZXZlbnQiLCJvbGRWZXJzaW9uIiwibmV3VmVyc2lvbiIsImRiIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsInJlYWRNZXRob2RzIiwid3JpdGVNZXRob2RzIiwiY2FjaGVkTWV0aG9kcyIsIk1hcCIsImdldE1ldGhvZCIsInRhcmdldEZ1bmNOYW1lIiwicmVwbGFjZSIsInVzZUluZGV4IiwibWV0aG9kIiwic3RvcmVOYW1lIiwic3RvcmUiLCJpbmRleCIsInNoaWZ0Iiwib2xkVHJhcHMiLCJjYWxsYmFjayIsImlkYl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiYWxsQ2FjaGVzIiwiZGJQcm9taXNlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJhdXRvSW5jcmVtZW50Iiwic2VsZiIsIndhaXRVbnRpbCIsImNhY2hlcyIsImNhY2hlIiwiYWRkQWxsIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwia2V5cyIsImNhY2hlTmFtZXMiLCJhbGwiLCJtYXAiLCJkZWxldGUiLCJjaGVja1VybCIsIlVSTCIsInVybCIsImlkIiwic2VhcmNoUGFyYW1zIiwicG9ydCIsImhhbmRsZUFKQVhFdmVudCIsInJlc3BvbmRXaXRoIiwibWF0Y2giLCJyZXNwb25zZSIsImZldGNoIiwiZmV0Y2hSZXNwb25zZSIsInVzZUNhY2hlIiwiaW1nVHlwZXMiLCJpc0ltYWdlIiwidHlwZSIsImVuZHNXaXRoIiwiaXNJbWFnZVVSTCIsInB1dCIsImNsb25lIiwiaW5kZXhPZiIsImhhbmRsZVJlc3RhdXJhbnRFdmVudHMiLCJoYW5kbGVSZXZpZXdzRXZlbnRzIiwiZ2V0QWxsIiwiZGF0YSIsImxlbmd0aCIsInJlc3AiLCJqc29uIiwiZ2V0UmVzdGF1cmFudHMiLCJyZXN0YXVyYW50cyIsImZvckVhY2giLCJyZXN0YXVyYW50IiwiZmluYWxSZXNwb25zZSIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN0YXR1cyIsInJldmlld3MiLCJyZXZpZXciXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVB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QUFRLFNBQVNRLEdBQ3ZCL0QsRUFBTTJDLElBQUlvQixLQUVMdkgsRUFBR1ksT0FFWGtCLEtBQU0sSUFBTXdGLE9BRWhCeEYsS0FBS21GLElBQ0p2QyxRQUFRQyxJQUFJc0MsR0FDSCxJQUFJQyxTQUFTQyxLQUFLQyxVQUFVSCxNQUNsQ3hDLE1BQU10RCxHQUNBLElBQUkrRixTQUFTLHNCQUF1QixDQUFDRyxPQUFRIiwiZmlsZSI6InNlcnZpY2V3b3JrZXIuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDcpO1xuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoYyA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTtcblxubGV0IGlkYlByb3h5YWJsZVR5cGVzO1xyXG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XHJcbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxyXG5mdW5jdGlvbiBnZXRJZGJQcm94eWFibGVUeXBlcygpIHtcclxuICAgIHJldHVybiBpZGJQcm94eWFibGVUeXBlcyB8fFxyXG4gICAgICAgIChpZGJQcm94eWFibGVUeXBlcyA9IFtJREJEYXRhYmFzZSwgSURCT2JqZWN0U3RvcmUsIElEQkluZGV4LCBJREJDdXJzb3IsIElEQlRyYW5zYWN0aW9uXSk7XHJcbn1cclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkge1xyXG4gICAgcmV0dXJuIGN1cnNvckFkdmFuY2VNZXRob2RzIHx8IChjdXJzb3JBZHZhbmNlTWV0aG9kcyA9IFtcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXHJcbiAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlUHJpbWFyeUtleSxcclxuICAgIF0pO1xyXG59XHJcbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvbkRvbmVNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xyXG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjb25zdCB1bmxpc3RlbiA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICBwcm9taXNlLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxyXG4gICAgICAgIC8vIChzZWUgd3JhcEZ1bmN0aW9uKS5cclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJDdXJzb3IpIHtcclxuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gVGhpcyBtYXBwaW5nIGV4aXN0cyBpbiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYnV0IGRvZXNuJ3QgZG9lc24ndCBleGlzdCBpbiB0cmFuc2Zvcm1DYWNoZS4gVGhpc1xyXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXHJcbiAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KHByb21pc2UsIHJlcXVlc3QpO1xyXG4gICAgcmV0dXJuIHByb21pc2U7XHJcbn1cclxuZnVuY3Rpb24gY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHR4KSB7XHJcbiAgICAvLyBFYXJseSBiYWlsIGlmIHdlJ3ZlIGFscmVhZHkgY3JlYXRlZCBhIGRvbmUgcHJvbWlzZSBmb3IgdGhpcyB0cmFuc2FjdGlvbi5cclxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBjb25zdCBkb25lID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY29tcGxldGUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QodHguZXJyb3IpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIENhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwuXHJcbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcclxufVxyXG5sZXQgaWRiUHJveHlUcmFwcyA9IHtcclxuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHRyYW5zYWN0aW9uLmRvbmUuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25Eb25lTWFwLmdldCh0YXJnZXQpO1xyXG4gICAgICAgICAgICAvLyBQb2x5ZmlsbCBmb3Igb2JqZWN0U3RvcmVOYW1lcyBiZWNhdXNlIG9mIEVkZ2UuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQub2JqZWN0U3RvcmVOYW1lcyB8fCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnc3RvcmUnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1sxXSA/XHJcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXHJcbiAgICAgICAgcmV0dXJuIHdyYXAodGFyZ2V0W3Byb3BdKTtcclxuICAgIH0sXHJcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uICYmIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDtcclxuICAgIH0sXHJcbn07XHJcbmZ1bmN0aW9uIGFkZFRyYXBzKGNhbGxiYWNrKSB7XHJcbiAgICBpZGJQcm94eVRyYXBzID0gY2FsbGJhY2soaWRiUHJveHlUcmFwcyk7XHJcbn1cclxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcclxuICAgIC8vIER1ZSB0byBleHBlY3RlZCBvYmplY3QgZXF1YWxpdHkgKHdoaWNoIGlzIGVuZm9yY2VkIGJ5IHRoZSBjYWNoaW5nIGluIGB3cmFwYCksIHdlXHJcbiAgICAvLyBvbmx5IGNyZWF0ZSBvbmUgbmV3IGZ1bmMgcGVyIGZ1bmMuXHJcbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cclxuICAgIGlmIChmdW5jID09PSBJREJEYXRhYmFzZS5wcm90b3R5cGUudHJhbnNhY3Rpb24gJiZcclxuICAgICAgICAnb2JqZWN0U3RvcmVOYW1lcycgaW4gSURCVHJhbnNhY3Rpb24ucHJvdG90eXBlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZnVuYy5jYWxsKHVud3JhcCh0aGlzKSwgc3RvcmVOYW1lcywgLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5zZXQodHgsIHN0b3JlTmFtZXMuc29ydCA/IHN0b3JlTmFtZXMuc29ydCgpIDogW3N0b3JlTmFtZXNdKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXHJcbiAgICAvLyBJREIsIHlvdSBhZHZhbmNlIHRoZSBjdXJzb3IgYW5kIHdhaXQgZm9yIGEgbmV3ICdzdWNjZXNzJyBvbiB0aGUgSURCUmVxdWVzdCB0aGF0IGdhdmUgeW91IHRoZVxyXG4gICAgLy8gY3Vyc29yLiBJdCdzIGtpbmRhIGxpa2UgYSBwcm9taXNlIHRoYXQgY2FuIHJlc29sdmUgd2l0aCBtYW55IHZhbHVlcy4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2VcclxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcclxuICAgIC8vIHVuZGVmaW5lZCBpZiB0aGUgZW5kIG9mIHRoZSBjdXJzb3IgaGFzIGJlZW4gcmVhY2hlZC5cclxuICAgIGlmIChnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpLmluY2x1ZGVzKGZ1bmMpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cclxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcChjdXJzb3JSZXF1ZXN0TWFwLmdldCh0aGlzKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xyXG4gICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgIHJldHVybiB3cmFwKGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXHJcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XHJcbiAgICAvLyBUaGlzIGRvZXNuJ3QgcmV0dXJuLCBpdCBqdXN0IGNyZWF0ZXMgYSAnZG9uZScgcHJvbWlzZSBmb3IgdGhlIHRyYW5zYWN0aW9uLFxyXG4gICAgLy8gd2hpY2ggaXMgbGF0ZXIgcmV0dXJuZWQgZm9yIHRyYW5zYWN0aW9uLmRvbmUgKHNlZSBpZGJPYmplY3RIYW5kbGVyKS5cclxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxyXG4gICAgICAgIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih2YWx1ZSk7XHJcbiAgICBpZiAoaW5zdGFuY2VPZkFueSh2YWx1ZSwgZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSkpXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XHJcbiAgICAvLyBSZXR1cm4gdGhlIHNhbWUgdmFsdWUgYmFjayBpZiB3ZSdyZSBub3QgZ29pbmcgdG8gdHJhbnNmb3JtIGl0LlxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXAodmFsdWUpIHtcclxuICAgIC8vIFdlIHNvbWV0aW1lcyBnZW5lcmF0ZSBtdWx0aXBsZSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QgKGVnIHdoZW4gY3Vyc29yaW5nKSwgYmVjYXVzZVxyXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCUmVxdWVzdClcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdCh2YWx1ZSk7XHJcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXHJcbiAgICAvLyBUaGlzIGlzIGZhc3RlciwgYnV0IGl0IGFsc28gcHJvdmlkZXMgb2JqZWN0IGVxdWFsaXR5LlxyXG4gICAgaWYgKHRyYW5zZm9ybUNhY2hlLmhhcyh2YWx1ZSkpXHJcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpO1xyXG4gICAgLy8gTm90IGFsbCB0eXBlcyBhcmUgdHJhbnNmb3JtZWQuXHJcbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cclxuICAgIGlmIChuZXdWYWx1ZSAhPT0gdmFsdWUpIHtcclxuICAgICAgICB0cmFuc2Zvcm1DYWNoZS5zZXQodmFsdWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VmFsdWU7XHJcbn1cclxuY29uc3QgdW53cmFwID0gKHZhbHVlKSA9PiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcblxuZXhwb3J0IHsgd3JhcCBhcyBhLCBhZGRUcmFwcyBhcyBiLCBpbnN0YW5jZU9mQW55IGFzIGMsIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBkLCB1bndyYXAgYXMgZSB9O1xuIiwiaW1wb3J0IHsgYSBhcyB3cmFwLCBiIGFzIGFkZFRyYXBzIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5leHBvcnQgeyBlIGFzIHVud3JhcCwgYSBhcyB3cmFwIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5cbi8qKlxyXG4gKiBPcGVuIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKiBAcGFyYW0gdmVyc2lvbiBTY2hlbWEgdmVyc2lvbi5cclxuICogQHBhcmFtIGNhbGxiYWNrcyBBZGRpdGlvbmFsIGNhbGxiYWNrcy5cclxuICovXHJcbmZ1bmN0aW9uIG9wZW5EQihuYW1lLCB2ZXJzaW9uLCB7IGJsb2NrZWQsIHVwZ3JhZGUsIGJsb2NraW5nIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xyXG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xyXG4gICAgaWYgKHVwZ3JhZGUpIHtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgaWYgKGJsb2NraW5nKVxyXG4gICAgICAgIG9wZW5Qcm9taXNlLnRoZW4oZGIgPT4gZGIuYWRkRXZlbnRMaXN0ZW5lcigndmVyc2lvbmNoYW5nZScsIGJsb2NraW5nKSk7XHJcbiAgICByZXR1cm4gb3BlblByb21pc2U7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZSBhIGRhdGFiYXNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cclxuICovXHJcbmZ1bmN0aW9uIGRlbGV0ZURCKG5hbWUsIHsgYmxvY2tlZCB9ID0ge30pIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgcmV0dXJuIHdyYXAocmVxdWVzdCkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xyXG59XG5cbmNvbnN0IHJlYWRNZXRob2RzID0gWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J107XHJcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcclxuY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTtcclxuZnVuY3Rpb24gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkge1xyXG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcclxuICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJlxyXG4gICAgICAgIHR5cGVvZiBwcm9wID09PSAnc3RyaW5nJykpXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgaWYgKGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApKVxyXG4gICAgICAgIHJldHVybiBjYWNoZWRNZXRob2RzLmdldChwcm9wKTtcclxuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xyXG4gICAgY29uc3QgdXNlSW5kZXggPSBwcm9wICE9PSB0YXJnZXRGdW5jTmFtZTtcclxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cclxuICAgIGlmICghKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgbWV0aG9kO1xyXG4gICAgaWYgKHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgbGV0IHRhcmdldCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lKS5zdG9yZTtcclxuICAgICAgICAgICAgaWYgKHVzZUluZGV4KVxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmluZGV4KGFyZ3Muc2hpZnQoKSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRbdGFyZ2V0RnVuY05hbWVdKC4uLmFyZ3MpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAod3JpdGVNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSB0aGlzLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICB0eC5zdG9yZVt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAobWV0aG9kKVxyXG4gICAgICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XHJcbiAgICByZXR1cm4gbWV0aG9kO1xyXG59XHJcbmFkZFRyYXBzKG9sZFRyYXBzID0+ICh7XHJcbiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksXHJcbiAgICBoYXM6ICh0YXJnZXQsIHByb3ApID0+ICEhZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuaGFzKHRhcmdldCwgcHJvcCksXHJcbn0pKTtcblxuZXhwb3J0IHsgb3BlbkRCLCBkZWxldGVEQiB9O1xuIiwiY29uc3QgY2FjaGVWZXJzaW9uID0gJzUnO1xuY29uc3QgU1RBVElDX0NBQ0hFID0gYHN0YXRpY19jYWNoZS12JHtjYWNoZVZlcnNpb259YDtcbmNvbnN0IElNQUdFU19DQUNIRSA9IGBpbWFnZXNfY2FjaGUtdmA7XG5jb25zdCBhbGxDYWNoZXMgPSBbXG4gIFNUQVRJQ19DQUNIRSxcbiAgSU1BR0VTX0NBQ0hFXG5dO1xuXG5pbXBvcnQgeyBvcGVuREIsIGRlbGV0ZURCLCB3cmFwLCB1bndyYXAgfSBmcm9tICdpZGInO1xuXG5jb25zdCBkYlByb21pc2UgPSBvcGVuREIoJ3JyLWRiJywgMiwge1xuICB1cGdyYWRlKGRiLCBvbGRWZXJzaW9uKSB7XG4gICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIGNvbnN0IHN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywgeyBrZXlQYXRoOiAnaWQnIH0pO1xuICAgICAgICBzdG9yZS5jcmVhdGVJbmRleCgnaWQnLCAnaWQnKTtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgY29uc3QgcmV2aWV3c1N0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJyxcbiAgICAgICAgICBhdXRvSW5jcmVtZW50OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXZpZXdzU3RvcmUuY3JlYXRlSW5kZXgoXCJyZXN0YXVyYW50X2lkXCIsIFwicmVzdGF1cmFudF9pZFwiKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vLyBjb25zdCBnZXRSZXN0YXVyYW50cyA9IChldmVudCkgPT4ge1xuLy8gICBjb25zb2xlLmxvZyhldmVudC5yZXF1ZXN0KTtcbi8vICAgZmV0Y2goZXZlbnQucmVxdWVzdClcbi8vICAgICAudGhlbiggZmV0Y2hSZXNwb25zZSA9PiB7XG4vLyAgICAgICBjb25zb2xlLmxvZygnc3RpbGwgZ3JhYmJpbmcgZnJvbSBmZXRjaCcpO1xuLy8gICAgICAgcmV0dXJuIGZldGNoUmVzcG9uc2UuanNvbigpO1xuLy8gICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbi8vICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbi8vICAgICAgIHJlamVjdChlcnJvcik7XG4vLyAgICAgfSlcbi8vIH1cbiBjb25zdCBnZXRSZXN0YXVyYW50cyA9IChldmVudCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGZldGNoKGV2ZW50LnJlcXVlc3QpXG4gICAgICAudGhlbihyZXNwID0+IHJlc3AuanNvbigpKVxuICAgICAgLnRoZW4oanNvbiA9PiB7IHJlc29sdmUoanNvbik7IH0pXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG5mdW5jdGlvbiBpc0ltYWdlVVJMKHVybCkge1xuICBsZXQgaW1nVHlwZXMgPSBbXCJwbmdcIiwgXCJqcGdcIiwgXCJqcGVnXCIsIFwic3ZnXCIsIFwiZ2lmXCJdO1xuICBsZXQgaXNJbWFnZSA9IGZhbHNlO1xuICBmb3IgKGxldCB0eXBlIG9mIGltZ1R5cGVzKSB7XG4gICAgaWYgKHVybC5lbmRzV2l0aCh0eXBlKSkgeyBpc0ltYWdlID0gdHJ1ZTsgYnJlYWt9O1xuICB9XG4gIHJldHVybiBpc0ltYWdlO1xufVxuXG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGV2ZW50ID0+IHtcbiAgZXZlbnQud2FpdFVudGlsKFxuICAgIGNhY2hlcy5vcGVuKFNUQVRJQ19DQUNIRSkudGhlbihjYWNoZSA9PiB7XG4gICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKFtcbiAgICAgICAgJy8nLFxuICAgICAgICAnL3NyYy9tYWluLmpzJyxcbiAgICAgICAgJy9zcmMvZGJoZWxwZXIuanMnLFxuICAgICAgICAnL3Jlc3RhdXJhbnQuaHRtbCcsXG4gICAgICAgICcvaW5kZXguaHRtbCcsXG4gICAgICAgICcvc3JjL3Jlc3RhdXJhbnRfaW5mby5qcycsXG4gICAgICAgICcvc3JjL3N0eWxlcy5jc3MnLFxuICAgICAgICAnL3NyYy9yci1pY29uNTEyLnBuZydcbiAgICAgIF0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIG9wZW5pbmcgY2FjaGUnICsgZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZXZlbnQgPT4ge1xuICBldmVudC53YWl0VW50aWwoXG4gICAgY2FjaGVzLmtleXMoKS50aGVuKGNhY2hlTmFtZXMgPT4ge1xuICAgICAgUHJvbWlzZS5hbGwoXG4gICAgICAgICBjYWNoZU5hbWVzLm1hcChjYWNoZSA9PiB7XG4gICAgICAgICAgaWYoIWFsbENhY2hlcy5pbmNsdWRlcyhjYWNoZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWNoZXMuZGVsZXRlKGNhY2hlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgfSlcbiAgKTtcbn0pO1xuXG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBldmVudCA9PiB7XG4gIGxldCBjaGVja1VybCA9IG5ldyBVUkwoZXZlbnQucmVxdWVzdC51cmwpO1xuICBsZXQgaWQgPSBjaGVja1VybC5zZWFyY2hQYXJhbXMuZ2V0KCdyZXN0YXVyYW50X2lkJykgLSAwO1xuICBpZiAoY2hlY2tVcmwucG9ydCA9PT0gXCIxMzM3XCIpIHtcbiAgICByZXR1cm4gaGFuZGxlQUpBWEV2ZW50KGV2ZW50LCBpZCk7XG4gIH0gZWxzZSBpZiAoZXZlbnQucmVxdWVzdC5tZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICBldmVudC5yZXNwb25kV2l0aChcbiAgICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgc2hvdWxkIG5vdCBzaG93Jyk7XG4gICAgICAgIHJldHVybiAocmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCkudGhlbihmZXRjaFJlc3BvbnNlID0+IHtcbiAgICAgICAgICBsZXQgdXNlQ2FjaGUgPSBpc0ltYWdlVVJMKGV2ZW50LnJlcXVlc3QudXJsKSA/ICBJTUFHRVNfQ0FDSEUgOiBTVEFUSUNfQ0FDSEU7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlcy5vcGVuKHVzZUNhY2hlKS50aGVuKGNhY2hlID0+IHtcbiAgICAgICAgICAgICBjYWNoZS5wdXQoZXZlbnQucmVxdWVzdCwgZmV0Y2hSZXNwb25zZS5jbG9uZSgpKTtcbiAgICAgICAgICAgICByZXR1cm4gZmV0Y2hSZXNwb25zZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9KVxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgZXZlbnQucmVzcG9uZFdpdGgoIGZldGNoKGV2ZW50LnJlcXVlc3QpICk7XG4gIH1cbn0pO1xuXG5jb25zdCBoYW5kbGVBSkFYRXZlbnQgPSAoZXZlbnQsIGlkKSA9PiB7XG4gIC8vIE9ubHkgdXNlIGZvciBjYWNoaW5nIGZvciBHZXQgZXZlbnRzXG4gIGlmKGV2ZW50LnJlcXVlc3QubWV0aG9kICE9PSBcIkdFVFwiKSB7XG4gICAgZXZlbnQucmVzcG9uZFdpdGgoIGZldGNoKGV2ZW50LnJlcXVlc3QpKVxuICB9IGVsc2UgaWYoZXZlbnQucmVxdWVzdC51cmwuaW5kZXhPZihcInJlc3RhdXJhbnRzXCIpID4gLTEpIHtcbiAgICBoYW5kbGVSZXN0YXVyYW50RXZlbnRzKGV2ZW50KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcgaGFuZGxpbmcgZnJvbSByZXZpZXdzIGV2ZW50JylcbiAgICBoYW5kbGVSZXZpZXdzRXZlbnRzKGV2ZW50LCBpZCk7XG4gIH1cbn1cblxuY29uc3QgaGFuZGxlUmVzdGF1cmFudEV2ZW50cyA9IChldmVudCkgPT4ge1xuICBldmVudC5yZXNwb25kV2l0aChcbiAgICAgIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdGFydGluZyBmcm9tIGlkYicpO1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJylcbiAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcbiAgICAgICAgICAuZ2V0QWxsKCk7XG4gICAgICB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgcmV0dXJuICgoZGF0YS5sZW5ndGggJiYgZGF0YSkgfHwgZ2V0UmVzdGF1cmFudHMoZXZlbnQpXG4gICAgICAgICAgLnRoZW4oIHJlc3RhdXJhbnRzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmZXRjaGVkIG5vdyBzdG9yaW5nJyk7XG4gICAgICAgICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuICAgICAgICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uKHJlc3RhdXJhbnQpe1xuICAgICAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xuICAgICAgICAgICAgfSkudGhlbiggKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3RvcmVkIHJlc3RhdXJhbnRzLCBub3cgcmV0dXJuaW5nJyk7XG4gICAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIH0pXG4gICAgICAgIC50aGVuKGZpbmFsUmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGZpbmFsUmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZmluYWxSZXNwb25zZSkpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcIkVycm9yIGZldGNoaW5nIGRhdGFcIiwge3N0YXR1czogNTAwfSk7XG4gICAgfSlcbiAgKVxufVxuXG5cblxuY29uc3QgaGFuZGxlUmV2aWV3c0V2ZW50cyA9IChldmVudCwgaWQpID0+IHtcbiAgZXZlbnQucmVzcG9uZFdpdGgoXG4gICAgZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC50cmFuc2FjdGlvbigncmV2aWV3cycpXG4gICAgICAgIC5vYmplY3RTdG9yZSgncmV2aWV3cycpXG4gICAgICAgIC5pbmRleChcInJlc3RhdXJhbnRfaWRcIilcbiAgICAgICAgLmdldEFsbChpZCk7XG4gICAgfSkudGhlbiggZGF0YSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZXdvcmtlciBoYW5kbGUgcmV2aWV3cycpO1xuICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICByZXR1cm4gKGRhdGEubGVuZ3RoICYmIGRhdGEpIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpXG4gICAgICAgIC50aGVuKGZldGNoUmVzcG9uc2UgPT4ge1xuICAgICAgICAgIHJldHVybiBmZXRjaFJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oIHJldmlld3MgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2luZyBzZXJ2aWNld29ya2VyIGZldGNoJyk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0aW5nIHRvIHN0b3JlIHJldmlld3MnKTtcbiAgICAgICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJylcbiAgICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XG4gICAgICAgICAgICByZXZpZXdzLmZvckVhY2goZnVuY3Rpb24ocmV2aWV3KSB7XG4gICAgICAgICAgICAgIHN0b3JlLnB1dChyZXZpZXcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdHguZG9uZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKCAoKSA9PiByZXZpZXdzKVxuICAgICAgICB9KVxuICAgIH0pLnRoZW4oZmluYWxSZXNwb25zZSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGZpbmFsUmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZmluYWxSZXNwb25zZSkpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcIkVycm9yIGZldGNoaW5nIGRhdGFcIiwge3N0YXR1czogNTAwfSk7XG4gICAgICAgIH0pKVxuXG59XG4iXSwic291cmNlUm9vdCI6IiJ9