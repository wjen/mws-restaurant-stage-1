!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return a});var r=n(1);const o=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});class a{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get DATABASE_REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){fetch(a.DATABASE_URL).then(function(t){t.json().then(function(t){e(null,t)})})}static fetchReviews(e,t){let n=a.DATABASE_REVIEWS_URL+"/?restaurant_id="+e;fetch(n).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){a.fetchRestaurants((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return e.photograph?`/img/${e.photograph}.jpg`:`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:a.urlForRestaurant(e)});return n.addTo(newMap),n}static updateCachedRestaurantReview(e){return console.log("updating cache for new review",e),o.then(t=>{const n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return console.log("putting review in store"),r.put(e),console.log("successfully put review in store"),n.done})}static saveNewReview(e){const t=a.DATABASE_REVIEWS_URL;return a.updateCachedRestaurantReview(e),a.addPendingRequestToQue(t,"POST",e).then(e=>e)}static addPendingRequestToQue(e,t,n){return new Promise((r,s)=>{o.then(r=>{r.transaction("pending","readwrite").objectStore("pending").put({data:{url:e,method:t,formData:n}})}).catch(e=>{console.log(e)}).then(a.nextPending((e,t)=>(console.log(t),r(t))))})}static nextPending(e){a.attemptCommitPending(a.nextPending).then(t=>{console.log(t),e(null,t)})}static attemptCommitPending(e){let t,n,r;return new Promise((a,s)=>{o.then(o=>{if(!o.objectStoreNames.length)return console.log("DB not available"),void o.close();o.transaction("pending","readwrite").objectStore("pending").openCursor().then(s=>{if(!s)return;s.value;if(t=s.value.data.url,n=s.value.data.method,r=s.value.data.formData,!t||!n||"POST"===n&&!r)return void s.delete().then(e());const i={body:JSON.stringify(r),method:n};fetch(t,i).then(e=>e.ok||e.redirected?e.json():(console.log("this is the response and we are offline"),void console.log(e))).then(t=>{o.transaction("pending","readwrite").objectStore("pending").openCursor().then(n=>{n.delete().then(()=>(e(),console.log(t),a(t)))}),console.log("deleted item from pending store")}).catch(e=>{console.log(e)})})})})}static syncRestaurant(e){try{let t=`http://localhost:1337/restaurants/${e.id}/?is_favorite=${e.is_favorite}`;return fetch(t,{method:"PUT"}).then(function(e){return e.json()})}catch(t){console.log("error updating restaurant backend data...",t,e)}}static updateRestaurantInDB(e){return o.then(function(t){let n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(e),n.complete}).then(function(){return Promise.resolve(e)})}static toggleFavBtn(e){return o.then(t=>{return t.transaction("restaurants").objectStore("restaurants").get(e)}).then(e=>{console.log(e);const t=Object.assign({},e);return t.is_favorite="true"===e.is_favorite||!0===e.is_favorite?"false":"true",a.syncRestaurant(t),a.updateRestaurantInDB(t)}).then(e=>{const t=document.getElementById(`fav-btn-${e.id}`);"true"===e.is_favorite||!0===e.is_favorite?(t.innerHTML="Favorited!",t.style.background="hotpink"):(t.innerHTML="Add to favorite",t.style.background="grey")})}}},function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,a;const s=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(g(this),t,...n);return c.set(r,t.sort?t.sort():[t]),p(r)}:(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),p(s.get(this))}:function(...t){return p(e.apply(g(this),t))}}function f(e){return"function"==typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});i.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(p(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=f(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function h(e,t,{blocked:n,upgrade:r,blocking:o}={}){const a=indexedDB.open(e,t),s=p(a);return r&&a.addEventListener("upgradeneeded",e=>{r(p(a.result),e.oldVersion,e.newVersion,p(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o&&s.then(e=>e.addEventListener("versionchange",o)),s}n.d(t,"a",function(){return h});const v=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],y=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return v.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),b.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&y.set(t,o),o}d=(e=>({get:(t,n,r)=>w(t,n)||e.get(t,n,r),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(d)},function(e,t,n){"use strict";n.r(t),t.default=function(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceworker.bundle.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})})}},,,function(e,t,n){n(2),n(0),e.exports=n(6)},function(e,t,n){"use strict";n.r(t);n(2);var r=n(0);let o;var a;document.addEventListener("DOMContentLoaded",e=>{s(),(o=document.getElementById("submit-form-btn")).addEventListener("click",p)});const s=()=>{i((e,t)=>{e?console.error(e):(a=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),self.newMap=a,L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoid2VudGluIiwiYSI6ImNqaXJ0N25iZjFwdjYza3A4MGt1aHU2bjEifQ.DnNFUoN5uzw01l_XK_c7nQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(a),m(),r.default.mapMarkerForRestaurant(self.restaurant,self.newMap))}),r.default.nextPending()},i=e=>{if(self.restaurant)return e(null,self.restaurant),void console.log("self restaurant already fetched");const t=f("id");t?r.default.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(c(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))},c=(e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=` ${e.name} <br> ${e.address}`;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=r.default.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&u(),r.default.fetchReviews(e.id,(e,t)=>{l(t)})},u=(e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),o=document.createElement("td");o.innerHTML=n,r.appendChild(o);const a=document.createElement("td");a.innerHTML=e[n],r.appendChild(a),t.appendChild(r)}},l=(e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(d(e))}),t.appendChild(r)},d=e=>{const t=document.createElement("li");t.setAttribute("id",`review-li-${e.id}`);const n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML="<strong>Created:</strong> "+new Date(e.createdAt).toDateString(),t.appendChild(r);const o=document.createElement("p");o.innerHTML=`Rating: ${e.rating}`,t.appendChild(o);const a=document.createElement("p");return a.innerHTML=e.comments,t.appendChild(a),t},m=(e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},f=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},p=()=>{console.log("submit review function");let e=g();/[a-zA-Z]{2,}$/gi.test(e.name)?/[1-5]{1}$/gi.test(e.rating)?e.comments.length<3?alert("comments input must be minimum of 3 characters"):(e.restaurant_id=self.restaurant.id,r.default.saveNewReview(e).then(e=>{console.log(e);alert("Created Review");let t=d(e);document.getElementById("reviews-list").appendChild(t);var n=document.getElementById(`review-li-${e.id}`);n.scrollIntoView&&n.scrollIntoView.constructor===Function&&n.scrollIntoView(!0)})):alert("rating input must be a number, 1-5"):alert("name input must be letters only, minimum of 2 characters")},g=()=>({name:document.getElementById("name").value.trim(),rating:document.getElementById("rating").value.trim(),comments:document.getElementById("review-field").value.trim()})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vYXBwL3NyYy9kYmhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9jaHVuay5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL3JlZ2lzdHJhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL3Jlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9fd2VicGFja19leHBvcnRzX18iLCJEQkhlbHBlciIsImlkYl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiZGJQcm9taXNlIiwib3BlbkRCIiwidXBncmFkZSIsImRiIiwib2xkVmVyc2lvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsIkRBVEFCQVNFX1VSTCIsIkRBVEFCQVNFX1JFVklFV1NfVVJMIiwiW29iamVjdCBPYmplY3RdIiwiY2FsbGJhY2siLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJyZXN0YXVyYW50cyIsInJlc3RhdXJhbnRfaWQiLCJmZXRjaFVSTCIsInJldmlld3MiLCJjYXRjaCIsImVycm9yIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwicmVzdGF1cmFudCIsImZpbmQiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCIsImZvcm1EYXRhIiwiY29uc29sZSIsImxvZyIsInR4IiwidHJhbnNhY3Rpb24iLCJzdG9yZSIsIm9iamVjdFN0b3JlIiwicHV0IiwiZG9uZSIsInVwZGF0ZUNhY2hlZFJlc3RhdXJhbnRSZXZpZXciLCJhZGRQZW5kaW5nUmVxdWVzdFRvUXVlIiwibWV0aG9kIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJkYXRhIiwibmV4dFBlbmRpbmciLCJhdHRlbXB0Q29tbWl0UGVuZGluZyIsImoiLCJib2R5Iiwib2JqZWN0U3RvcmVOYW1lcyIsImxlbmd0aCIsImNsb3NlIiwib3BlbkN1cnNvciIsImN1cnNvciIsImRlbGV0ZSIsInByb3BlcnRpZXMiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJyZWRpcmVjdGVkIiwiaXNfZmF2b3JpdGUiLCJlIiwibmV3X3Jlc3RhdXJhbnQiLCJjb21wbGV0ZSIsImFzc2lnbiIsInN5bmNSZXN0YXVyYW50IiwidXBkYXRlUmVzdGF1cmFudEluREIiLCJmYXZCdG4iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwic3R5bGUiLCJiYWNrZ3JvdW5kIiwiaW5zdGFuY2VPZkFueSIsImNvbnN0cnVjdG9ycyIsInNvbWUiLCJpZGJQcm94eWFibGVUeXBlcyIsImN1cnNvckFkdmFuY2VNZXRob2RzIiwiY3Vyc29yUmVxdWVzdE1hcCIsIldlYWtNYXAiLCJ0cmFuc2FjdGlvbkRvbmVNYXAiLCJ0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAiLCJ0cmFuc2Zvcm1DYWNoZSIsInJldmVyc2VUcmFuc2Zvcm1DYWNoZSIsImlkYlByb3h5VHJhcHMiLCJ0YXJnZXQiLCJwcm9wIiwicmVjZWl2ZXIiLCJJREJUcmFuc2FjdGlvbiIsInVuZGVmaW5lZCIsIndyYXAiLCJoYXMiLCJ3cmFwRnVuY3Rpb24iLCJmdW5jIiwiSURCRGF0YWJhc2UiLCJzdG9yZU5hbWVzIiwiYXJncyIsInVud3JhcCIsInRoaXMiLCJzZXQiLCJzb3J0IiwiSURCQ3Vyc29yIiwiYWR2YW5jZSIsImNvbnRpbnVlIiwiY29udGludWVQcmltYXJ5S2V5IiwiaW5jbHVkZXMiLCJhcHBseSIsInRyYW5zZm9ybUNhY2hhYmxlVmFsdWUiLCJ1bmxpc3RlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uIiwiSURCT2JqZWN0U3RvcmUiLCJJREJJbmRleCIsIlByb3h5IiwiSURCUmVxdWVzdCIsInJlcXVlc3QiLCJwcm9taXNlIiwic3VjY2VzcyIsInJlc3VsdCIsInByb21pc2lmeVJlcXVlc3QiLCJuZXdWYWx1ZSIsInZlcnNpb24iLCJibG9ja2VkIiwiYmxvY2tpbmciLCJpbmRleGVkREIiLCJvcGVuIiwib3BlblByb21pc2UiLCJldmVudCIsIm5ld1ZlcnNpb24iLCJyZWFkTWV0aG9kcyIsIndyaXRlTWV0aG9kcyIsImNhY2hlZE1ldGhvZHMiLCJNYXAiLCJnZXRNZXRob2QiLCJ0YXJnZXRGdW5jTmFtZSIsInJlcGxhY2UiLCJ1c2VJbmRleCIsInN0b3JlTmFtZSIsImluZGV4Iiwic2hpZnQiLCJvbGRUcmFwcyIsIm5hdmlnYXRvciIsIndpbmRvdyIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInJlZ2lzdHJhdGlvbiIsInJlZ2lzdHJhdGlvbkVycm9yIiwiX2RiaGVscGVyX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18iLCJzdWJtaXRCdG4iLCJpbml0TWFwIiwic3VibWl0UmV2aWV3IiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImNlbnRlciIsInpvb20iLCJzY3JvbGxXaGVlbFpvb20iLCJzZWxmIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJmaWxsQnJlYWRjcnVtYiIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmZXRjaFJldmlld3MiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwicm93IiwiY3JlYXRlRWxlbWVudCIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsInNldEF0dHJpYnV0ZSIsImRhdGUiLCJEYXRlIiwiY3JlYXRlZEF0IiwidG9EYXRlU3RyaW5nIiwicmF0aW5nIiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwibG9jYXRpb24iLCJocmVmIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsImdldEZvcm1WYWx1ZXMiLCJ0ZXN0IiwiYWxlcnQiLCJzYXZlTmV3UmV2aWV3IiwibmV3X3Jldmlld19ibG9jayIsImVsZW1lbnQiLCJzY3JvbGxJbnRvVmlldyIsImNvbnN0cnVjdG9yIiwiRnVuY3Rpb24iLCJ0cmltIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxFQUFBLFNBQUFBLEdBQWdILE9BQUFOLEVBQUFNLElBQXFCQyxLQUFBLEtBQUFELElBQ3JJLE9BQUFGLEdBSUF6QixFQUFBNkIsRUFBQSxTQUFBMUIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBcUIsV0FDQSxXQUEyQixPQUFBckIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQWlCLEVBQUFDLEdBQXNELE9BQUFqQixPQUFBa0IsVUFBQUMsZUFBQTFCLEtBQUF1QixFQUFBQyxJQUd0RC9CLEVBQUFrQyxFQUFBLEdBSUFsQyxJQUFBbUMsRUFBQSxrQ0NsRkFuQyxFQUFBa0IsRUFBQWtCLEdBQUFwQyxFQUFBVSxFQUFBMEIsRUFBQSw0QkFBQUMsSUFBQSxJQUFBQyxFQUFBdEMsRUFBQSxHQUtBLE1BQU11QyxFQUFZQyxZQUFPLFFBQVMsRUFBRyxDQUNuQ0MsUUFBUUMsRUFBSUMsR0FDVixPQUFRQSxHQUNOLEtBQUssRUFDV0QsRUFBR0Usa0JBQWtCLGNBQWUsQ0FBRUMsUUFBUyxPQUN2REMsWUFBWSxLQUFNLE1BQzFCLEtBQUssRUFDa0JKLEVBQUdFLGtCQUFrQixVQUFXLENBQ25EQyxRQUFTLEtBQ1RFLGVBQWUsSUFFSkQsWUFBWSxnQkFBaUIsaUJBQzVDLEtBQUssRUFDa0JKLEVBQUdFLGtCQUFrQixVQUFXLENBQ25EQyxRQUFTLEtBQ1RFLGVBQWUsUUFNVixNQUFNVixFQU1uQlcsMEJBRUUsTUFBUSxvQ0FHVkMsa0NBRUUsTUFBUSxnQ0FRVkMsd0JBQXdCQyxHQUN0QkMsTUFBTWYsRUFBU1csY0FBY0ssS0FBSyxTQUFTQyxHQUN6Q0EsRUFBU0MsT0FBT0YsS0FBSyxTQUFTRyxHQUM1QkwsRUFBUyxLQUFNSyxPQUtyQk4sb0JBQXFCTyxFQUFlTixHQUNsQyxJQUFJTyxFQUFXckIsRUFBU1kscUJBQXVCLG1CQUFxQlEsRUFDcEVMLE1BQU1NLEdBQVVMLEtBQU1DLEdBQ2JBLEVBQVNDLFFBQ2ZGLEtBQUtNLElBQ0pSLEVBQVMsS0FBTVEsS0FDZEMsTUFBTUMsSUFDUFYsRUFBU1UsRUFBTyxRQXFCdEJYLDJCQUEyQlksRUFBSVgsR0FFN0JkLEVBQVMwQixpQkFBaUIsQ0FBQ0YsRUFBT0wsS0FDaEMsR0FBSUssRUFDRlYsRUFBU1UsRUFBTyxVQUNYLENBQ0wsTUFBTUcsRUFBYVIsRUFBWVMsS0FBSy9DLEdBQUtBLEVBQUU0QyxJQUFNQSxHQUM3Q0UsRUFDRmIsRUFBUyxLQUFNYSxHQUVmYixFQUFTLDRCQUE2QixTQVM5Q0QsZ0NBQWdDZ0IsRUFBU2YsR0FFdkNkLEVBQVMwQixpQkFBaUIsQ0FBQ0YsRUFBT0wsS0FDaEMsR0FBSUssRUFDRlYsRUFBU1UsRUFBTyxVQUNYLENBRUwsTUFBTU0sRUFBVVgsRUFBWVksT0FBT2xELEdBQUtBLEVBQUVtRCxjQUFnQkgsR0FDMURmLEVBQVMsS0FBTWdCLE1BUXJCakIscUNBQXFDb0IsRUFBY25CLEdBRWpEZCxFQUFTMEIsaUJBQWlCLENBQUNGLEVBQU9MLEtBQ2hDLEdBQUlLLEVBQ0ZWLEVBQVNVLEVBQU8sVUFDWCxDQUVMLE1BQU1NLEVBQVVYLEVBQVlZLE9BQU9sRCxHQUFLQSxFQUFFb0QsY0FBZ0JBLEdBQzFEbkIsRUFBUyxLQUFNZ0IsTUFRckJqQiwrQ0FBK0NnQixFQUFTSSxFQUFjbkIsR0FFcEVkLEVBQVMwQixpQkFBaUIsQ0FBQ0YsRUFBT0wsS0FDaEMsR0FBSUssRUFDRlYsRUFBU1UsRUFBTyxVQUNYLENBQ0wsSUFBSU0sRUFBVVgsRUFDQyxPQUFYVSxJQUNGQyxFQUFVQSxFQUFRQyxPQUFPbEQsR0FBS0EsRUFBRW1ELGNBQWdCSCxJQUU5QixPQUFoQkksSUFDRkgsRUFBVUEsRUFBUUMsT0FBT2xELEdBQUtBLEVBQUVvRCxjQUFnQkEsSUFFbERuQixFQUFTLEtBQU1nQixNQVFyQmpCLDBCQUEwQkMsR0FFeEJkLEVBQVMwQixpQkFBaUIsQ0FBQ0YsRUFBT0wsS0FDaEMsR0FBSUssRUFDRlYsRUFBU1UsRUFBTyxVQUNYLENBRUwsTUFBTVUsRUFBZ0JmLEVBQVlnQixJQUFJLENBQUNDLEVBQUdyRSxJQUFNb0QsRUFBWXBELEdBQUdrRSxjQUV6REksRUFBc0JILEVBQWNILE9BQU8sQ0FBQ0ssRUFBR3JFLElBQU1tRSxFQUFjSSxRQUFRRixJQUFNckUsR0FDdkYrQyxFQUFTLEtBQU11QixNQVFyQnhCLHFCQUFxQkMsR0FFbkJkLEVBQVMwQixpQkFBaUIsQ0FBQ0YsRUFBT0wsS0FDaEMsR0FBSUssRUFDRlYsRUFBU1UsRUFBTyxVQUNYLENBRUwsTUFBTWUsRUFBV3BCLEVBQVlnQixJQUFJLENBQUNDLEVBQUdyRSxJQUFNb0QsRUFBWXBELEdBQUdpRSxjQUVwRFEsRUFBaUJELEVBQVNSLE9BQU8sQ0FBQ0ssRUFBR3JFLElBQU13RSxFQUFTRCxRQUFRRixJQUFNckUsR0FDeEUrQyxFQUFTLEtBQU0wQixNQVFyQjNCLHdCQUF3QmMsR0FDdEIsOEJBQWdDQSxFQUFXRixLQU03Q1osNkJBQTZCYyxHQUMzQixPQUFJQSxFQUFXYyxtQkFHQ2QsRUFBV2MseUJBRlRkLEVBQVdGLFNBUS9CWiw4QkFBOEJjLEVBQVlRLEdBRXhDLE1BQU1PLEVBQVMsSUFBSUMsRUFBRUQsT0FBTyxDQUFDZixFQUFXaUIsT0FBT0MsSUFBS2xCLEVBQVdpQixPQUFPRSxLQUNwRSxDQUFDQyxNQUFPcEIsRUFBV3JELEtBQ25CMEUsSUFBS3JCLEVBQVdyRCxLQUNoQjJFLElBQUtqRCxFQUFTa0QsaUJBQWlCdkIsS0FHakMsT0FERWUsRUFBT1MsTUFBTUMsUUFDUlYsRUFHVDdCLG9DQUFvQ3dDLEdBRWxDLE9BREFDLFFBQVFDLElBQUksZ0NBQWlDRixHQUN0Q25ELEVBQVVjLEtBQU1YLElBQ3JCLE1BQU1tRCxFQUFLbkQsRUFBR29ELFlBQVksVUFBVyxhQUMvQkMsRUFBUUYsRUFBR0csWUFBWSxXQUk3QixPQUhBTCxRQUFRQyxJQUFJLDJCQUNaRyxFQUFNRSxJQUFJUCxHQUNWQyxRQUFRQyxJQUFJLG9DQUNMQyxFQUFHSyxPQUlkaEQscUJBQXFCd0MsR0FJbkIsTUFBTUosRUFBTWpELEVBQVNZLHFCQUdyQixPQURBWixFQUFTOEQsNkJBQTZCVCxHQUMvQnJELEVBQVMrRCx1QkFBdUJkLEVBRnhCLE9BRXFDSSxHQUFVckMsS0FBS0UsR0FBUUEsR0FJN0VMLDhCQUE4Qm9DLEVBQUtlLEVBQVFYLEdBRXpDLE9BQU8sSUFBSVksUUFBUSxDQUFDQyxFQUFTQyxLQUMzQmpFLEVBQVVjLEtBQUtYLElBQ0pBLEVBQUdvRCxZQUFZLFVBQVcsYUFDcEJFLFlBQVksV0FDdkJDLElBQUksQ0FDUlEsS0FBTSxDQUNKbkIsTUFDQWUsU0FDQVgsZ0JBR0g5QixNQUFNQyxJQUNQOEIsUUFBUUMsSUFBSS9CLEtBQ1hSLEtBQUtoQixFQUFTcUUsWUFBWSxDQUFDN0MsRUFBT04sS0FDbkNvQyxRQUFRQyxJQUFJckMsR0FDTGdELEVBQVFoRCxRQUtuQkwsbUJBQW1CQyxHQUNqQmQsRUFBU3NFLHFCQUFxQnRFLEVBQVNxRSxhQUFhckQsS0FBS3VELElBQ3ZEakIsUUFBUUMsSUFBSWdCLEdBQ1p6RCxFQUFTLEtBQU15RCxLQUluQjFELDRCQUE0QkMsR0FFMUIsSUFBSW1DLEVBQ0FlLEVBQ0FRLEVBRUosT0FBTyxJQUFJUCxRQUFTLENBQUNDLEVBQVNDLEtBQWFqRSxFQUFVYyxLQUFLWCxJQUN4RCxJQUFLQSxFQUFHb0UsaUJBQWlCQyxPQUd2QixPQUZBcEIsUUFBUUMsSUFBSSx5QkFDWmxELEVBQUdzRSxRQUdNdEUsRUFBR29ELFlBQVksVUFBVyxhQUNwQkUsWUFBWSxXQUN2QmlCLGFBQWE1RCxLQUFNNkQsSUFDdkIsSUFBS0EsRUFDRCxPQUVVQSxFQUFPN0YsTUFRckIsR0FQQWlFLEVBQU00QixFQUFPN0YsTUFBTW9GLEtBQUtuQixJQUN4QmUsRUFBU2EsRUFBTzdGLE1BQU1vRixLQUFLSixPQUMzQlEsRUFBT0ssRUFBTzdGLE1BQU1vRixLQUFLZixVQUtuQkosSUFBUWUsR0FBdUIsU0FBWEEsSUFBc0JRLEVBSTlDLFlBSEFLLEVBQ0dDLFNBQ0E5RCxLQUFLRixLQUlWLE1BQU1pRSxFQUFhLENBQ2pCUCxLQUFNUSxLQUFLQyxVQUFVVCxHQUNyQlIsT0FBUUEsR0FFVmpELE1BQU1rQyxFQUFLOEIsR0FBWS9ELEtBQUtDLEdBRXJCQSxFQUFTaUUsSUFBT2pFLEVBQVNrRSxXQUt2QmxFLEVBQVNDLFFBSmRvQyxRQUFRQyxJQUFJLGdEQUNaRCxRQUFRQyxJQUFJdEMsS0FJYkQsS0FBTXVELElBQ09sRSxFQUFHb0QsWUFBWSxVQUFXLGFBQ3BCRSxZQUFZLFdBQzFCaUIsYUFDSDVELEtBQU02RCxJQUNMQSxFQUFPQyxTQUNOOUQsS0FBSyxLQUNKRixJQUNBd0MsUUFBUUMsSUFBSWdCLEdBQ0xMLEVBQVFLLE9BR3JCakIsUUFBUUMsSUFBSSxxQ0FDWGhDLE1BQU1DLElBQ1A4QixRQUFRQyxJQUFJL0IsV0FRcEJYLHNCQUFzQmMsR0FDbkIsSUFDRSxJQUFJc0IsdUNBQTJDdEIsRUFBV0YsbUJBQW1CRSxFQUFXeUQsY0FFeEYsT0FBT3JFLE1BQU1rQyxFQURBLENBQUNlLE9BQVEsUUFDSWhELEtBQUssU0FBU25DLEdBQUksT0FBT0EsRUFBRXFDLFNBRXZELE1BQU1tRSxHQUNKL0IsUUFBUUMsSUFBSSw0Q0FBNkM4QixFQUFHMUQsSUFHOURkLDRCQUE0QnlFLEdBQzFCLE9BQU9wRixFQUFVYyxLQUFLLFNBQVNYLEdBQzdCLElBQUltRCxFQUFLbkQsRUFBR29ELFlBQVksY0FBZSxhQUd2QyxPQUZZRCxFQUFHRyxZQUFZLGVBQ3JCQyxJQUFJMEIsR0FDSDlCLEVBQUcrQixXQUNUdkUsS0FBSyxXQUNMLE9BQU9pRCxRQUFRQyxRQUFRb0IsS0FJL0J6RSxvQkFBb0JPLEdBQ2xCLE9BQU9sQixFQUFVYyxLQUFNWCxJQUdyQixPQUZTQSxFQUFHb0QsWUFBWSxlQUNURSxZQUFZLGVBQ2QvRSxJQUFJd0MsS0FDaEJKLEtBQU1XLElBQ1AyQixRQUFRQyxJQUFJNUIsR0FDWixNQUFNMkQsRUFBaUI3RyxPQUFPK0csT0FBTyxHQUFJN0QsR0FJekMsT0FIQTJELEVBQWVGLFlBQTBDLFNBQTNCekQsRUFBV3lELGNBQXFELElBQTNCekQsRUFBV3lELFlBQzlFLFFBQVUsT0FDVnBGLEVBQVN5RixlQUFlSCxHQUNqQnRGLEVBQVMwRixxQkFBcUJKLEtBQ3BDdEUsS0FBTXNFLElBQ1AsTUFBTUssRUFBU0MsU0FBU0MsMEJBQTBCUCxFQUFlN0QsTUFDL0IsU0FBL0I2RCxFQUFlRixjQUF5RCxJQUEvQkUsRUFBZUYsYUFDekRPLEVBQU9HLFVBQVksYUFDbkJILEVBQU9JLE1BQU1DLFdBQWEsWUFFMUJMLEVBQU9HLFVBQVksa0JBQ25CSCxFQUFPSSxNQUFNQyxXQUFhLDBDQzFYbEMsTUFBQUMsRUFBQSxDQUFBeEcsRUFBQXlHLE1BQUFDLEtBQUEvSCxHQUFBcUIsYUFBQXJCLEdBRUEsSUFBQWdJLEVBQ0FDLEVBY0EsTUFBQUMsRUFBQSxJQUFBQyxRQUNBQyxFQUFBLElBQUFELFFBQ0FFLEVBQUEsSUFBQUYsUUFDQUcsRUFBQSxJQUFBSCxRQUNBSSxFQUFBLElBQUFKLFFBdURBLElBQUFLLEVBQUEsQ0FDQS9GLElBQUFnRyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFGLGFBQUFHLGVBQUEsQ0FFQSxZQUFBRixFQUNBLE9BQUFOLEVBQUE1SCxJQUFBaUksR0FFQSx3QkFBQUMsRUFDQSxPQUFBRCxFQUFBcEMsa0JBQUFnQyxFQUFBN0gsSUFBQWlJLEdBR0EsYUFBQUMsRUFDQSxPQUFBQyxFQUFBdEMsaUJBQUEsUUFDQXdDLEVBQUFGLEVBQUFwRCxZQUFBb0QsRUFBQXRDLGlCQUFBLElBSUEsT0FBQXlDLEVBQUFMLEVBQUFDLEtBRUFLLElBQUEsQ0FBQU4sRUFBQUMsSUFDQUQsYUFBQUcsaUJBQUEsU0FBQUYsR0FBQSxVQUFBQSxJQUVBQSxLQUFBRCxHQU1BLFNBQUFPLEVBQUFDLEdBSUEsT0FBQUEsSUFBQUMsWUFBQTNILFVBQUE4RCxhQUNBLHFCQUFBdUQsZUFBQXJILFVBQ0EsU0FBQTRILEtBQUFDLEdBQ0EsTUFBQWhFLEVBQUE2RCxFQUFBbkosS0FBQXVKLEVBQUFDLE1BQUFILEtBQUFDLEdBRUEsT0FEQWYsRUFBQWtCLElBQUFuRSxFQUFBK0QsRUFBQUssS0FBQUwsRUFBQUssT0FBQSxDQUFBTCxJQUNBTCxFQUFBMUQsS0F0R0E2QyxNQUFBLENBQ0F3QixVQUFBbEksVUFBQW1JLFFBQ0FELFVBQUFsSSxVQUFBb0ksU0FDQUYsVUFBQWxJLFVBQUFxSSxzQkEyR0FDLFNBQUFaLEdBQ0EsWUFBQUcsR0FJQSxPQURBSCxFQUFBYSxNQUFBVCxFQUFBQyxNQUFBRixHQUNBTixFQUFBWixFQUFBMUgsSUFBQThJLFFBR0EsWUFBQUYsR0FHQSxPQUFBTixFQUFBRyxFQUFBYSxNQUFBVCxFQUFBQyxNQUFBRixLQUdBLFNBQUFXLEVBQUFuSixHQUNBLHlCQUFBQSxFQUNBb0ksRUFBQXBJLElBR0FBLGFBQUFnSSxnQkF6RkEsU0FBQXhELEdBRUEsR0FBQWdELEVBQUFXLElBQUEzRCxHQUNBLE9BQ0EsTUFBQUssRUFBQSxJQUFBSSxRQUFBLENBQUFDLEVBQUFDLEtBQ0EsTUFBQWlFLEVBQUEsS0FDQTVFLEVBQUE2RSxvQkFBQSxXQUFBOUMsR0FDQS9CLEVBQUE2RSxvQkFBQSxRQUFBN0csR0FDQWdDLEVBQUE2RSxvQkFBQSxRQUFBN0csSUFFQStELEVBQUEsS0FDQXJCLElBQ0FrRSxLQUVBNUcsRUFBQSxLQUNBMkMsRUFBQVgsRUFBQWhDLE9BQ0E0RyxLQUVBNUUsRUFBQThFLGlCQUFBLFdBQUEvQyxHQUNBL0IsRUFBQThFLGlCQUFBLFFBQUE5RyxHQUNBZ0MsRUFBQThFLGlCQUFBLFFBQUE5RyxLQUdBZ0YsRUFBQW1CLElBQUFuRSxFQUFBSyxHQW1FQTBFLENBQUF2SixHQUNBaUgsRUFBQWpILEVBeElBb0gsSUFDQUEsRUFBQSxDQUFBa0IsWUFBQWtCLGVBQUFDLFNBQUFaLFVBQUFiLGtCQXdJQSxJQUFBMEIsTUFBQTFKLEVBQUE0SCxHQUVBNUgsR0FFQSxTQUFBa0ksRUFBQWxJLEdBR0EsR0FBQUEsYUFBQTJKLFdBQ0EsT0FqSUEsU0FBQUMsR0FDQSxNQUFBQyxFQUFBLElBQUE1RSxRQUFBLENBQUFDLEVBQUFDLEtBQ0EsTUFBQWlFLEVBQUEsS0FDQVEsRUFBQVAsb0JBQUEsVUFBQVMsR0FDQUYsRUFBQVAsb0JBQUEsUUFBQTdHLElBRUFzSCxFQUFBLEtBQ0E1RSxFQUFBZ0QsRUFBQTBCLEVBQUFHLFNBQ0FYLEtBRUE1RyxFQUFBLEtBQ0EyQyxFQUFBeUUsRUFBQXBILE9BQ0E0RyxLQUVBUSxFQUFBTixpQkFBQSxVQUFBUSxHQUNBRixFQUFBTixpQkFBQSxRQUFBOUcsS0FZQSxPQVZBcUgsRUFBQTdILEtBQUFoQyxJQUdBQSxhQUFBNkksV0FDQXZCLEVBQUFxQixJQUFBM0ksRUFBQTRKLEtBS0FqQyxFQUFBZ0IsSUFBQWtCLEVBQUFELEdBQ0FDLEVBc0dBRyxDQUFBaEssR0FHQSxHQUFBMEgsRUFBQVMsSUFBQW5JLEdBQ0EsT0FBQTBILEVBQUE5SCxJQUFBSSxHQUNBLE1BQUFpSyxFQUFBZCxFQUFBbkosR0FPQSxPQUpBaUssSUFBQWpLLElBQ0EwSCxFQUFBaUIsSUFBQTNJLEVBQUFpSyxHQUNBdEMsRUFBQWdCLElBQUFzQixFQUFBakssSUFFQWlLLEVBRUEsTUFBQXhCLEVBQUF6SSxHQUFBMkgsRUFBQS9ILElBQUFJLEdDM0pBLFNBQUFtQixFQUFBN0IsRUFBQTRLLEdBQUFDLFFBQWdDQSxFQUFBL0ksVUFBQWdKLFlBQTZCLElBQzdELE1BQUFSLEVBQUFTLFVBQUFDLEtBQUFoTCxFQUFBNEssR0FDQUssRUFBd0JyQyxFQUFJMEIsR0FVNUIsT0FUQXhJLEdBQ0F3SSxFQUFBTixpQkFBQSxnQkFBQWtCLElBQ0FwSixFQUFvQjhHLEVBQUkwQixFQUFBRyxRQUFBUyxFQUFBbEosV0FBQWtKLEVBQUFDLFdBQXNEdkMsRUFBSTBCLEVBQUFuRixnQkFHbEYwRixHQUNBUCxFQUFBTixpQkFBQSxjQUFBYSxLQUNBQyxHQUNBRyxFQUFBdkksS0FBQVgsS0FBQWlJLGlCQUFBLGdCQUFBYyxJQUNBRyxFQXRCQTVMLEVBQUFVLEVBQUEwQixFQUFBLHNCQUFBSSxJQW9DQSxNQUFBdUosRUFBQSwrQ0FDQUMsRUFBQSwrQkFDQUMsRUFBQSxJQUFBQyxJQUNBLFNBQUFDLEVBQUFqRCxFQUFBQyxHQUNBLEtBQUFELGFBQUFTLGNBQ0FSLEtBQUFELEdBQ0EsaUJBQUFDLEVBQ0EsT0FDQSxHQUFBOEMsRUFBQWhMLElBQUFrSSxHQUNBLE9BQUE4QyxFQUFBaEwsSUFBQWtJLEdBQ0EsTUFBQWlELEVBQUFqRCxFQUFBa0QsUUFBQSxpQkFDQUMsRUFBQW5ELElBQUFpRCxFQUVBLEtBQUFBLEtBQUFFLEVBQUF4QixTQUFBRCxnQkFBQTdJLFdBQ0EsT0FFQSxJQUFBcUUsRUFrQkEsT0FqQkEwRixFQUFBekIsU0FBQThCLEtBQ0EvRixFQUFBLFNBQUFrRyxLQUFBMUMsR0FDQSxJQUFBWCxFQUFBYSxLQUFBakUsWUFBQXlHLEdBQUF4RyxNQUdBLE9BRkF1RyxJQUNBcEQsSUFBQXNELE1BQUEzQyxFQUFBNEMsVUFDQXZELEVBQUFrRCxNQUFBdkMsS0FHQW1DLEVBQUExQixTQUFBOEIsS0FDQS9GLEVBQUEsU0FBQWtHLEtBQUExQyxHQUNBLE1BQUFoRSxFQUFBa0UsS0FBQWpFLFlBQUF5RyxFQUFBLGFBRUEsT0FEQTFHLEVBQUFFLE1BQUFxRyxNQUFBdkMsR0FDQWhFLEVBQUFLLE9BR0FHLEdBQ0E0RixFQUFBakMsSUFBQWIsRUFBQTlDLEdBQ0FBLEVEZ0NBNEMsRUM5QlF5RCxLQUFBLENBQ1J6TCxJQUFBLENBQUFpSSxFQUFBQyxFQUFBQyxJQUFBK0MsRUFBQWpELEVBQUFDLElBQUF1RCxFQUFBekwsSUFBQWlJLEVBQUFDLEVBQUFDLEdBQ0FJLElBQUEsQ0FBQU4sRUFBQUMsTUFBQWdELEVBQUFqRCxFQUFBQyxJQUFBdUQsRUFBQWxELElBQUFOLEVBQUFDLEtENEJBaEcsQ0FBQThGLGlDRXRHQWpKLEVBQUFrQixFQUFBa0IsR0FBZUEsRUFBQSxtQkFFVCxrQkFBbUJ1SyxXQUN0QkMsT0FBT2pDLGlCQUFpQixPQUFRLEtBQzlCZ0MsVUFBVUUsY0FBY0MsU0FBUyw0QkFBNEJ6SixLQUFLMEosSUFDaEVwSCxRQUFRQyxJQUFJLGtCQUFtQm1ILEtBQzlCbkosTUFBTW9KLElBQ1BySCxRQUFRQyxJQUFJLDJCQUE0Qm9ILGtGQ1AvQ2hOLEVBQUFrQixFQUFBa0IsR0FBQXBDLEVBQUEsT0FBQWlOLEVBQUFqTixFQUFBLEdBR0EsSUFDSWtOLEVBQ0osSUFBSXpILEVBS0p3QyxTQUFTMEMsaUJBQWlCLG1CQUFxQmtCLElBQzdDc0IsS0FFQUQsRUFBWWpGLFNBQVNDLGVBQWUsb0JBQzFCeUMsaUJBQWlCLFFBQVN5QyxLQU10QyxNQUFNRCxFQUFVLEtBQ2RFLEVBQXVCLENBQUN4SixFQUFPRyxLQUN6QkgsRUFDRjhCLFFBQVE5QixNQUFNQSxJQUVkNEIsRUFBU1QsRUFBRVIsSUFBSSxNQUFPLENBQ3BCOEksT0FBUSxDQUFDdEosRUFBV2lCLE9BQU9DLElBQUtsQixFQUFXaUIsT0FBT0UsS0FDbERvSSxLQUFNLEdBQ05DLGlCQUFpQixJQUVuQkMsS0FBS2hJLE9BQVNBLEVBQ2RULEVBQUUwSSxVQUFVLG9GQUFxRixDQUMvRkMsWUFBYSwyRkFDYkMsUUFBUyxHQUNUQyxZQUFhLDBOQUdiL0osR0FBSSxtQkFDSDBCLE1BQU1DLEdBQ1RxSSxJQUNBekwsVUFBUzBMLHVCQUF1Qk4sS0FBS3pKLFdBQVl5SixLQUFLaEksV0FHMURwRCxVQUFTcUUsZUFzQkwyRyxFQUEwQmxLLElBQzlCLEdBQUlzSyxLQUFLekosV0FHUCxPQUZBYixFQUFTLEtBQU1zSyxLQUFLekosaUJBQ3BCMkIsUUFBUUMsSUFBSSxtQ0FJZCxNQUFNOUIsRUFBS2tLLEVBQW1CLE1BQ3pCbEssRUFJSHpCLFVBQVM0TCxvQkFBb0JuSyxFQUFJLENBQUNELEVBQU9HLEtBQ3ZDeUosS0FBS3pKLFdBQWFBLEVBQ2JBLEdBSUxrSyxJQUNBL0ssRUFBUyxLQUFNYSxJQUpiMkIsUUFBUTlCLE1BQU1BLE1BTmxCQSxNQUFRLDBCQUNSVixFQUFTVSxNQUFPLFFBZ0JkcUssRUFBcUIsQ0FBQ2xLLEVBQWF5SixLQUFLekosY0FDL0JpRSxTQUFTQyxlQUFlLG1CQUNoQ0MsVUFBWW5FLEVBQVdyRCxLQUVac0gsU0FBU0MsZUFBZSxzQkFDaENDLGNBQWdCbkUsRUFBV3JELGFBQWFxRCxFQUFXbUssVUFFM0QsTUFBTUMsRUFBUW5HLFNBQVNDLGVBQWUsa0JBQ3RDa0csRUFBTUMsVUFBWSxpQkFDbEJELEVBQU1FLElBQU1qTSxVQUFTa00sc0JBQXNCdkssR0FFM0JpRSxTQUFTQyxlQUFlLHNCQUNoQ0MsVUFBWW5FLEVBQVdLLGFBRzNCTCxFQUFXd0ssaUJBQ2JDLElBR0ZwTSxVQUFTcU0sYUFBYTFLLEVBQVdGLEdBQUksQ0FBQ0QsRUFBT0YsS0FDM0NnTCxFQUFnQmhMLE1BU2Q4SyxFQUEwQixDQUFDRyxFQUFpQm5CLEtBQUt6SixXQUFXd0ssbUJBQ2hFLE1BQU1LLEVBQVE1RyxTQUFTQyxlQUFlLG9CQUN0QyxJQUFLLElBQUl2RyxLQUFPaU4sRUFBZ0IsQ0FDOUIsTUFBTUUsRUFBTTdHLFNBQVM4RyxjQUFjLE1BRTdCQyxFQUFNL0csU0FBUzhHLGNBQWMsTUFDbkNDLEVBQUk3RyxVQUFZeEcsRUFDaEJtTixFQUFJRyxZQUFZRCxHQUVoQixNQUFNRSxFQUFPakgsU0FBUzhHLGNBQWMsTUFDcENHLEVBQUsvRyxVQUFZeUcsRUFBZWpOLEdBQ2hDbU4sRUFBSUcsWUFBWUMsR0FFaEJMLEVBQU1JLFlBQVlILEtBT2hCSCxFQUFrQixDQUFDaEwsRUFBVThKLEtBQUt6SixXQUFXTCxXQUNqRCxNQUFNd0wsRUFBWWxILFNBQVNDLGVBQWUscUJBQ3BDOUMsRUFBUTZDLFNBQVM4RyxjQUFjLE1BSXJDLEdBSEEzSixFQUFNK0MsVUFBWSxVQUNsQmdILEVBQVVGLFlBQVk3SixJQUVqQnpCLEVBQVMsQ0FDWixNQUFNeUwsRUFBWW5ILFNBQVM4RyxjQUFjLEtBR3pDLE9BRkFLLEVBQVVqSCxVQUFZLHVCQUN0QmdILEVBQVVGLFlBQVlHLEdBR3hCLE1BQU1DLEVBQUtwSCxTQUFTQyxlQUFlLGdCQUNuQ3ZFLEVBQVEyTCxRQUFRQyxJQUNkRixFQUFHSixZQUFZTyxFQUFpQkQsTUFFbENKLEVBQVVGLFlBQVlJLElBTWxCRyxFQUFvQkQsSUFDeEIsTUFBTUUsRUFBS3hILFNBQVM4RyxjQUFjLE1BQ2xDVSxFQUFHQyxhQUFhLGtCQUFtQkgsRUFBT3pMLE1BQzFDLE1BQU1uRCxFQUFPc0gsU0FBUzhHLGNBQWMsS0FDcENwTyxFQUFLd0gsVUFBWW9ILEVBQU81TyxLQUN4QjhPLEVBQUdSLFlBQVl0TyxHQUVmLE1BQU1nUCxFQUFPMUgsU0FBUzhHLGNBQWMsS0FDcENZLEVBQUt4SCxVQUFZLDZCQUFnQyxJQUFJeUgsS0FBS0wsRUFBT00sV0FBWUMsZUFDN0VMLEVBQUdSLFlBQVlVLEdBRWYsTUFBTUksRUFBUzlILFNBQVM4RyxjQUFjLEtBQ3RDZ0IsRUFBTzVILHFCQUF1Qm9ILEVBQU9RLFNBQ3JDTixFQUFHUixZQUFZYyxHQUVmLE1BQU1DLEVBQVcvSCxTQUFTOEcsY0FBYyxLQUt4QyxPQUpBaUIsRUFBUzdILFVBQVlvSCxFQUFPUyxTQUM1QlAsRUFBR1IsWUFBWWUsR0FHUlAsR0FNSDNCLEVBQWlCLENBQUM5SixFQUFXeUosS0FBS3pKLGNBQ3RDLE1BQU1pTSxFQUFhaEksU0FBU0MsZUFBZSxjQUNyQ3VILEVBQUt4SCxTQUFTOEcsY0FBYyxNQUNsQ1UsRUFBR3RILFVBQVluRSxFQUFXckQsS0FDMUJzUCxFQUFXaEIsWUFBWVEsSUFNbkJ6QixFQUFxQixDQUFDck4sRUFBTTJFLEtBQzNCQSxJQUNIQSxFQUFNc0gsT0FBT3NELFNBQVNDLE1BQ3hCeFAsRUFBT0EsRUFBSzBMLFFBQVEsVUFBVyxRQUMvQixNQUNFbEksRUFEWSxJQUFJaU0sY0FBY3pQLHNCQUNkMFAsS0FBSy9LLEdBQ3ZCLE9BQUtuQixFQUVBQSxFQUFRLEdBRU5tTSxtQkFBbUJuTSxFQUFRLEdBQUdrSSxRQUFRLE1BQU8sTUFEM0MsR0FGQSxNQU1MZSxFQUFlLEtBQ25CekgsUUFBUUMsSUFBSSwwQkFFWixJQUFJRixFQUFXNkssSUFDWCxrQkFBa0JDLEtBQUs5SyxFQUFTL0UsTUFJaEMsY0FBYzZQLEtBQUs5SyxFQUFTcUssUUFJN0JySyxFQUFTc0ssU0FBU2pKLE9BQVMsRUFDNUIwSixNQUFNLG1EQUdSL0ssRUFBU2pDLGNBQWdCZ0ssS0FBS3pKLFdBQVdGLEdBQ3pDekIsVUFBU3FPLGNBQWNoTCxHQUFVckMsS0FBTStILElBQ3JDekYsUUFBUUMsSUFBSXdGLEdBRVpxRixNQURlLGtCQUVmLElBQUlFLEVBQW1CbkIsRUFBaUJwRSxHQUM3Qm5ELFNBQVNDLGVBQWUsZ0JBQ2hDK0csWUFBWTBCLEdBQ2YsSUFBSUMsRUFBVTNJLFNBQVNDLDRCQUE0QmtELEVBQU90SCxNQUN2RDhNLEVBQVFDLGdCQUFrQkQsRUFBUUMsZUFBZUMsY0FBZ0JDLFVBQ2xFSCxFQUFRQyxnQkFBZSxNQWpCekJKLE1BQU0sc0NBSk5BLE1BQU0sNkRBMEJKRixFQUFnQixLQUNiLENBQ0w1UCxLQUFNc0gsU0FBU0MsZUFBZSxRQUFRN0csTUFBTTJQLE9BQzVDakIsT0FBUTlILFNBQVNDLGVBQWUsVUFBVTdHLE1BQU0yUCxPQUNoRGhCLFNBQVUvSCxTQUFTQyxlQUFlLGdCQUFnQjdHLE1BQU0yUCIsImZpbGUiOiJyZXN0YXVyYW50LmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA1KTtcbiIsIi8qKlxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4gKi9cbmltcG9ydCB7IG9wZW5EQiwgZGVsZXRlREIsIHdyYXAsIHVud3JhcCB9IGZyb20gJ2lkYic7XG5cbmNvbnN0IGRiUHJvbWlzZSA9IG9wZW5EQigncnItZGInLCAzLCB7XG4gIHVwZ3JhZGUoZGIsIG9sZFZlcnNpb24pIHtcbiAgICBzd2l0Y2ggKG9sZFZlcnNpb24pIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7IGtleVBhdGg6ICdpZCcsIH0pO1xuICAgICAgICBzdG9yZS5jcmVhdGVJbmRleCgnaWQnLCAnaWQnKTtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgY29uc3QgcmV2aWV3c1N0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJyxcbiAgICAgICAgICBhdXRvSW5jcmVtZW50OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXZpZXdzU3RvcmUuY3JlYXRlSW5kZXgoXCJyZXN0YXVyYW50X2lkXCIsIFwicmVzdGF1cmFudF9pZFwiKTtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgY29uc3QgcGVuZGluZ1N0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3BlbmRpbmcnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJyxcbiAgICAgICAgICBhdXRvSW5jcmVtZW50OiB0cnVlXG4gICAgICAgIH0pXG4gICAgfVxuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgREJIZWxwZXIge1xuXG4gIC8qKlxuICAgKiBEYXRhYmFzZSBVUkwuXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cbiAgICovXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xuICAgIGNvbnN0IHBvcnQgPSAxMzM3Ly8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfUkVWSUVXU19VUkwoKSB7XG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jldmlld3NgO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cbiAgICovXG5cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24ocmVzdGF1cmFudHMpIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgZmV0Y2hSZXZpZXdzKCByZXN0YXVyYW50X2lkLCBjYWxsYmFjaykge1xuICAgIGxldCBmZXRjaFVSTCA9IERCSGVscGVyLkRBVEFCQVNFX1JFVklFV1NfVVJMICsgXCIvP3Jlc3RhdXJhbnRfaWQ9XCIgKyByZXN0YXVyYW50X2lkO1xuICAgIGZldGNoKGZldGNoVVJMKS50aGVuKCByZXNwb25zZSA9PiB7XG4gICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgIH0pLnRoZW4ocmV2aWV3cyA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8vICAgc3RhdGljIGZldGNoUmVzdGF1cmFudFJldmlld3NCeUlkKGlkLCBjYWxsYmFjaykge1xuICAvLyAgIC8vIEZldGNoIGFsbCByZXZpZXdzIGZvciB0aGUgc3BlY2lmaWMgcmVzdGF1cmFudFxuICAvLyAgIGNvbnN0IGZldGNoVVJMID0gREJIZWxwZXIuREFUQUJBU0VfUkVWSUVXU19VUkwgKyBcIi8/cmVzdGF1cmFudF9pZD1cIiArIGlkO1xuICAvLyAgIGZldGNoKGZldGNoVVJMLCB7bWV0aG9kOiBcIkdFVFwifSkudGhlbihyZXNwb25zZSA9PiB7XG4gIC8vICAgICBpZiAoIXJlc3BvbnNlLmNsb25lKCkub2sgJiYgIXJlc3BvbnNlLmNsb25lKCkucmVkaXJlY3RlZCkge1xuICAvLyAgICAgICB0aHJvdyBcIk5vIHJldmlld3MgYXZhaWxhYmxlXCI7XG4gIC8vICAgICB9XG4gIC8vICAgICByZXNwb25zZVxuICAvLyAgICAgICAuanNvbigpXG4gIC8vICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gIC8vICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgLy8gICAgICAgfSlcbiAgLy8gICB9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuICAvLyB9XG4gIC8qKlxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAqL1xuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgKi9cbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgaWYoIXJlc3RhdXJhbnQucGhvdG9ncmFwaCkge1xuICAgICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQuaWR9LmpwZ2ApXG4gICAgfVxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICovXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuICAgIC8vIGh0dHBzOi8vbGVhZmxldGpzLmNvbS9yZWZlcmVuY2UtMS4zLjAuaHRtbCNtYXJrZXJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcbiAgICAgIHt0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgYWx0OiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcbiAgICAgIH0pXG4gICAgICBtYXJrZXIuYWRkVG8obmV3TWFwKTtcbiAgICByZXR1cm4gbWFya2VyO1xuICB9XG5cbiAgc3RhdGljIHVwZGF0ZUNhY2hlZFJlc3RhdXJhbnRSZXZpZXcoZm9ybURhdGEpIHtcbiAgICBjb25zb2xlLmxvZygndXBkYXRpbmcgY2FjaGUgZm9yIG5ldyByZXZpZXcnLCBmb3JtRGF0YSk7XG4gICAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xuICAgICAgY29uc29sZS5sb2coJ3B1dHRpbmcgcmV2aWV3IGluIHN0b3JlJyk7XG4gICAgICBzdG9yZS5wdXQoZm9ybURhdGEpO1xuICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3NmdWxseSBwdXQgcmV2aWV3IGluIHN0b3JlJyk7XG4gICAgICByZXR1cm4gdHguZG9uZTtcbiAgICB9KVxuICB9XG5cbiAgc3RhdGljIHNhdmVOZXdSZXZpZXcoZm9ybURhdGEpIHtcbiAgICAvLyBCbG9jayBhbnkgbW9yZSBjbGlja3Mgb24gdGhlIHN1Ym1pdCBidXR0b24gdW50aWwgdGhlIGNhbGxiYWNrXG4gICAgLy8gY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdWJtaXQtZm9ybS1idG5cIik7XG4gICAgLy8gYnRuLm9uY2xpY2sgPSBudWxsO1xuICAgIGNvbnN0IHVybCA9IERCSGVscGVyLkRBVEFCQVNFX1JFVklFV1NfVVJMO1xuICAgIGNvbnN0IG1ldGhvZCA9IFwiUE9TVFwiO1xuICAgIERCSGVscGVyLnVwZGF0ZUNhY2hlZFJlc3RhdXJhbnRSZXZpZXcoZm9ybURhdGEpO1xuICAgIHJldHVybiBEQkhlbHBlci5hZGRQZW5kaW5nUmVxdWVzdFRvUXVlKHVybCwgbWV0aG9kLCBmb3JtRGF0YSkudGhlbihqc29uID0+IGpzb24pO1xuXG4gIH1cblxuICBzdGF0aWMgYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSh1cmwsIG1ldGhvZCwgZm9ybURhdGEpIHtcbiAgICAvL29wZW4gZGF0YWJhc2UgYW5kIGFkZCByZXF1ZXN0IGRldGFpbHMgdG8gdGhlIHBlbmRpbmcgc3RvcmVcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncGVuZGluZycsICdyZWFkd3JpdGUnKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3BlbmRpbmcnKTtcbiAgICAgIHN0b3JlLnB1dCh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgIGZvcm1EYXRhXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIH0pLnRoZW4oREJIZWxwZXIubmV4dFBlbmRpbmcoKGVycm9yLCBqc29uKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhqc29uKTtcbiAgICAgIHJldHVybiByZXNvbHZlKGpzb24pO1xuICAgIH0pKTtcbiAgfSk7XG4gIH1cblxuICBzdGF0aWMgbmV4dFBlbmRpbmcoY2FsbGJhY2spIHtcbiAgICBEQkhlbHBlci5hdHRlbXB0Q29tbWl0UGVuZGluZyhEQkhlbHBlci5uZXh0UGVuZGluZykudGhlbihqID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGopO1xuICAgICAgY2FsbGJhY2sobnVsbCwgaik7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgYXR0ZW1wdENvbW1pdFBlbmRpbmcoY2FsbGJhY2spIHtcbiAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIHBlbmRpbmcgaXRlbXMgdW50aWwgdGhlcmUgaXMgYSBuZXR3b3JrIGZhaWx1cmVcbiAgICBsZXQgdXJsO1xuICAgIGxldCBtZXRob2Q7XG4gICAgbGV0IGJvZHk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoIChyZXNvbHZlLCByZWplY3QpID0+IHsgZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmxlbmd0aCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkRCIG5vdCBhdmFpbGFibGVcIik7XG4gICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3BlbmRpbmcnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdwZW5kaW5nJyk7XG4gICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkudGhlbiggY3Vyc29yID0+IHtcbiAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0gY3Vyc29yLnZhbHVlO1xuICAgICAgICB1cmwgPSBjdXJzb3IudmFsdWUuZGF0YS51cmw7XG4gICAgICAgIG1ldGhvZCA9IGN1cnNvci52YWx1ZS5kYXRhLm1ldGhvZDtcbiAgICAgICAgYm9keSA9IGN1cnNvci52YWx1ZS5kYXRhLmZvcm1EYXRhO1xuXG5cbiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHBhcmFtZXRlciB0aGVuIHdlJ3JlIG9uIGEgYmFkIHJlY29yZCB0aGF0IHNob3VsZCBiZSB0b3NzZWRcbiAgICAgICAgLy8gYW5kIHRoZW4gbW92ZSBvblxuICAgICAgICBpZiAoKCF1cmwgfHwgIW1ldGhvZCkgfHwgKG1ldGhvZCA9PT0gXCJQT1NUXCIgJiYgIWJvZHkpKSB7XG4gICAgICAgICAgY3Vyc29yXG4gICAgICAgICAgICAuZGVsZXRlKClcbiAgICAgICAgICAgIC50aGVuKGNhbGxiYWNrKCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0ge1xuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxuICAgICAgICAgIG1ldGhvZDogbWV0aG9kXG4gICAgICAgIH1cbiAgICAgICAgZmV0Y2godXJsLCBwcm9wZXJ0aWVzKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgZ2V0IGEgZ29vZCByZXNwb25zZSB0aGVuIGFzc3VtZSB3ZSdyZSBvZmZsaW5lXG4gICAgICAgICAgaWYgKCFyZXNwb25zZS5vayAmJiAhcmVzcG9uc2UucmVkaXJlY3RlZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIHJlc3BvbnNlIGFuZCB3ZSBhcmUgb2ZmbGluZScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9KS50aGVuKCBqID0+IHtcbiAgICAgICAgICBjb25zdCBkZWx0eCA9IGRiLnRyYW5zYWN0aW9uKCdwZW5kaW5nJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIGNvbnN0IHN0b3JlID0gZGVsdHgub2JqZWN0U3RvcmUoJ3BlbmRpbmcnKTtcbiAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKClcbiAgICAgICAgICAgIC50aGVuKCBjdXJzb3IgPT4ge1xuICAgICAgICAgICAgICBjdXJzb3IuZGVsZXRlKClcbiAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoaik7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGVkIGl0ZW0gZnJvbSBwZW5kaW5nIHN0b3JlJyk7XG4gICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICAgIH0pXG4gIH1cblxuICBzdGF0aWMgc3luY1Jlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICB0cnkge1xuICAgICAgIGxldCB1cmwgPSBgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudC5pZH0vP2lzX2Zhdm9yaXRlPSR7cmVzdGF1cmFudC5pc19mYXZvcml0ZX1gO1xuICAgICAgIGxldCBwYXJhbXMgPSB7bWV0aG9kOiAnUFVUJ307XG4gICAgICAgcmV0dXJuIGZldGNoKHVybCwgcGFyYW1zKS50aGVuKGZ1bmN0aW9uKHIpeyByZXR1cm4gci5qc29uKCkgfSk7XG4gICAgIH1cbiAgICAgY2F0Y2goZSkge1xuICAgICAgIGNvbnNvbGUubG9nKCdlcnJvciB1cGRhdGluZyByZXN0YXVyYW50IGJhY2tlbmQgZGF0YS4uLicsIGUsIHJlc3RhdXJhbnQpO1xuICAgICB9XG4gIH1cbiAgICAgc3RhdGljIHVwZGF0ZVJlc3RhdXJhbnRJbkRCKG5ld19yZXN0YXVyYW50KSB7XG4gICAgICAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRiKXtcbiAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuICAgICAgICAgc3RvcmUucHV0KG5ld19yZXN0YXVyYW50KTtcbiAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZVxuICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ld19yZXN0YXVyYW50KTtcbiAgICAgICB9KTtcbiAgICAgfVxuXG4gIHN0YXRpYyB0b2dnbGVGYXZCdG4ocmVzdGF1cmFudF9pZCkge1xuICAgIHJldHVybiBkYlByb21pc2UudGhlbiggZGIgPT4ge1xuICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcbiAgICAgIHJldHVybiBzdG9yZS5nZXQocmVzdGF1cmFudF9pZCk7XG4gICAgfSkudGhlbiggcmVzdGF1cmFudCA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50KTtcbiAgICAgIGNvbnN0IG5ld19yZXN0YXVyYW50ID0gT2JqZWN0LmFzc2lnbih7fSwgcmVzdGF1cmFudCk7XG4gICAgICBuZXdfcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndHJ1ZScgfHwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSkgP1xuICAgICAgJ2ZhbHNlJyA6ICd0cnVlJztcbiAgICAgIERCSGVscGVyLnN5bmNSZXN0YXVyYW50KG5ld19yZXN0YXVyYW50KTtcbiAgICAgIHJldHVybiBEQkhlbHBlci51cGRhdGVSZXN0YXVyYW50SW5EQihuZXdfcmVzdGF1cmFudCk7XG4gICAgfSkudGhlbiggbmV3X3Jlc3RhdXJhbnQgPT4ge1xuICAgICAgY29uc3QgZmF2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGZhdi1idG4tJHtuZXdfcmVzdGF1cmFudC5pZH1gKTtcbiAgICAgIGlmKG5ld19yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndHJ1ZScgfHwgbmV3X3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IHRydWUpIHtcbiAgICAgICAgZmF2QnRuLmlubmVySFRNTCA9ICdGYXZvcml0ZWQhJztcbiAgICAgICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnaG90cGluayc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmYXZCdG4uaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvcml0ZSc7XG4gICAgICAgIGZhdkJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJ2dyZXknO1xuICAgICAgfVxuICAgIH0pXG4gIH1cblxufVxuXG4iLCJjb25zdCBpbnN0YW5jZU9mQW55ID0gKG9iamVjdCwgY29uc3RydWN0b3JzKSA9PiBjb25zdHJ1Y3RvcnMuc29tZShjID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XHJcbmxldCBjdXJzb3JBZHZhbmNlTWV0aG9kcztcclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xyXG4gICAgcmV0dXJuIGlkYlByb3h5YWJsZVR5cGVzIHx8XHJcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW0lEQkRhdGFiYXNlLCBJREJPYmplY3RTdG9yZSwgSURCSW5kZXgsIElEQkN1cnNvciwgSURCVHJhbnNhY3Rpb25dKTtcclxufVxyXG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cclxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XHJcbiAgICByZXR1cm4gY3Vyc29yQWR2YW5jZU1ldGhvZHMgfHwgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gW1xyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuYWR2YW5jZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LFxyXG4gICAgXSk7XHJcbn1cclxuY29uc3QgY3Vyc29yUmVxdWVzdE1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uRG9uZU1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUod3JhcChyZXF1ZXN0LnJlc3VsdCkpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpO1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIHByb21pc2UudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAvLyBTaW5jZSBjdXJzb3JpbmcgcmV1c2VzIHRoZSBJREJSZXF1ZXN0ICgqc2lnaCopLCB3ZSBjYWNoZSBpdCBmb3IgbGF0ZXIgcmV0cmlldmFsXHJcbiAgICAgICAgLy8gKHNlZSB3cmFwRnVuY3Rpb24pLlxyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xyXG4gICAgICAgICAgICBjdXJzb3JSZXF1ZXN0TWFwLnNldCh2YWx1ZSwgcmVxdWVzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXHJcbiAgICAvLyBpcyBiZWNhdXNlIHdlIGNyZWF0ZSBtYW55IHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdC5cclxuICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxufVxyXG5mdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHtcclxuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxyXG4gICAgaWYgKHRyYW5zYWN0aW9uRG9uZU1hcC5oYXModHgpKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cclxuICAgIHRyYW5zYWN0aW9uRG9uZU1hcC5zZXQodHgsIGRvbmUpO1xyXG59XHJcbmxldCBpZGJQcm94eVRyYXBzID0ge1xyXG4gICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdkb25lJylcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvYmplY3RTdG9yZU5hbWVzJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBNYWtlIHR4LnN0b3JlIHJldHVybiB0aGUgb25seSBzdG9yZSBpbiB0aGUgdHJhbnNhY3Rpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbWFueS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdID9cclxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQgOiByZWNlaXZlci5vYmplY3RTdG9yZShyZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbHNlIHRyYW5zZm9ybSB3aGF0ZXZlciB3ZSBnZXQgYmFjay5cclxuICAgICAgICByZXR1cm4gd3JhcCh0YXJnZXRbcHJvcF0pO1xyXG4gICAgfSxcclxuICAgIGhhcyh0YXJnZXQsIHByb3ApIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24gJiYgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSlcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xyXG4gICAgfSxcclxufTtcclxuZnVuY3Rpb24gYWRkVHJhcHMoY2FsbGJhY2spIHtcclxuICAgIGlkYlByb3h5VHJhcHMgPSBjYWxsYmFjayhpZGJQcm94eVRyYXBzKTtcclxufVxyXG5mdW5jdGlvbiB3cmFwRnVuY3Rpb24oZnVuYykge1xyXG4gICAgLy8gRHVlIHRvIGV4cGVjdGVkIG9iamVjdCBlcXVhbGl0eSAod2hpY2ggaXMgZW5mb3JjZWQgYnkgdGhlIGNhY2hpbmcgaW4gYHdyYXBgKSwgd2VcclxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cclxuICAgIC8vIEVkZ2UgZG9lc24ndCBzdXBwb3J0IG9iamVjdFN0b3JlTmFtZXMgKGJvb28pLCBzbyB3ZSBwb2x5ZmlsbCBpdCBoZXJlLlxyXG4gICAgaWYgKGZ1bmMgPT09IElEQkRhdGFiYXNlLnByb3RvdHlwZS50cmFuc2FjdGlvbiAmJlxyXG4gICAgICAgICdvYmplY3RTdG9yZU5hbWVzJyBpbiBJREJUcmFuc2FjdGlvbi5wcm90b3R5cGUpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHN0b3JlTmFtZXMsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBmdW5jLmNhbGwodW53cmFwKHRoaXMpLCBzdG9yZU5hbWVzLCAuLi5hcmdzKTtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcCh0eCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8vIEN1cnNvciBtZXRob2RzIGFyZSBzcGVjaWFsLCBhcyB0aGUgYmVoYXZpb3VyIGlzIGEgbGl0dGxlIG1vcmUgZGlmZmVyZW50IHRvIHN0YW5kYXJkIElEQi4gSW5cclxuICAgIC8vIElEQiwgeW91IGFkdmFuY2UgdGhlIGN1cnNvciBhbmQgd2FpdCBmb3IgYSBuZXcgJ3N1Y2Nlc3MnIG9uIHRoZSBJREJSZXF1ZXN0IHRoYXQgZ2F2ZSB5b3UgdGhlXHJcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxyXG4gICAgLy8gd2l0aCByZWFsIHByb21pc2VzLCBzbyBlYWNoIGFkdmFuY2UgbWV0aG9kcyByZXR1cm5zIGEgbmV3IHByb21pc2UgZm9yIHRoZSBjdXJzb3Igb2JqZWN0LCBvclxyXG4gICAgLy8gdW5kZWZpbmVkIGlmIHRoZSBlbmQgb2YgdGhlIGN1cnNvciBoYXMgYmVlbiByZWFjaGVkLlxyXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgICAgICBmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cmFwKGN1cnNvclJlcXVlc3RNYXAuZ2V0KHRoaXMpKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuXHJcbiAgICAgICAgcmV0dXJuIHdyYXAoZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcclxuICAgICAgICByZXR1cm4gd3JhcEZ1bmN0aW9uKHZhbHVlKTtcclxuICAgIC8vIFRoaXMgZG9lc24ndCByZXR1cm4sIGl0IGp1c3QgY3JlYXRlcyBhICdkb25lJyBwcm9taXNlIGZvciB0aGUgdHJhbnNhY3Rpb24sXHJcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pXHJcbiAgICAgICAgY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHZhbHVlKTtcclxuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcclxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBpZGJQcm94eVRyYXBzKTtcclxuICAgIC8vIFJldHVybiB0aGUgc2FtZSB2YWx1ZSBiYWNrIGlmIHdlJ3JlIG5vdCBnb2luZyB0byB0cmFuc2Zvcm0gaXQuXHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuZnVuY3Rpb24gd3JhcCh2YWx1ZSkge1xyXG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXHJcbiAgICAvLyBJREIgaXMgd2VpcmQgYW5kIGEgc2luZ2xlIElEQlJlcXVlc3QgY2FuIHlpZWxkIG1hbnkgcmVzcG9uc2VzLCBzbyB0aGVzZSBjYW4ndCBiZSBjYWNoZWQuXHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJSZXF1ZXN0KVxyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcclxuICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgdHJhbnNmb3JtZWQgdGhpcyB2YWx1ZSBiZWZvcmUsIHJldXNlIHRoZSB0cmFuc2Zvcm1lZCB2YWx1ZS5cclxuICAgIC8vIFRoaXMgaXMgZmFzdGVyLCBidXQgaXQgYWxzbyBwcm92aWRlcyBvYmplY3QgZXF1YWxpdHkuXHJcbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcclxuICAgICAgICByZXR1cm4gdHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcclxuICAgIGNvbnN0IG5ld1ZhbHVlID0gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSk7XHJcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cclxuICAgIC8vIFRoZXNlIG1heSBiZSBwcmltaXRpdmUgdHlwZXMsIHNvIHRoZXkgY2FuJ3QgYmUgV2Vha01hcCBrZXlzLlxyXG4gICAgaWYgKG5ld1ZhbHVlICE9PSB2YWx1ZSkge1xyXG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xyXG4gICAgICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQobmV3VmFsdWUsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXdWYWx1ZTtcclxufVxyXG5jb25zdCB1bndyYXAgPSAodmFsdWUpID0+IHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xuXG5leHBvcnQgeyB3cmFwIGFzIGEsIGFkZFRyYXBzIGFzIGIsIGluc3RhbmNlT2ZBbnkgYXMgYywgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlIGFzIGQsIHVud3JhcCBhcyBlIH07XG4iLCJpbXBvcnQgeyBhIGFzIHdyYXAsIGIgYXMgYWRkVHJhcHMgfSBmcm9tICcuL2NodW5rLmpzJztcbmV4cG9ydCB7IGUgYXMgdW53cmFwLCBhIGFzIHdyYXAgfSBmcm9tICcuL2NodW5rLmpzJztcblxuLyoqXHJcbiAqIE9wZW4gYSBkYXRhYmFzZS5cclxuICpcclxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgZGF0YWJhc2UuXHJcbiAqIEBwYXJhbSB2ZXJzaW9uIFNjaGVtYSB2ZXJzaW9uLlxyXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxyXG4gKi9cclxuZnVuY3Rpb24gb3BlbkRCKG5hbWUsIHZlcnNpb24sIHsgYmxvY2tlZCwgdXBncmFkZSwgYmxvY2tpbmcgfSA9IHt9KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XHJcbiAgICBjb25zdCBvcGVuUHJvbWlzZSA9IHdyYXAocmVxdWVzdCk7XHJcbiAgICBpZiAodXBncmFkZSkge1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB1cGdyYWRlKHdyYXAocmVxdWVzdC5yZXN1bHQpLCBldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCB3cmFwKHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICBpZiAoYmxvY2tpbmcpXHJcbiAgICAgICAgb3BlblByb21pc2UudGhlbihkYiA9PiBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgYmxvY2tpbmcpKTtcclxuICAgIHJldHVybiBvcGVuUHJvbWlzZTtcclxufVxyXG4vKipcclxuICogRGVsZXRlIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShuYW1lKTtcclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICByZXR1cm4gd3JhcChyZXF1ZXN0KS50aGVuKCgpID0+IHVuZGVmaW5lZCk7XHJcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcclxuY29uc3Qgd3JpdGVNZXRob2RzID0gWydwdXQnLCAnYWRkJywgJ2RlbGV0ZScsICdjbGVhciddO1xyXG5jb25zdCBjYWNoZWRNZXRob2RzID0gbmV3IE1hcCgpO1xyXG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XHJcbiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBJREJEYXRhYmFzZSAmJlxyXG4gICAgICAgICEocHJvcCBpbiB0YXJnZXQpICYmXHJcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBpZiAoY2FjaGVkTWV0aG9kcy5nZXQocHJvcCkpXHJcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xyXG4gICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7XHJcbiAgICBjb25zdCB1c2VJbmRleCA9IHByb3AgIT09IHRhcmdldEZ1bmNOYW1lO1xyXG4gICAgLy8gQmFpbCBpZiB0aGUgdGFyZ2V0IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHRhcmdldC4gRWcsIGdldEFsbCBpc24ndCBpbiBFZGdlLlxyXG4gICAgaWYgKCEodGFyZ2V0RnVuY05hbWUgaW4gKHVzZUluZGV4ID8gSURCSW5kZXggOiBJREJPYmplY3RTdG9yZSkucHJvdG90eXBlKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBtZXRob2Q7XHJcbiAgICBpZiAocmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBsZXQgdGFyZ2V0ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUpLnN0b3JlO1xyXG4gICAgICAgICAgICBpZiAodXNlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmICh3cml0ZU1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIHR4LnN0b3JlW3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHR4LmRvbmU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmIChtZXRob2QpXHJcbiAgICAgICAgY2FjaGVkTWV0aG9kcy5zZXQocHJvcCwgbWV0aG9kKTtcclxuICAgIHJldHVybiBtZXRob2Q7XHJcbn1cclxuYWRkVHJhcHMob2xkVHJhcHMgPT4gKHtcclxuICAgIGdldDogKHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpID0+IGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSxcclxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcclxufSkpO1xuXG5leHBvcnQgeyBvcGVuREIsIGRlbGV0ZURCIH07XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoKSB7XG5cbiAgaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3NlcnZpY2V3b3JrZXIuYnVuZGxlLmpzJykudGhlbihyZWdpc3RyYXRpb24gPT4ge1xuICAgICAgIGNvbnNvbGUubG9nKCdTVyByZWdpc3RlcmVkOiAnLCByZWdpc3RyYXRpb24pO1xuICAgICB9KS5jYXRjaChyZWdpc3RyYXRpb25FcnJvciA9PiB7XG4gICAgICAgY29uc29sZS5sb2coJ1NXIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6ICcsIHJlZ2lzdHJhdGlvbkVycm9yKTtcbiAgICAgfSk7XG4gICB9KTtcbiAgfVxuXG59O1xuXG5cbiIsImltcG9ydCByZWdpc3RyYXRpb24gZnJvbSAnLi9yZWdpc3RyYXRpb24nO1xuaW1wb3J0IERCSGVscGVyIGZyb20gJy4vZGJoZWxwZXInO1xuXG5sZXQgcmVzdGF1cmFudDtcbmxldCBzdWJtaXRCdG47XG52YXIgbmV3TWFwO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbWFwIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGluaXRNYXAoKTtcblxuICBzdWJtaXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VibWl0LWZvcm0tYnRuJyk7XG4gIHN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN1Ym1pdFJldmlldyk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwXG4gKi9cbmNvbnN0IGluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIHNlbGYubmV3TWFwID0gbmV3TWFwO1xuICAgICAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICAgICAgbWFwYm94VG9rZW46ICdway5leUoxSWpvaWQyVnVkR2x1SWl3aVlTSTZJbU5xYVhKME4yNWlaakZ3ZGpZemEzQTRNR3QxYUhVMmJqRWlmUS5Ebk5GVW9ONXV6dzAxbF9YS19jN25RJyxcbiAgICAgICAgbWF4Wm9vbTogMTgsXG4gICAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgK1xuICAgICAgICAgICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICcgK1xuICAgICAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgICAgICBpZDogJ21hcGJveC5zdHJlZXRzJ1xuICAgICAgfSkuYWRkVG8obmV3TWFwKTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5uZXdNYXApO1xuICAgIH1cbiAgfSk7XG4gIERCSGVscGVyLm5leHRQZW5kaW5nKCk7XG59XG5cbi8qIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59ICovXG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIGNvbnNvbGUubG9nKCdzZWxmIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxuICAgIH0pO1xuICB9XG59XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IGAgJHtyZXN0YXVyYW50Lm5hbWV9IDxicj4gJHtyZXN0YXVyYW50LmFkZHJlc3N9YDtcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIERCSGVscGVyLmZldGNoUmV2aWV3cyhyZXN0YXVyYW50LmlkLCAoZXJyb3IsIHJldmlld3MpID0+IHtcbiAgICBmaWxsUmV2aWV3c0hUTUwocmV2aWV3cyk7XG5cbiAgfSk7XG59XG5cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJldmlldy1saS0ke3Jldmlldy5pZH1gKVxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9ICc8c3Ryb25nPkNyZWF0ZWQ6PC9zdHJvbmc+ICcgKyAobmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkpLnRvRGF0ZVN0cmluZygpO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cblxuICByZXR1cm4gbGk7XG59XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBnZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cblxuY29uc3Qgc3VibWl0UmV2aWV3ID0gKCkgPT4ge1xuICBjb25zb2xlLmxvZygnc3VibWl0IHJldmlldyBmdW5jdGlvbicpO1xuXG4gIGxldCBmb3JtRGF0YSA9IGdldEZvcm1WYWx1ZXMoKTtcbiAgaWYoIS9bYS16QS1aXXsyLH0kL2dpLnRlc3QoZm9ybURhdGEubmFtZSkpIHtcbiAgICBhbGVydCgnbmFtZSBpbnB1dCBtdXN0IGJlIGxldHRlcnMgb25seSwgbWluaW11bSBvZiAyIGNoYXJhY3RlcnMnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYoIS9bMS01XXsxfSQvZ2kudGVzdChmb3JtRGF0YS5yYXRpbmcpKSB7XG4gICAgYWxlcnQoJ3JhdGluZyBpbnB1dCBtdXN0IGJlIGEgbnVtYmVyLCAxLTUnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYoZm9ybURhdGEuY29tbWVudHMubGVuZ3RoIDwgMykge1xuICAgIGFsZXJ0KCdjb21tZW50cyBpbnB1dCBtdXN0IGJlIG1pbmltdW0gb2YgMyBjaGFyYWN0ZXJzJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvcm1EYXRhLnJlc3RhdXJhbnRfaWQgPSBzZWxmLnJlc3RhdXJhbnQuaWQ7XG4gIERCSGVscGVyLnNhdmVOZXdSZXZpZXcoZm9ybURhdGEpLnRoZW4oIHJlc3VsdCA9PiB7XG4gICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICBsZXQgYWxlcnRNc2cgPSAnQ3JlYXRlZCBSZXZpZXcnO1xuICAgIGFsZXJ0KGFsZXJ0TXNnKTtcbiAgICBsZXQgbmV3X3Jldmlld19ibG9jayA9IGNyZWF0ZVJldmlld0hUTUwocmVzdWx0KTtcbiAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgICB1bC5hcHBlbmRDaGlsZChuZXdfcmV2aWV3X2Jsb2NrKTtcbiAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXZpZXctbGktJHtyZXN1bHQuaWR9YCk7XG4gICAgaWYoZWxlbWVudC5zY3JvbGxJbnRvVmlldyAmJiBlbGVtZW50LnNjcm9sbEludG9WaWV3LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgZWxlbWVudC5zY3JvbGxJbnRvVmlldyh0cnVlKTtcbiAgICB9XG4gIH0pO1xufVxuXG5jb25zdCBnZXRGb3JtVmFsdWVzID0gKCkgPT4ge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykudmFsdWUudHJpbSgpLFxuICAgIHJhdGluZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZycpLnZhbHVlLnRyaW0oKSxcbiAgICBjb21tZW50czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1maWVsZCcpLnZhbHVlLnRyaW0oKVxuICB9XG59XG5cbiJdLCJzb3VyY2VSb290IjoiIn0=