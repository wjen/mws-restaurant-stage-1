!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let a,o;const s=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(h(this),t,...n);return c.set(r,t.sort?t.sort():[t]),f(r)}:(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(h(this),t),f(s.get(this))}:function(...t){return f(e.apply(h(this),t))}}function p(e){return"function"==typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{t(),r()},o=()=>{n(e.error),r()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});i.set(e,t)}(e),r(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{t(f(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=p(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const h=e=>l.get(e);function g(e,t,{blocked:n,upgrade:r,blocking:a}={}){const o=indexedDB.open(e,t),s=f(o);return r&&o.addEventListener("upgradeneeded",e=>{r(f(o.result),e.oldVersion,e.newVersion,f(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a&&s.then(e=>e.addEventListener("versionchange",a)),s}n.d(t,"a",function(){return g});const v=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function y(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let a;return v.includes(n)&&(a=function(e,...t){let a=this.transaction(e).store;return r&&(a=a.index(t.shift())),a[n](...t)}),b.includes(n)&&(a=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),a&&w.set(t,a),a}d=(e=>({get:(t,n,r)=>y(t,n)||e.get(t,n,r),has:(t,n)=>!!y(t,n)||e.has(t,n)}))(d)},function(e,t,n){"use strict";n.r(t);var r=n(0);const a=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});class o{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get DATABASE_REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){fetch(o.DATABASE_URL).then(function(t){t.json().then(function(t){e(null,t)})})}static fetchReviews(e,t){let n=o.DATABASE_REVIEWS_URL+"/?restaurant_id="+e;fetch(n).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(e,t){o.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){o.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){o.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){o.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){o.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){o.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return e.photograph?`/img/${e.photograph}.jpg`:`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:o.urlForRestaurant(e)});return n.addTo(newMap),n}static updateCachedRestaurantReview(e){return console.log("updating cache for new review",e),a.then(t=>{const n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return console.log("putting review in store"),r.put(e),console.log("successfully put review in store"),n.done})}static saveNewReview(e,t){const n=o.DATABASE_REVIEWS_URL;o.updateCachedRestaurantReview(e),o.addPendingRequestToQue(n,"POST",e).then(e=>{t(null,e)})}static addPendingRequestToQue(e,t,n){return new Promise((r,s)=>{a.then(r=>{r.transaction("pending","readwrite").objectStore("pending").put({data:{url:e,method:t,formData:n}})}).catch(e=>{console.log(e)}).then(o.nextPending((e,t)=>(console.log(t),r(t))))})}static nextPending(e){o.attemptCommitPending(o.nextPending).then(t=>{console.log(t),e(null,t)})}static attemptCommitPending(e){let t,n,r;return new Promise((o,s)=>{a.then(a=>{if(!a.objectStoreNames.length)return console.log("DB not available"),void a.close();a.transaction("pending","readwrite").objectStore("pending").openCursor().then(s=>{if(!s)return;s.value;if(t=s.value.data.url,n=s.value.data.method,r=s.value.data.formData,!t||!n||"POST"===n&&!r)return void s.delete().then(e());const i={body:JSON.stringify(r),method:n};fetch(t,i).then(e=>{if(e.ok||e.redirected)return e.json()}).then(t=>{a.transaction("pending","readwrite").objectStore("pending").openCursor().then(n=>{n.delete().then(()=>(e(),console.log(t),o(t)))}),console.log("deleted item from pending store")}).catch(e=>{console.log(e)})})})})}static syncRestaurant(e){try{let t=`http://localhost:1337/restaurants/${e.id}/?is_favorite=${e.is_favorite}`;return fetch(t,{method:"PUT"}).then(function(e){return e.json()})}catch(t){console.log("error updating restaurant backend data...",t,e)}}static updateRestaurantInDB(e){return a.then(function(t){let n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(e),n.complete}).then(function(){return Promise.resolve(e)})}static toggleFavBtn(e){return a.then(t=>{return t.transaction("restaurants").objectStore("restaurants").get(e)}).then(e=>{console.log(e);const t=Object.assign({},e);return t.is_favorite="true"===e.is_favorite||!0===e.is_favorite?"false":"true",o.syncRestaurant(t),o.updateRestaurantInDB(t)}).then(e=>{const t=document.getElementById(`fav-btn-${e.id}`);"true"===e.is_favorite||!0===e.is_favorite?(t.innerHTML="Favorited!",t.style.background="hotpink"):(t.innerHTML="Add to favorite",t.style.background="grey")})}}window.DBHelper=o},,,function(e,t,n){n(1),e.exports=n(5)},function(e,t){var n;document.addEventListener("DOMContentLoaded",e=>{initMap(),submitBtn=document.getElementById("submit-form-btn"),submitBtn.addEventListener("click",r)}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(n=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),self.newMap=n,L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoid2VudGluIiwiYSI6ImNqaXJ0N25iZjFwdjYza3A4MGt1aHU2bjEifQ.DnNFUoN5uzw01l_XK_c7nQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(n),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return e(null,self.restaurant),void console.log("self restaurant already fetched");const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=` ${e.name} <br> ${e.address}`;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviews(e.id,(e,t)=>{fillReviewsHTML(t)})}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("id",`review-li-${e.id}`);const n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML="<strong>Created:</strong> "+new Date(e.createdAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});const r=()=>{console.log("submit review function");let e=a();/[a-zA-Z]{2,}$/gi.test(e.name)?/[1-5]{1}$/gi.test(e.rating)?e.comments.length<3?alert("comments input must be minimum of 3 characters"):(e.restaurant_id=self.restaurant.id,DBHelper.saveNewReview(e,(e,t)=>{console.log(t);alert("Created Review");let n=createReviewHTML(t);document.getElementById("reviews-list").appendChild(n);var r=document.getElementById(`review-li-${t.id}`);r.scrollIntoView&&r.scrollIntoView.constructor===Function&&r.scrollIntoView(!0)})):alert("rating input must be a number, 1-5"):alert("name input must be letters only, minimum of 2 characters")},a=()=>({name:document.getElementById("name").value.trim(),rating:document.getElementById("rating").value.trim(),comments:document.getElementById("review-field").value.trim()})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vY2h1bmsuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9lc20vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vYXBwL3NyYy9kYmhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL3Jlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImluc3RhbmNlT2ZBbnkiLCJjb25zdHJ1Y3RvcnMiLCJzb21lIiwiaWRiUHJveHlhYmxlVHlwZXMiLCJjdXJzb3JBZHZhbmNlTWV0aG9kcyIsImN1cnNvclJlcXVlc3RNYXAiLCJXZWFrTWFwIiwidHJhbnNhY3Rpb25Eb25lTWFwIiwidHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwIiwidHJhbnNmb3JtQ2FjaGUiLCJyZXZlcnNlVHJhbnNmb3JtQ2FjaGUiLCJpZGJQcm94eVRyYXBzIiwiW29iamVjdCBPYmplY3RdIiwidGFyZ2V0IiwicHJvcCIsInJlY2VpdmVyIiwiSURCVHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZU5hbWVzIiwidW5kZWZpbmVkIiwib2JqZWN0U3RvcmUiLCJ3cmFwIiwiaGFzIiwid3JhcEZ1bmN0aW9uIiwiZnVuYyIsIklEQkRhdGFiYXNlIiwidHJhbnNhY3Rpb24iLCJzdG9yZU5hbWVzIiwiYXJncyIsInR4IiwidW53cmFwIiwidGhpcyIsInNldCIsInNvcnQiLCJJREJDdXJzb3IiLCJhZHZhbmNlIiwiY29udGludWUiLCJjb250aW51ZVByaW1hcnlLZXkiLCJpbmNsdWRlcyIsImFwcGx5IiwidHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSIsImRvbmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInVubGlzdGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNvbXBsZXRlIiwiZXJyb3IiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uIiwiSURCT2JqZWN0U3RvcmUiLCJJREJJbmRleCIsIlByb3h5IiwiSURCUmVxdWVzdCIsInJlcXVlc3QiLCJwcm9taXNlIiwic3VjY2VzcyIsInJlc3VsdCIsInRoZW4iLCJwcm9taXNpZnlSZXF1ZXN0IiwibmV3VmFsdWUiLCJvcGVuREIiLCJ2ZXJzaW9uIiwiYmxvY2tlZCIsInVwZ3JhZGUiLCJibG9ja2luZyIsImluZGV4ZWREQiIsIm9wZW4iLCJvcGVuUHJvbWlzZSIsImV2ZW50Iiwib2xkVmVyc2lvbiIsIm5ld1ZlcnNpb24iLCJkYiIsIl9fd2VicGFja19leHBvcnRzX18iLCJyZWFkTWV0aG9kcyIsIndyaXRlTWV0aG9kcyIsImNhY2hlZE1ldGhvZHMiLCJNYXAiLCJnZXRNZXRob2QiLCJ0YXJnZXRGdW5jTmFtZSIsInJlcGxhY2UiLCJ1c2VJbmRleCIsIm1ldGhvZCIsInN0b3JlTmFtZSIsInN0b3JlIiwiaW5kZXgiLCJzaGlmdCIsIm9sZFRyYXBzIiwiY2FsbGJhY2siLCJpZGJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImRiUHJvbWlzZSIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiREFUQUJBU0VfUkVWSUVXU19VUkwiLCJmZXRjaCIsInJlc3BvbnNlIiwianNvbiIsInJlc3RhdXJhbnRzIiwicmVzdGF1cmFudF9pZCIsImZldGNoVVJMIiwicmV2aWV3cyIsImNhdGNoIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwicmVzdGF1cmFudCIsImZpbmQiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCIsImZvcm1EYXRhIiwiY29uc29sZSIsImxvZyIsInB1dCIsInVwZGF0ZUNhY2hlZFJlc3RhdXJhbnRSZXZpZXciLCJhZGRQZW5kaW5nUmVxdWVzdFRvUXVlIiwiZGF0YSIsIm5leHRQZW5kaW5nIiwiYXR0ZW1wdENvbW1pdFBlbmRpbmciLCJqIiwiYm9keSIsImxlbmd0aCIsImNsb3NlIiwib3BlbkN1cnNvciIsImN1cnNvciIsImRlbGV0ZSIsInByb3BlcnRpZXMiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJyZWRpcmVjdGVkIiwiaXNfZmF2b3JpdGUiLCJlIiwibmV3X3Jlc3RhdXJhbnQiLCJhc3NpZ24iLCJzeW5jUmVzdGF1cmFudCIsInVwZGF0ZVJlc3RhdXJhbnRJbkRCIiwiZmF2QnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsInN0eWxlIiwiYmFja2dyb3VuZCIsIndpbmRvdyIsImluaXRNYXAiLCJzdWJtaXRCdG4iLCJzdWJtaXRSZXZpZXciLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiY2VudGVyIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInNlbGYiLCJ0aWxlTGF5ZXIiLCJtYXBib3hUb2tlbiIsIm1heFpvb20iLCJhdHRyaWJ1dGlvbiIsImZpbGxCcmVhZGNydW1iIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZldGNoUmV2aWV3cyIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImxpIiwic2V0QXR0cmlidXRlIiwiZGF0ZSIsIkRhdGUiLCJjcmVhdGVkQXQiLCJ0b0RhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJsb2NhdGlvbiIsImhyZWYiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZ2V0Rm9ybVZhbHVlcyIsInRlc3QiLCJhbGVydCIsInNhdmVOZXdSZXZpZXciLCJuZXdfcmV2aWV3X2Jsb2NrIiwiZWxlbWVudCIsInNjcm9sbEludG9WaWV3IiwiY29uc3RydWN0b3IiLCJGdW5jdGlvbiIsInRyaW0iXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtB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QixZQUFZUSxLQU16QnpCLG1CQUFxQixFQUFDL00sRUFBTTJKLEtBQ3JCQSxJQUNIQSxFQUFNcUMsT0FBT2lELFNBQVNDLE1BQ3hCbFAsRUFBT0EsRUFBS3lHLFFBQVEsVUFBVyxRQUMvQixNQUNFK0IsRUFEWSxJQUFJMkcsY0FBY25QLHNCQUNkb1AsS0FBS3pGLEdBQ3ZCLE9BQUtuQixFQUVBQSxFQUFRLEdBRU42RyxtQkFBbUI3RyxFQUFRLEdBQUcvQixRQUFRLE1BQU8sTUFEM0MsR0FGQSxPQU1YLE1BQU0wRixFQUFlLEtBQ25CbkMsUUFBUUMsSUFBSSwwQkFFWixJQUFJRixFQUFXdUYsSUFDWCxrQkFBa0JDLEtBQUt4RixFQUFTL0osTUFJaEMsY0FBY3VQLEtBQUt4RixFQUFTK0UsUUFJN0IvRSxFQUFTZ0YsU0FBU3JFLE9BQVMsRUFDNUI4RSxNQUFNLG1EQUdSekYsRUFBU2hDLGNBQWdCeUUsS0FBS25FLFdBQVdGLEdBQ3pDWCxTQUFTaUksY0FBYzFGLEVBQVUsQ0FBQ3ZGLEVBQU9VLEtBQ3ZDOEUsUUFBUUMsSUFBSS9FLEdBRVpzSyxNQURlLGtCQUVmLElBQUlFLEVBQW1CbkIsaUJBQWlCckosR0FDN0J5RyxTQUFTQyxlQUFlLGdCQUNoQ29DLFlBQVkwQixHQUNmLElBQUlDLEVBQVVoRSxTQUFTQyw0QkFBNEIxRyxFQUFPaUQsTUFDdkR3SCxFQUFRQyxnQkFBa0JELEVBQVFDLGVBQWVDLGNBQWdCQyxVQUNsRUgsRUFBUUMsZ0JBQWUsTUFqQnpCSixNQUFNLHNDQUpOQSxNQUFNLDZEQTBCSkYsRUFBZ0IsS0FDYixDQUNMdFAsS0FBTTJMLFNBQVNDLGVBQWUsUUFBUWxMLE1BQU1xUCxPQUM1Q2pCLE9BQVFuRCxTQUFTQyxlQUFlLFVBQVVsTCxNQUFNcVAsT0FDaERoQixTQUFVcEQsU0FBU0MsZUFBZSxnQkFBZ0JsTCxNQUFNcVAiLCJmaWxlIjoicmVzdGF1cmFudC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNCk7XG4iLCJjb25zdCBpbnN0YW5jZU9mQW55ID0gKG9iamVjdCwgY29uc3RydWN0b3JzKSA9PiBjb25zdHJ1Y3RvcnMuc29tZShjID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XHJcbmxldCBjdXJzb3JBZHZhbmNlTWV0aG9kcztcclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xyXG4gICAgcmV0dXJuIGlkYlByb3h5YWJsZVR5cGVzIHx8XHJcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW0lEQkRhdGFiYXNlLCBJREJPYmplY3RTdG9yZSwgSURCSW5kZXgsIElEQkN1cnNvciwgSURCVHJhbnNhY3Rpb25dKTtcclxufVxyXG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cclxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XHJcbiAgICByZXR1cm4gY3Vyc29yQWR2YW5jZU1ldGhvZHMgfHwgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gW1xyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuYWR2YW5jZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxyXG4gICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LFxyXG4gICAgXSk7XHJcbn1cclxuY29uc3QgY3Vyc29yUmVxdWVzdE1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uRG9uZU1hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUod3JhcChyZXF1ZXN0LnJlc3VsdCkpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpO1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIHByb21pc2UudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAvLyBTaW5jZSBjdXJzb3JpbmcgcmV1c2VzIHRoZSBJREJSZXF1ZXN0ICgqc2lnaCopLCB3ZSBjYWNoZSBpdCBmb3IgbGF0ZXIgcmV0cmlldmFsXHJcbiAgICAgICAgLy8gKHNlZSB3cmFwRnVuY3Rpb24pLlxyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xyXG4gICAgICAgICAgICBjdXJzb3JSZXF1ZXN0TWFwLnNldCh2YWx1ZSwgcmVxdWVzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXHJcbiAgICAvLyBpcyBiZWNhdXNlIHdlIGNyZWF0ZSBtYW55IHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdC5cclxuICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxufVxyXG5mdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHtcclxuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxyXG4gICAgaWYgKHRyYW5zYWN0aW9uRG9uZU1hcC5oYXModHgpKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcclxuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cclxuICAgIHRyYW5zYWN0aW9uRG9uZU1hcC5zZXQodHgsIGRvbmUpO1xyXG59XHJcbmxldCBpZGJQcm94eVRyYXBzID0ge1xyXG4gICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdkb25lJylcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvYmplY3RTdG9yZU5hbWVzJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBNYWtlIHR4LnN0b3JlIHJldHVybiB0aGUgb25seSBzdG9yZSBpbiB0aGUgdHJhbnNhY3Rpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbWFueS5cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdID9cclxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQgOiByZWNlaXZlci5vYmplY3RTdG9yZShyZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbHNlIHRyYW5zZm9ybSB3aGF0ZXZlciB3ZSBnZXQgYmFjay5cclxuICAgICAgICByZXR1cm4gd3JhcCh0YXJnZXRbcHJvcF0pO1xyXG4gICAgfSxcclxuICAgIGhhcyh0YXJnZXQsIHByb3ApIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24gJiYgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSlcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xyXG4gICAgfSxcclxufTtcclxuZnVuY3Rpb24gYWRkVHJhcHMoY2FsbGJhY2spIHtcclxuICAgIGlkYlByb3h5VHJhcHMgPSBjYWxsYmFjayhpZGJQcm94eVRyYXBzKTtcclxufVxyXG5mdW5jdGlvbiB3cmFwRnVuY3Rpb24oZnVuYykge1xyXG4gICAgLy8gRHVlIHRvIGV4cGVjdGVkIG9iamVjdCBlcXVhbGl0eSAod2hpY2ggaXMgZW5mb3JjZWQgYnkgdGhlIGNhY2hpbmcgaW4gYHdyYXBgKSwgd2VcclxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cclxuICAgIC8vIEVkZ2UgZG9lc24ndCBzdXBwb3J0IG9iamVjdFN0b3JlTmFtZXMgKGJvb28pLCBzbyB3ZSBwb2x5ZmlsbCBpdCBoZXJlLlxyXG4gICAgaWYgKGZ1bmMgPT09IElEQkRhdGFiYXNlLnByb3RvdHlwZS50cmFuc2FjdGlvbiAmJlxyXG4gICAgICAgICdvYmplY3RTdG9yZU5hbWVzJyBpbiBJREJUcmFuc2FjdGlvbi5wcm90b3R5cGUpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHN0b3JlTmFtZXMsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBmdW5jLmNhbGwodW53cmFwKHRoaXMpLCBzdG9yZU5hbWVzLCAuLi5hcmdzKTtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcCh0eCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8vIEN1cnNvciBtZXRob2RzIGFyZSBzcGVjaWFsLCBhcyB0aGUgYmVoYXZpb3VyIGlzIGEgbGl0dGxlIG1vcmUgZGlmZmVyZW50IHRvIHN0YW5kYXJkIElEQi4gSW5cclxuICAgIC8vIElEQiwgeW91IGFkdmFuY2UgdGhlIGN1cnNvciBhbmQgd2FpdCBmb3IgYSBuZXcgJ3N1Y2Nlc3MnIG9uIHRoZSBJREJSZXF1ZXN0IHRoYXQgZ2F2ZSB5b3UgdGhlXHJcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxyXG4gICAgLy8gd2l0aCByZWFsIHByb21pc2VzLCBzbyBlYWNoIGFkdmFuY2UgbWV0aG9kcyByZXR1cm5zIGEgbmV3IHByb21pc2UgZm9yIHRoZSBjdXJzb3Igb2JqZWN0LCBvclxyXG4gICAgLy8gdW5kZWZpbmVkIGlmIHRoZSBlbmQgb2YgdGhlIGN1cnNvciBoYXMgYmVlbiByZWFjaGVkLlxyXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgICAgICBmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cmFwKGN1cnNvclJlcXVlc3RNYXAuZ2V0KHRoaXMpKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxyXG4gICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuXHJcbiAgICAgICAgcmV0dXJuIHdyYXAoZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcclxuICAgICAgICByZXR1cm4gd3JhcEZ1bmN0aW9uKHZhbHVlKTtcclxuICAgIC8vIFRoaXMgZG9lc24ndCByZXR1cm4sIGl0IGp1c3QgY3JlYXRlcyBhICdkb25lJyBwcm9taXNlIGZvciB0aGUgdHJhbnNhY3Rpb24sXHJcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pXHJcbiAgICAgICAgY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHZhbHVlKTtcclxuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcclxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBpZGJQcm94eVRyYXBzKTtcclxuICAgIC8vIFJldHVybiB0aGUgc2FtZSB2YWx1ZSBiYWNrIGlmIHdlJ3JlIG5vdCBnb2luZyB0byB0cmFuc2Zvcm0gaXQuXHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuZnVuY3Rpb24gd3JhcCh2YWx1ZSkge1xyXG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXHJcbiAgICAvLyBJREIgaXMgd2VpcmQgYW5kIGEgc2luZ2xlIElEQlJlcXVlc3QgY2FuIHlpZWxkIG1hbnkgcmVzcG9uc2VzLCBzbyB0aGVzZSBjYW4ndCBiZSBjYWNoZWQuXHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJSZXF1ZXN0KVxyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcclxuICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgdHJhbnNmb3JtZWQgdGhpcyB2YWx1ZSBiZWZvcmUsIHJldXNlIHRoZSB0cmFuc2Zvcm1lZCB2YWx1ZS5cclxuICAgIC8vIFRoaXMgaXMgZmFzdGVyLCBidXQgaXQgYWxzbyBwcm92aWRlcyBvYmplY3QgZXF1YWxpdHkuXHJcbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcclxuICAgICAgICByZXR1cm4gdHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcclxuICAgIGNvbnN0IG5ld1ZhbHVlID0gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSk7XHJcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cclxuICAgIC8vIFRoZXNlIG1heSBiZSBwcmltaXRpdmUgdHlwZXMsIHNvIHRoZXkgY2FuJ3QgYmUgV2Vha01hcCBrZXlzLlxyXG4gICAgaWYgKG5ld1ZhbHVlICE9PSB2YWx1ZSkge1xyXG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xyXG4gICAgICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQobmV3VmFsdWUsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXdWYWx1ZTtcclxufVxyXG5jb25zdCB1bndyYXAgPSAodmFsdWUpID0+IHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xuXG5leHBvcnQgeyB3cmFwIGFzIGEsIGFkZFRyYXBzIGFzIGIsIGluc3RhbmNlT2ZBbnkgYXMgYywgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlIGFzIGQsIHVud3JhcCBhcyBlIH07XG4iLCJpbXBvcnQgeyBhIGFzIHdyYXAsIGIgYXMgYWRkVHJhcHMgfSBmcm9tICcuL2NodW5rLmpzJztcbmV4cG9ydCB7IGUgYXMgdW53cmFwLCBhIGFzIHdyYXAgfSBmcm9tICcuL2NodW5rLmpzJztcblxuLyoqXHJcbiAqIE9wZW4gYSBkYXRhYmFzZS5cclxuICpcclxuICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgZGF0YWJhc2UuXHJcbiAqIEBwYXJhbSB2ZXJzaW9uIFNjaGVtYSB2ZXJzaW9uLlxyXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxyXG4gKi9cclxuZnVuY3Rpb24gb3BlbkRCKG5hbWUsIHZlcnNpb24sIHsgYmxvY2tlZCwgdXBncmFkZSwgYmxvY2tpbmcgfSA9IHt9KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XHJcbiAgICBjb25zdCBvcGVuUHJvbWlzZSA9IHdyYXAocmVxdWVzdCk7XHJcbiAgICBpZiAodXBncmFkZSkge1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB1cGdyYWRlKHdyYXAocmVxdWVzdC5yZXN1bHQpLCBldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCB3cmFwKHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICBpZiAoYmxvY2tpbmcpXHJcbiAgICAgICAgb3BlblByb21pc2UudGhlbihkYiA9PiBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgYmxvY2tpbmcpKTtcclxuICAgIHJldHVybiBvcGVuUHJvbWlzZTtcclxufVxyXG4vKipcclxuICogRGVsZXRlIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShuYW1lKTtcclxuICAgIGlmIChibG9ja2VkKVxyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XHJcbiAgICByZXR1cm4gd3JhcChyZXF1ZXN0KS50aGVuKCgpID0+IHVuZGVmaW5lZCk7XHJcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcclxuY29uc3Qgd3JpdGVNZXRob2RzID0gWydwdXQnLCAnYWRkJywgJ2RlbGV0ZScsICdjbGVhciddO1xyXG5jb25zdCBjYWNoZWRNZXRob2RzID0gbmV3IE1hcCgpO1xyXG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XHJcbiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBJREJEYXRhYmFzZSAmJlxyXG4gICAgICAgICEocHJvcCBpbiB0YXJnZXQpICYmXHJcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBpZiAoY2FjaGVkTWV0aG9kcy5nZXQocHJvcCkpXHJcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xyXG4gICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7XHJcbiAgICBjb25zdCB1c2VJbmRleCA9IHByb3AgIT09IHRhcmdldEZ1bmNOYW1lO1xyXG4gICAgLy8gQmFpbCBpZiB0aGUgdGFyZ2V0IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHRhcmdldC4gRWcsIGdldEFsbCBpc24ndCBpbiBFZGdlLlxyXG4gICAgaWYgKCEodGFyZ2V0RnVuY05hbWUgaW4gKHVzZUluZGV4ID8gSURCSW5kZXggOiBJREJPYmplY3RTdG9yZSkucHJvdG90eXBlKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBtZXRob2Q7XHJcbiAgICBpZiAocmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBsZXQgdGFyZ2V0ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUpLnN0b3JlO1xyXG4gICAgICAgICAgICBpZiAodXNlSW5kZXgpXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmICh3cml0ZU1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSB7XHJcbiAgICAgICAgbWV0aG9kID0gZnVuY3Rpb24gKHN0b3JlTmFtZSwgLi4uYXJncykge1xyXG4gICAgICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIHR4LnN0b3JlW3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHR4LmRvbmU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGlmIChtZXRob2QpXHJcbiAgICAgICAgY2FjaGVkTWV0aG9kcy5zZXQocHJvcCwgbWV0aG9kKTtcclxuICAgIHJldHVybiBtZXRob2Q7XHJcbn1cclxuYWRkVHJhcHMob2xkVHJhcHMgPT4gKHtcclxuICAgIGdldDogKHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpID0+IGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSxcclxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcclxufSkpO1xuXG5leHBvcnQgeyBvcGVuREIsIGRlbGV0ZURCIH07XG4iLCIvKipcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuICovXG5pbXBvcnQgeyBvcGVuREIsIGRlbGV0ZURCLCB3cmFwLCB1bndyYXAgfSBmcm9tICdpZGInO1xuXG5jb25zdCBkYlByb21pc2UgPSBvcGVuREIoJ3JyLWRiJywgMywge1xuICB1cGdyYWRlKGRiLCBvbGRWZXJzaW9uKSB7XG4gICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIGNvbnN0IHN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywgeyBrZXlQYXRoOiAnaWQnLCB9KTtcbiAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGNvbnN0IHJldmlld3NTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2aWV3c1N0b3JlLmNyZWF0ZUluZGV4KFwicmVzdGF1cmFudF9pZFwiLCBcInJlc3RhdXJhbnRfaWRcIik7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGNvbnN0IHBlbmRpbmdTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdwZW5kaW5nJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZVxuICAgICAgICB9KVxuICAgIH1cbiAgfVxufSk7XG5cbmNsYXNzIERCSGVscGVyIHtcblxuICAvKipcbiAgICogRGF0YWJhc2UgVVJMLlxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAqL1xuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcbiAgICBjb25zdCBwb3J0ID0gMTMzNy8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1JFVklFV1NfVVJMKCkge1xuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG4gICAqL1xuXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcbiAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGZldGNoUmV2aWV3cyggcmVzdGF1cmFudF9pZCwgY2FsbGJhY2spIHtcbiAgICBsZXQgZmV0Y2hVUkwgPSBEQkhlbHBlci5EQVRBQkFTRV9SRVZJRVdTX1VSTCArIFwiLz9yZXN0YXVyYW50X2lkPVwiICsgcmVzdGF1cmFudF9pZDtcbiAgICBmZXRjaChmZXRjaFVSTCkudGhlbiggcmVzcG9uc2UgPT4ge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KS50aGVuKHJldmlld3MgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSk7XG4gIH1cblxuICAvLyAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRSZXZpZXdzQnlJZChpZCwgY2FsbGJhY2spIHtcbiAgLy8gICAvLyBGZXRjaCBhbGwgcmV2aWV3cyBmb3IgdGhlIHNwZWNpZmljIHJlc3RhdXJhbnRcbiAgLy8gICBjb25zdCBmZXRjaFVSTCA9IERCSGVscGVyLkRBVEFCQVNFX1JFVklFV1NfVVJMICsgXCIvP3Jlc3RhdXJhbnRfaWQ9XCIgKyBpZDtcbiAgLy8gICBmZXRjaChmZXRjaFVSTCwge21ldGhvZDogXCJHRVRcIn0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAvLyAgICAgaWYgKCFyZXNwb25zZS5jbG9uZSgpLm9rICYmICFyZXNwb25zZS5jbG9uZSgpLnJlZGlyZWN0ZWQpIHtcbiAgLy8gICAgICAgdGhyb3cgXCJObyByZXZpZXdzIGF2YWlsYWJsZVwiO1xuICAvLyAgICAgfVxuICAvLyAgICAgcmVzcG9uc2VcbiAgLy8gICAgICAgLmpzb24oKVxuICAvLyAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAvLyAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIC8vICAgICAgIH0pXG4gIC8vICAgfSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcbiAgLy8gfVxuICAvKipcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgKi9cbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICovXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIGlmKCFyZXN0YXVyYW50LnBob3RvZ3JhcGgpIHtcbiAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgKVxuICAgIH1cbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAqL1xuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAvLyBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMy4wLmh0bWwjbWFya2VyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICB7dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG4gICAgICB9KVxuICAgICAgbWFya2VyLmFkZFRvKG5ld01hcCk7XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxuXG4gIHN0YXRpYyB1cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3KGZvcm1EYXRhKSB7XG4gICAgY29uc29sZS5sb2coJ3VwZGF0aW5nIGNhY2hlIGZvciBuZXcgcmV2aWV3JywgZm9ybURhdGEpO1xuICAgIHJldHVybiBkYlByb21pc2UudGhlbiggZGIgPT4ge1xuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcbiAgICAgIGNvbnNvbGUubG9nKCdwdXR0aW5nIHJldmlldyBpbiBzdG9yZScpO1xuICAgICAgc3RvcmUucHV0KGZvcm1EYXRhKTtcbiAgICAgIGNvbnNvbGUubG9nKCdzdWNjZXNzZnVsbHkgcHV0IHJldmlldyBpbiBzdG9yZScpO1xuICAgICAgcmV0dXJuIHR4LmRvbmU7XG4gICAgfSlcbiAgfVxuXG4gIHN0YXRpYyBzYXZlTmV3UmV2aWV3KGZvcm1EYXRhLCBjYWxsYmFjaykge1xuICAgIC8vIEJsb2NrIGFueSBtb3JlIGNsaWNrcyBvbiB0aGUgc3VibWl0IGJ1dHRvbiB1bnRpbCB0aGUgY2FsbGJhY2tcbiAgICAvLyBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN1Ym1pdC1mb3JtLWJ0blwiKTtcbiAgICAvLyBidG4ub25jbGljayA9IG51bGw7XG4gICAgY29uc3QgdXJsID0gREJIZWxwZXIuREFUQUJBU0VfUkVWSUVXU19VUkw7XG4gICAgY29uc3QgbWV0aG9kID0gXCJQT1NUXCI7XG4gICAgREJIZWxwZXIudXBkYXRlQ2FjaGVkUmVzdGF1cmFudFJldmlldyhmb3JtRGF0YSk7XG4gICAgREJIZWxwZXIuYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSh1cmwsIG1ldGhvZCwgZm9ybURhdGEpLnRoZW4oanNvbiA9PiB7XG4gICAgICBjYWxsYmFjayhudWxsLCBqc29uKTtcbiAgICB9KTtcblxuICB9XG5cbiAgc3RhdGljIGFkZFBlbmRpbmdSZXF1ZXN0VG9RdWUodXJsLCBtZXRob2QsIGZvcm1EYXRhKSB7XG4gICAgLy9vcGVuIGRhdGFiYXNlIGFuZCBhZGQgcmVxdWVzdCBkZXRhaWxzIHRvIHRoZSBwZW5kaW5nIHN0b3JlXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3BlbmRpbmcnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdwZW5kaW5nJyk7XG4gICAgICBzdG9yZS5wdXQoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICBmb3JtRGF0YVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9KS50aGVuKERCSGVscGVyLm5leHRQZW5kaW5nKChlcnJvciwganNvbikgPT4ge1xuICAgICAgY29uc29sZS5sb2coanNvbik7XG4gICAgICByZXR1cm4gcmVzb2x2ZShqc29uKTtcbiAgICB9KSk7XG4gIH0pO1xuICB9XG5cbiAgc3RhdGljIG5leHRQZW5kaW5nKGNhbGxiYWNrKSB7XG4gICAgREJIZWxwZXIuYXR0ZW1wdENvbW1pdFBlbmRpbmcoREJIZWxwZXIubmV4dFBlbmRpbmcpLnRoZW4oaiA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhqKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGopO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGF0dGVtcHRDb21taXRQZW5kaW5nKGNhbGxiYWNrKSB7XG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBwZW5kaW5nIGl0ZW1zIHVudGlsIHRoZXJlIGlzIGEgbmV0d29yayBmYWlsdXJlXG4gICAgbGV0IHVybDtcbiAgICBsZXQgbWV0aG9kO1xuICAgIGxldCBib2R5O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKCAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7IGRiUHJvbWlzZS50aGVuKGRiID0+IHtcbiAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJEQiBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwZW5kaW5nJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgc3RvcmUub3BlbkN1cnNvcigpLnRoZW4oIGN1cnNvciA9PiB7XG4gICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZSA9IGN1cnNvci52YWx1ZTtcbiAgICAgICAgdXJsID0gY3Vyc29yLnZhbHVlLmRhdGEudXJsO1xuICAgICAgICBtZXRob2QgPSBjdXJzb3IudmFsdWUuZGF0YS5tZXRob2Q7XG4gICAgICAgIGJvZHkgPSBjdXJzb3IudmFsdWUuZGF0YS5mb3JtRGF0YTtcblxuXG4gICAgICAgIC8vIElmIHdlIGRvbid0IGhhdmUgYSBwYXJhbWV0ZXIgdGhlbiB3ZSdyZSBvbiBhIGJhZCByZWNvcmQgdGhhdCBzaG91bGQgYmUgdG9zc2VkXG4gICAgICAgIC8vIGFuZCB0aGVuIG1vdmUgb25cbiAgICAgICAgaWYgKCghdXJsIHx8ICFtZXRob2QpIHx8IChtZXRob2QgPT09IFwiUE9TVFwiICYmICFib2R5KSkge1xuICAgICAgICAgIGN1cnNvclxuICAgICAgICAgICAgLmRlbGV0ZSgpXG4gICAgICAgICAgICAudGhlbihjYWxsYmFjaygpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICAgICAgICBtZXRob2Q6IG1ldGhvZFxuICAgICAgICB9XG4gICAgICAgIGZldGNoKHVybCwgcHJvcGVydGllcykudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIC8vIElmIHdlIGRvbid0IGdldCBhIGdvb2QgcmVzcG9uc2UgdGhlbiBhc3N1bWUgd2UncmUgb2ZmbGluZVxuICAgICAgICAgIGlmICghcmVzcG9uc2Uub2sgJiYgIXJlc3BvbnNlLnJlZGlyZWN0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSkudGhlbiggaiA9PiB7XG4gICAgICAgICAgY29uc3QgZGVsdHggPSBkYi50cmFuc2FjdGlvbigncGVuZGluZycsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICBjb25zdCBzdG9yZSA9IGRlbHR4Lm9iamVjdFN0b3JlKCdwZW5kaW5nJyk7XG4gICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpXG4gICAgICAgICAgICAudGhlbiggY3Vyc29yID0+IHtcbiAgICAgICAgICAgICAgY3Vyc29yLmRlbGV0ZSgpXG4gICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGopO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGopO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICBjb25zb2xlLmxvZygnZGVsZXRlZCBpdGVtIGZyb20gcGVuZGluZyBzdG9yZScpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgICB9KVxuICB9XG5cbiAgc3RhdGljIHN5bmNSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgdHJ5IHtcbiAgICAgICBsZXQgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnQuaWR9Lz9pc19mYXZvcml0ZT0ke3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGV9YDtcbiAgICAgICBsZXQgcGFyYW1zID0ge21ldGhvZDogJ1BVVCd9O1xuICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHBhcmFtcykudGhlbihmdW5jdGlvbihyKXsgcmV0dXJuIHIuanNvbigpIH0pO1xuICAgICB9XG4gICAgIGNhdGNoKGUpIHtcbiAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgdXBkYXRpbmcgcmVzdGF1cmFudCBiYWNrZW5kIGRhdGEuLi4nLCBlLCByZXN0YXVyYW50KTtcbiAgICAgfVxuICB9XG4gICAgIHN0YXRpYyB1cGRhdGVSZXN0YXVyYW50SW5EQihuZXdfcmVzdGF1cmFudCkge1xuICAgICAgIHJldHVybiBkYlByb21pc2UudGhlbihmdW5jdGlvbihkYil7XG4gICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcbiAgICAgICAgIHN0b3JlLnB1dChuZXdfcmVzdGF1cmFudCk7XG4gICAgICAgICByZXR1cm4gdHguY29tcGxldGVcbiAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXdfcmVzdGF1cmFudCk7XG4gICAgICAgfSk7XG4gICAgIH1cblxuICBzdGF0aWMgdG9nZ2xlRmF2QnRuKHJlc3RhdXJhbnRfaWQpIHtcbiAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycpO1xuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICByZXR1cm4gc3RvcmUuZ2V0KHJlc3RhdXJhbnRfaWQpO1xuICAgIH0pLnRoZW4oIHJlc3RhdXJhbnQgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudCk7XG4gICAgICBjb25zdCBuZXdfcmVzdGF1cmFudCA9IE9iamVjdC5hc3NpZ24oe30sIHJlc3RhdXJhbnQpO1xuICAgICAgbmV3X3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHx8IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IHRydWUpID9cbiAgICAgICdmYWxzZScgOiAndHJ1ZSc7XG4gICAgICBEQkhlbHBlci5zeW5jUmVzdGF1cmFudChuZXdfcmVzdGF1cmFudCk7XG4gICAgICByZXR1cm4gREJIZWxwZXIudXBkYXRlUmVzdGF1cmFudEluREIobmV3X3Jlc3RhdXJhbnQpO1xuICAgIH0pLnRoZW4oIG5ld19yZXN0YXVyYW50ID0+IHtcbiAgICAgIGNvbnN0IGZhdkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBmYXYtYnRuLSR7bmV3X3Jlc3RhdXJhbnQuaWR9YCk7XG4gICAgICBpZihuZXdfcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHx8IG5ld19yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSB7XG4gICAgICAgIGZhdkJ0bi5pbm5lckhUTUwgPSAnRmF2b3JpdGVkISc7XG4gICAgICAgIGZhdkJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJ2hvdHBpbmsnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmF2QnRuLmlubmVySFRNTCA9ICdBZGQgdG8gZmF2b3JpdGUnO1xuICAgICAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdncmV5JztcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbn1cblxud2luZG93LkRCSGVscGVyID0gREJIZWxwZXI7XG5cbiIsImxldCByZXN0YXVyYW50O1xudmFyIG5ld01hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBpbml0TWFwKCk7XG5cbiAgc3VibWl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Ym1pdC1mb3JtLWJ0bicpO1xuICBzdWJtaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdWJtaXRSZXZpZXcpO1xufSk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcFxuICovXG5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBzZWxmLm5ld01hcCA9IG5ld01hcDtcbiAgICAgIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XG4gICAgICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2lkMlZ1ZEdsdUlpd2lZU0k2SW1OcWFYSjBOMjVpWmpGd2RqWXphM0E0TUd0MWFIVTJiakVpZlEuRG5ORlVvTjV1encwMWxfWEtfYzduUScsXG4gICAgICAgIG1heFpvb206IDE4LFxuICAgICAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnICtcbiAgICAgICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcbiAgICAgICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICAgICAgaWQ6ICdtYXBib3guc3RyZWV0cydcbiAgICAgIH0pLmFkZFRvKG5ld01hcCk7XG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKiB3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICB9XG4gIH0pO1xufSAqL1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICBjb25zb2xlLmxvZygnc2VsZiByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcbiAgICB9KTtcbiAgfVxufVxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSBgICR7cmVzdGF1cmFudC5uYW1lfSA8YnI+ICR7cmVzdGF1cmFudC5hZGRyZXNzfWA7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBEQkhlbHBlci5mZXRjaFJldmlld3MocmVzdGF1cmFudC5pZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgZmlsbFJldmlld3NIVE1MKHJldmlld3MpO1xuXG4gIH0pO1xufVxuXG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuc2V0QXR0cmlidXRlKCdpZCcsIGByZXZpZXctbGktJHtyZXZpZXcuaWR9YClcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSAnPHN0cm9uZz5DcmVhdGVkOjwvc3Ryb25nPiAnICsgKG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpKS50b0RhdGVTdHJpbmcoKTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG5cbmNvbnN0IHN1Ym1pdFJldmlldyA9ICgpID0+IHtcbiAgY29uc29sZS5sb2coJ3N1Ym1pdCByZXZpZXcgZnVuY3Rpb24nKTtcblxuICBsZXQgZm9ybURhdGEgPSBnZXRGb3JtVmFsdWVzKCk7XG4gIGlmKCEvW2EtekEtWl17Mix9JC9naS50ZXN0KGZvcm1EYXRhLm5hbWUpKSB7XG4gICAgYWxlcnQoJ25hbWUgaW5wdXQgbXVzdCBiZSBsZXR0ZXJzIG9ubHksIG1pbmltdW0gb2YgMiBjaGFyYWN0ZXJzJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmKCEvWzEtNV17MX0kL2dpLnRlc3QoZm9ybURhdGEucmF0aW5nKSkge1xuICAgIGFsZXJ0KCdyYXRpbmcgaW5wdXQgbXVzdCBiZSBhIG51bWJlciwgMS01Jyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmKGZvcm1EYXRhLmNvbW1lbnRzLmxlbmd0aCA8IDMpIHtcbiAgICBhbGVydCgnY29tbWVudHMgaW5wdXQgbXVzdCBiZSBtaW5pbXVtIG9mIDMgY2hhcmFjdGVycycpO1xuICAgIHJldHVybjtcbiAgfVxuICBmb3JtRGF0YS5yZXN0YXVyYW50X2lkID0gc2VsZi5yZXN0YXVyYW50LmlkO1xuICBEQkhlbHBlci5zYXZlTmV3UmV2aWV3KGZvcm1EYXRhLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgbGV0IGFsZXJ0TXNnID0gJ0NyZWF0ZWQgUmV2aWV3JztcbiAgICBhbGVydChhbGVydE1zZyk7XG4gICAgbGV0IG5ld19yZXZpZXdfYmxvY2sgPSBjcmVhdGVSZXZpZXdIVE1MKHJlc3VsdCk7XG4gICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gICAgdWwuYXBwZW5kQ2hpbGQobmV3X3Jldmlld19ibG9jayk7XG4gICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcmV2aWV3LWxpLSR7cmVzdWx0LmlkfWApO1xuICAgIGlmKGVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcgJiYgZWxlbWVudC5zY3JvbGxJbnRvVmlldy5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIGVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcodHJ1ZSk7XG4gICAgfVxuICB9KTtcbn1cblxuY29uc3QgZ2V0Rm9ybVZhbHVlcyA9ICgpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlLnRyaW0oKSxcbiAgICByYXRpbmc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmcnKS52YWx1ZS50cmltKCksXG4gICAgY29tbWVudHM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctZmllbGQnKS52YWx1ZS50cmltKClcbiAgfVxufVxuXG4iXSwic291cmNlUm9vdCI6IiJ9