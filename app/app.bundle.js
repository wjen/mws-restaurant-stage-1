!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return a});var r=n(1);const o=Object(r.a)("rr-db",3,{upgrade(e,t){switch(t){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("id","id");case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id");case 2:e.createObjectStore("pending",{keyPath:"id",autoIncrement:!0})}}});class a{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get DATABASE_REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){fetch(a.DATABASE_URL).then(function(t){t.json().then(function(t){e(null,t)})})}static fetchReviews(e,t){let n=a.DATABASE_REVIEWS_URL+"/?restaurant_id="+e;fetch(n).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){a.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){a.fetchRestaurants((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){a.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return e.photograph?`/img/${e.photograph}.jpg`:`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:a.urlForRestaurant(e)});return n.addTo(newMap),n}static updateCachedRestaurantReview(e){return console.log("updating cache for new review",e),o.then(t=>{const n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return console.log("putting review in store"),r.put(e),console.log("successfully put review in store"),n.done})}static saveNewReview(e){const t=a.DATABASE_REVIEWS_URL;return a.updateCachedRestaurantReview(e),a.addPendingRequestToQue(t,"POST",e).then(e=>e)}static addPendingRequestToQue(e,t,n){return new Promise((r,s)=>{o.then(r=>{r.transaction("pending","readwrite").objectStore("pending").put({data:{url:e,method:t,formData:n}})}).catch(e=>{console.log(e)}).then(a.nextPending((e,t)=>(console.log(t),r(t))))})}static nextPending(e){a.attemptCommitPending(a.nextPending).then(t=>{console.log(t),e(null,t)})}static attemptCommitPending(e){let t,n,r;return new Promise((a,s)=>{o.then(o=>{if(!o.objectStoreNames.length)return console.log("DB not available"),void o.close();o.transaction("pending","readwrite").objectStore("pending").openCursor().then(s=>{if(!s)return;s.value;if(t=s.value.data.url,n=s.value.data.method,r=s.value.data.formData,!t||!n||"POST"===n&&!r)return void s.delete().then(e());const i={body:JSON.stringify(r),method:n};fetch(t,i).then(e=>e.ok||e.redirected?e.json():(console.log("this is the response and we are offline"),void console.log(e))).then(t=>{o.transaction("pending","readwrite").objectStore("pending").openCursor().then(n=>{n.delete().then(()=>(e(),console.log(t),a(t)))}),console.log("deleted item from pending store")}).catch(e=>{console.log(e)})})})})}static syncRestaurant(e){try{let t=`http://localhost:1337/restaurants/${e.id}/?is_favorite=${e.is_favorite}`;return fetch(t,{method:"PUT"}).then(function(e){return e.json()})}catch(t){console.log("error updating restaurant backend data...",t,e)}}static updateRestaurantInDB(e){return o.then(function(t){let n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").put(e),n.complete}).then(function(){return Promise.resolve(e)})}static toggleFavBtn(e){return o.then(t=>{return t.transaction("restaurants").objectStore("restaurants").get(e)}).then(e=>{console.log(e);const t=Object.assign({},e);return t.is_favorite="true"===e.is_favorite||!0===e.is_favorite?"false":"true",a.syncRestaurant(t),a.updateRestaurantInDB(t)}).then(e=>{const t=document.getElementById(`fav-btn-${e.id}`);"true"===e.is_favorite||!0===e.is_favorite?(t.innerHTML="Favorited!",t.style.background="hotpink"):(t.innerHTML="Add to favorite",t.style.background="grey")})}}},function(e,t,n){"use strict";const r=(e,t)=>t.some(t=>e instanceof t);let o,a;const s=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e===IDBDatabase.prototype.transaction&&"objectStoreNames"in IDBTransaction.prototype?function(t,...n){const r=e.call(g(this),t,...n);return c.set(r,t.sort?t.sort():[t]),h(r)}:(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),h(s.get(this))}:function(...t){return h(e.apply(g(this),t))}}function p(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});i.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function h(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(h(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=p(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const g=e=>l.get(e);function m(e,t,{blocked:n,upgrade:r,blocking:o}={}){const a=indexedDB.open(e,t),s=h(a);return r&&a.addEventListener("upgradeneeded",e=>{r(h(a.result),e.oldVersion,e.newVersion,h(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o&&s.then(e=>e.addEventListener("versionchange",o)),s}n.d(t,"a",function(){return m});const v=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],y=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n;if(!(n in(r?IDBIndex:IDBObjectStore).prototype))return;let o;return v.includes(n)&&(o=function(e,...t){let o=this.transaction(e).store;return r&&(o=o.index(t.shift())),o[n](...t)}),b.includes(n)&&(o=function(e,...t){const r=this.transaction(e,"readwrite");return r.store[n](...t),r.done}),o&&y.set(t,o),o}d=(e=>({get:(t,n,r)=>w(t,n)||e.get(t,n,r),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(d)},function(e,t,n){"use strict";n.r(t),t.default=function(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceworker.bundle.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})})}},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";n.r(t);n(2);var r=n(0);var o;document.addEventListener("DOMContentLoaded",e=>{u(),a(),i(),r.default.nextPending()});const a=()=>{r.default.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,s())})},s=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");t.addEventListener("change",l),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},i=()=>{r.default.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,c())})},c=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");t.addEventListener("change",l),e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},u=()=>{o=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),self.newMap=o,L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoid2VudGluIiwiYSI6ImNqaXJ0N25iZjFwdjYza3A4MGt1aHU2bjEifQ.DnNFUoN5uzw01l_XK_c7nQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(o),l()},l=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,o=t.selectedIndex,a=e[n].value,s=t[o].value;r.default.fetchRestaurantByCuisineAndNeighborhood(a,s,(e,t)=>{e?console.error(e):(d(t),f())})},d=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(e=>e.remove()),self.markers=[],self.restaurants=e},f=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{console.log(e),t.append(p(e))}),h()},p=e=>{const t=document.createElement("li"),n=document.createElement("img"),o=document.createElement("div");n.className="restaurant-img",n.setAttribute("alt",e.name),n.src=r.default.imageUrlForRestaurant(e),console.log(n.src),o.append(n),t.append(o);const a=document.createElement("h1");a.innerHTML=e.name,t.append(a);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const i=document.createElement("p");i.innerHTML=e.address,t.append(i),console.log("is_favorite: ",e.is_favorite);const c=document.createElement("button");!e.is_favorite||e.is_favorite.toString();"true"===e.is_favorite||!0===e.is_favorite?(c.innerHTML="Favorited!",c.style.background="hotpink"):(c.innerHTML="Add to favorite",c.style.background="grey"),c.setAttribute("title",`toggle favorites for: ${e.name}`),c.setAttribute("id",`fav-btn-${e.id}`),c.setAttribute("data-restaurant-id",e.id),c.addEventListener("click",()=>{console.log("clicked favbtn"),r.default.toggleFavBtn(e.id)}),t.append(c);const u=document.createElement("button");return u.classList="button button--success",u.innerHTML="View Details",u.setAttribute("aria-label",e.name+e.neighborhood+e.address+"View Details"),u.onclick=(()=>{const t=r.default.urlForRestaurant(e);window.location=t}),t.append(u),t},h=(e=self.restaurants)=>{e.forEach(e=>{const t=r.default.mapMarkerForRestaurant(e,o);t.on("click",function(){window.location.href=t.options.url}),self.markers.push(t)})}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vYXBwL3NyYy9kYmhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9jaHVuay5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2VzbS9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL3JlZ2lzdHJhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9hcHAvc3JjL21haW4uanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJfX3dlYnBhY2tfZXhwb3J0c19fIiwiREJIZWxwZXIiLCJpZGJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImRiUHJvbWlzZSIsIm9wZW5EQiIsInVwZ3JhZGUiLCJkYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImF1dG9JbmNyZW1lbnQiLCJEQVRBQkFTRV9VUkwiLCJEQVRBQkFTRV9SRVZJRVdTX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudHMiLCJyZXN0YXVyYW50X2lkIiwiZmV0Y2hVUkwiLCJyZXZpZXdzIiwiY2F0Y2giLCJlcnJvciIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJuZXdNYXAiLCJmb3JtRGF0YSIsImNvbnNvbGUiLCJsb2ciLCJ0eCIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsInB1dCIsImRvbmUiLCJ1cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3IiwiYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSIsIm1ldGhvZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZGF0YSIsIm5leHRQZW5kaW5nIiwiYXR0ZW1wdENvbW1pdFBlbmRpbmciLCJqIiwiYm9keSIsIm9iamVjdFN0b3JlTmFtZXMiLCJsZW5ndGgiLCJjbG9zZSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJkZWxldGUiLCJwcm9wZXJ0aWVzIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwicmVkaXJlY3RlZCIsImlzX2Zhdm9yaXRlIiwiZSIsIm5ld19yZXN0YXVyYW50IiwiY29tcGxldGUiLCJhc3NpZ24iLCJzeW5jUmVzdGF1cmFudCIsInVwZGF0ZVJlc3RhdXJhbnRJbkRCIiwiZmF2QnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsInN0eWxlIiwiYmFja2dyb3VuZCIsImluc3RhbmNlT2ZBbnkiLCJjb25zdHJ1Y3RvcnMiLCJzb21lIiwiaWRiUHJveHlhYmxlVHlwZXMiLCJjdXJzb3JBZHZhbmNlTWV0aG9kcyIsImN1cnNvclJlcXVlc3RNYXAiLCJXZWFrTWFwIiwidHJhbnNhY3Rpb25Eb25lTWFwIiwidHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwIiwidHJhbnNmb3JtQ2FjaGUiLCJyZXZlcnNlVHJhbnNmb3JtQ2FjaGUiLCJpZGJQcm94eVRyYXBzIiwidGFyZ2V0IiwicHJvcCIsInJlY2VpdmVyIiwiSURCVHJhbnNhY3Rpb24iLCJ1bmRlZmluZWQiLCJ3cmFwIiwiaGFzIiwid3JhcEZ1bmN0aW9uIiwiZnVuYyIsIklEQkRhdGFiYXNlIiwic3RvcmVOYW1lcyIsImFyZ3MiLCJ1bndyYXAiLCJ0aGlzIiwic2V0Iiwic29ydCIsIklEQkN1cnNvciIsImFkdmFuY2UiLCJjb250aW51ZSIsImNvbnRpbnVlUHJpbWFyeUtleSIsImluY2x1ZGVzIiwiYXBwbHkiLCJ0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlIiwidW5saXN0ZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbiIsIklEQk9iamVjdFN0b3JlIiwiSURCSW5kZXgiLCJQcm94eSIsIklEQlJlcXVlc3QiLCJyZXF1ZXN0IiwicHJvbWlzZSIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJwcm9taXNpZnlSZXF1ZXN0IiwibmV3VmFsdWUiLCJ2ZXJzaW9uIiwiYmxvY2tlZCIsImJsb2NraW5nIiwiaW5kZXhlZERCIiwib3BlbiIsIm9wZW5Qcm9taXNlIiwiZXZlbnQiLCJuZXdWZXJzaW9uIiwicmVhZE1ldGhvZHMiLCJ3cml0ZU1ldGhvZHMiLCJjYWNoZWRNZXRob2RzIiwiTWFwIiwiZ2V0TWV0aG9kIiwidGFyZ2V0RnVuY05hbWUiLCJyZXBsYWNlIiwidXNlSW5kZXgiLCJzdG9yZU5hbWUiLCJpbmRleCIsInNoaWZ0Iiwib2xkVHJhcHMiLCJuYXZpZ2F0b3IiLCJ3aW5kb3ciLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWdpc3RyYXRpb24iLCJyZWdpc3RyYXRpb25FcnJvciIsIl9kYmhlbHBlcl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwiaW5pdE1hcCIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwidXBkYXRlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJjZW50ZXIiLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm1hcmtlcnMiLCJyZW1vdmUiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImRpdiIsImNsYXNzTmFtZSIsInNldEF0dHJpYnV0ZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFkZHJlc3MiLCJ0b1N0cmluZyIsInRvZ2dsZUZhdkJ0biIsIm1vcmUiLCJjbGFzc0xpc3QiLCJvbmNsaWNrIiwibG9jYXRpb24iLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50Iiwib24iLCJocmVmIiwib3B0aW9ucyIsInB1c2giXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVB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MEYsY0FBYyxXQUNsQjNKLEVBQVUsYUFBbUJBLEVBQVUsWUFBZ0IwTCxXQUM3QyxTQUEzQjFMLEVBQVd5RCxjQUFxRCxJQUEzQnpELEVBQVd5RCxhQUNqRE8sRUFBT0csVUFBWSxhQUNuQkgsRUFBT0ksTUFBTUMsV0FBYSxZQUUxQkwsRUFBT0csVUFBWSxrQkFDbkJILEVBQU9JLE1BQU1DLFdBQWEsUUFFNUJMLEVBQU9zSCxhQUFhLGlDQUFrQ3RMLEVBQVdyRCxRQUNqRXFILEVBQU9zSCxhQUFhLGdCQUFpQnRMLEVBQVdGLE1BQ2hEa0UsRUFBT3NILGFBQWEscUJBQXNCdEwsRUFBV0YsSUFFckRrRSxFQUFPMkMsaUJBQWlCLFFBQVMsS0FDL0JoRixRQUFRQyxJQUFJLGtCQUNadkQsVUFBU3NOLGFBQWEzTCxFQUFXRixNQUluQ29MLEVBQUd0QixPQUFPNUYsR0FFVixNQUFNNEgsRUFBTzNILFNBQVMwRixjQUFjLFVBVXBDLE9BVEFpQyxFQUFLQyxVQUFZLHlCQUNqQkQsRUFBS3pILFVBQVksZUFDakJ5SCxFQUFLTixhQUFhLGFBQWN0TCxFQUFXckQsS0FBT3FELEVBQVdNLGFBQWVOLEVBQVd5TCxRQUFVLGdCQUNqR0csRUFBS0UsUUFBVSxNQUNiLE1BQU14SyxFQUFNakQsVUFBU2tELGlCQUFpQnZCLEdBQ3RDNEksT0FBT21ELFNBQVd6SyxJQUVwQjRKLEVBQUd0QixPQUFPZ0MsR0FFSFYsR0FNSEQsRUFBa0IsQ0FBQ3pMLEVBQWM2SixLQUFLN0osZUFDMUNBLEVBQVlpSyxRQUFRekosSUFFbEIsTUFBTWUsRUFBUzFDLFVBQVMyTix1QkFBdUJoTSxFQUFZeUIsR0FDM0RWLEVBQU9rTCxHQUFHLFFBQ1YsV0FDRXJELE9BQU9tRCxTQUFTRyxLQUFPbkwsRUFBT29MLFFBQVE3SyxNQUV4QytILEtBQUt3QixRQUFRdUIsS0FBS3JMIiwiZmlsZSI6ImFwcC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMyk7XG4iLCIvKipcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuICovXG5pbXBvcnQgeyBvcGVuREIsIGRlbGV0ZURCLCB3cmFwLCB1bndyYXAgfSBmcm9tICdpZGInO1xuXG5jb25zdCBkYlByb21pc2UgPSBvcGVuREIoJ3JyLWRiJywgMywge1xuICB1cGdyYWRlKGRiLCBvbGRWZXJzaW9uKSB7XG4gICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIGNvbnN0IHN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywgeyBrZXlQYXRoOiAnaWQnLCB9KTtcbiAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGNvbnN0IHJldmlld3NTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2aWV3c1N0b3JlLmNyZWF0ZUluZGV4KFwicmVzdGF1cmFudF9pZFwiLCBcInJlc3RhdXJhbnRfaWRcIik7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGNvbnN0IHBlbmRpbmdTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdwZW5kaW5nJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZVxuICAgICAgICB9KVxuICAgIH1cbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERCSGVscGVyIHtcblxuICAvKipcbiAgICogRGF0YWJhc2UgVVJMLlxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAqL1xuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcbiAgICBjb25zdCBwb3J0ID0gMTMzNy8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1JFVklFV1NfVVJMKCkge1xuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG4gICAqL1xuXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcbiAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGZldGNoUmV2aWV3cyggcmVzdGF1cmFudF9pZCwgY2FsbGJhY2spIHtcbiAgICBsZXQgZmV0Y2hVUkwgPSBEQkhlbHBlci5EQVRBQkFTRV9SRVZJRVdTX1VSTCArIFwiLz9yZXN0YXVyYW50X2lkPVwiICsgcmVzdGF1cmFudF9pZDtcbiAgICBmZXRjaChmZXRjaFVSTCkudGhlbiggcmVzcG9uc2UgPT4ge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KS50aGVuKHJldmlld3MgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSk7XG4gIH1cblxuICAvLyAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRSZXZpZXdzQnlJZChpZCwgY2FsbGJhY2spIHtcbiAgLy8gICAvLyBGZXRjaCBhbGwgcmV2aWV3cyBmb3IgdGhlIHNwZWNpZmljIHJlc3RhdXJhbnRcbiAgLy8gICBjb25zdCBmZXRjaFVSTCA9IERCSGVscGVyLkRBVEFCQVNFX1JFVklFV1NfVVJMICsgXCIvP3Jlc3RhdXJhbnRfaWQ9XCIgKyBpZDtcbiAgLy8gICBmZXRjaChmZXRjaFVSTCwge21ldGhvZDogXCJHRVRcIn0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAvLyAgICAgaWYgKCFyZXNwb25zZS5jbG9uZSgpLm9rICYmICFyZXNwb25zZS5jbG9uZSgpLnJlZGlyZWN0ZWQpIHtcbiAgLy8gICAgICAgdGhyb3cgXCJObyByZXZpZXdzIGF2YWlsYWJsZVwiO1xuICAvLyAgICAgfVxuICAvLyAgICAgcmVzcG9uc2VcbiAgLy8gICAgICAgLmpzb24oKVxuICAvLyAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAvLyAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIC8vICAgICAgIH0pXG4gIC8vICAgfSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcbiAgLy8gfVxuICAvKipcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICovXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgKi9cbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICovXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIGlmKCFyZXN0YXVyYW50LnBob3RvZ3JhcGgpIHtcbiAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgKVxuICAgIH1cbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAqL1xuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAvLyBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMy4wLmh0bWwjbWFya2VyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICB7dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG4gICAgICB9KVxuICAgICAgbWFya2VyLmFkZFRvKG5ld01hcCk7XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxuXG4gIHN0YXRpYyB1cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3KGZvcm1EYXRhKSB7XG4gICAgY29uc29sZS5sb2coJ3VwZGF0aW5nIGNhY2hlIGZvciBuZXcgcmV2aWV3JywgZm9ybURhdGEpO1xuICAgIHJldHVybiBkYlByb21pc2UudGhlbiggZGIgPT4ge1xuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcbiAgICAgIGNvbnNvbGUubG9nKCdwdXR0aW5nIHJldmlldyBpbiBzdG9yZScpO1xuICAgICAgc3RvcmUucHV0KGZvcm1EYXRhKTtcbiAgICAgIGNvbnNvbGUubG9nKCdzdWNjZXNzZnVsbHkgcHV0IHJldmlldyBpbiBzdG9yZScpO1xuICAgICAgcmV0dXJuIHR4LmRvbmU7XG4gICAgfSlcbiAgfVxuXG4gIHN0YXRpYyBzYXZlTmV3UmV2aWV3KGZvcm1EYXRhKSB7XG4gICAgLy8gQmxvY2sgYW55IG1vcmUgY2xpY2tzIG9uIHRoZSBzdWJtaXQgYnV0dG9uIHVudGlsIHRoZSBjYWxsYmFja1xuICAgIC8vIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3VibWl0LWZvcm0tYnRuXCIpO1xuICAgIC8vIGJ0bi5vbmNsaWNrID0gbnVsbDtcbiAgICBjb25zdCB1cmwgPSBEQkhlbHBlci5EQVRBQkFTRV9SRVZJRVdTX1VSTDtcbiAgICBjb25zdCBtZXRob2QgPSBcIlBPU1RcIjtcbiAgICBEQkhlbHBlci51cGRhdGVDYWNoZWRSZXN0YXVyYW50UmV2aWV3KGZvcm1EYXRhKTtcbiAgICByZXR1cm4gREJIZWxwZXIuYWRkUGVuZGluZ1JlcXVlc3RUb1F1ZSh1cmwsIG1ldGhvZCwgZm9ybURhdGEpLnRoZW4oanNvbiA9PiBqc29uKTtcblxuICB9XG5cbiAgc3RhdGljIGFkZFBlbmRpbmdSZXF1ZXN0VG9RdWUodXJsLCBtZXRob2QsIGZvcm1EYXRhKSB7XG4gICAgLy9vcGVuIGRhdGFiYXNlIGFuZCBhZGQgcmVxdWVzdCBkZXRhaWxzIHRvIHRoZSBwZW5kaW5nIHN0b3JlXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3BlbmRpbmcnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdwZW5kaW5nJyk7XG4gICAgICBzdG9yZS5wdXQoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICBmb3JtRGF0YVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9KS50aGVuKERCSGVscGVyLm5leHRQZW5kaW5nKChlcnJvciwganNvbikgPT4ge1xuICAgICAgY29uc29sZS5sb2coanNvbik7XG4gICAgICByZXR1cm4gcmVzb2x2ZShqc29uKTtcbiAgICB9KSk7XG4gIH0pO1xuICB9XG5cbiAgc3RhdGljIG5leHRQZW5kaW5nKGNhbGxiYWNrKSB7XG4gICAgREJIZWxwZXIuYXR0ZW1wdENvbW1pdFBlbmRpbmcoREJIZWxwZXIubmV4dFBlbmRpbmcpLnRoZW4oaiA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhqKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGopO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGF0dGVtcHRDb21taXRQZW5kaW5nKGNhbGxiYWNrKSB7XG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBwZW5kaW5nIGl0ZW1zIHVudGlsIHRoZXJlIGlzIGEgbmV0d29yayBmYWlsdXJlXG4gICAgbGV0IHVybDtcbiAgICBsZXQgbWV0aG9kO1xuICAgIGxldCBib2R5O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKCAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7IGRiUHJvbWlzZS50aGVuKGRiID0+IHtcbiAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJEQiBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwZW5kaW5nJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncGVuZGluZycpO1xuICAgICAgc3RvcmUub3BlbkN1cnNvcigpLnRoZW4oIGN1cnNvciA9PiB7XG4gICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZSA9IGN1cnNvci52YWx1ZTtcbiAgICAgICAgdXJsID0gY3Vyc29yLnZhbHVlLmRhdGEudXJsO1xuICAgICAgICBtZXRob2QgPSBjdXJzb3IudmFsdWUuZGF0YS5tZXRob2Q7XG4gICAgICAgIGJvZHkgPSBjdXJzb3IudmFsdWUuZGF0YS5mb3JtRGF0YTtcblxuXG4gICAgICAgIC8vIElmIHdlIGRvbid0IGhhdmUgYSBwYXJhbWV0ZXIgdGhlbiB3ZSdyZSBvbiBhIGJhZCByZWNvcmQgdGhhdCBzaG91bGQgYmUgdG9zc2VkXG4gICAgICAgIC8vIGFuZCB0aGVuIG1vdmUgb25cbiAgICAgICAgaWYgKCghdXJsIHx8ICFtZXRob2QpIHx8IChtZXRob2QgPT09IFwiUE9TVFwiICYmICFib2R5KSkge1xuICAgICAgICAgIGN1cnNvclxuICAgICAgICAgICAgLmRlbGV0ZSgpXG4gICAgICAgICAgICAudGhlbihjYWxsYmFjaygpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICAgICAgICBtZXRob2Q6IG1ldGhvZFxuICAgICAgICB9XG4gICAgICAgIGZldGNoKHVybCwgcHJvcGVydGllcykudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIC8vIElmIHdlIGRvbid0IGdldCBhIGdvb2QgcmVzcG9uc2UgdGhlbiBhc3N1bWUgd2UncmUgb2ZmbGluZVxuICAgICAgICAgIGlmICghcmVzcG9uc2Uub2sgJiYgIXJlc3BvbnNlLnJlZGlyZWN0ZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSByZXNwb25zZSBhbmQgd2UgYXJlIG9mZmxpbmUnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSkudGhlbiggaiA9PiB7XG4gICAgICAgICAgY29uc3QgZGVsdHggPSBkYi50cmFuc2FjdGlvbigncGVuZGluZycsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICBjb25zdCBzdG9yZSA9IGRlbHR4Lm9iamVjdFN0b3JlKCdwZW5kaW5nJyk7XG4gICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpXG4gICAgICAgICAgICAudGhlbiggY3Vyc29yID0+IHtcbiAgICAgICAgICAgICAgY3Vyc29yLmRlbGV0ZSgpXG4gICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGopO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGopO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICBjb25zb2xlLmxvZygnZGVsZXRlZCBpdGVtIGZyb20gcGVuZGluZyBzdG9yZScpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgICB9KVxuICB9XG5cbiAgc3RhdGljIHN5bmNSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgdHJ5IHtcbiAgICAgICBsZXQgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnQuaWR9Lz9pc19mYXZvcml0ZT0ke3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGV9YDtcbiAgICAgICBsZXQgcGFyYW1zID0ge21ldGhvZDogJ1BVVCd9O1xuICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHBhcmFtcykudGhlbihmdW5jdGlvbihyKXsgcmV0dXJuIHIuanNvbigpIH0pO1xuICAgICB9XG4gICAgIGNhdGNoKGUpIHtcbiAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgdXBkYXRpbmcgcmVzdGF1cmFudCBiYWNrZW5kIGRhdGEuLi4nLCBlLCByZXN0YXVyYW50KTtcbiAgICAgfVxuICB9XG4gICAgIHN0YXRpYyB1cGRhdGVSZXN0YXVyYW50SW5EQihuZXdfcmVzdGF1cmFudCkge1xuICAgICAgIHJldHVybiBkYlByb21pc2UudGhlbihmdW5jdGlvbihkYil7XG4gICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcbiAgICAgICAgIHN0b3JlLnB1dChuZXdfcmVzdGF1cmFudCk7XG4gICAgICAgICByZXR1cm4gdHguY29tcGxldGVcbiAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXdfcmVzdGF1cmFudCk7XG4gICAgICAgfSk7XG4gICAgIH1cblxuICBzdGF0aWMgdG9nZ2xlRmF2QnRuKHJlc3RhdXJhbnRfaWQpIHtcbiAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycpO1xuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG4gICAgICByZXR1cm4gc3RvcmUuZ2V0KHJlc3RhdXJhbnRfaWQpO1xuICAgIH0pLnRoZW4oIHJlc3RhdXJhbnQgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudCk7XG4gICAgICBjb25zdCBuZXdfcmVzdGF1cmFudCA9IE9iamVjdC5hc3NpZ24oe30sIHJlc3RhdXJhbnQpO1xuICAgICAgbmV3X3Jlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHx8IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IHRydWUpID9cbiAgICAgICdmYWxzZScgOiAndHJ1ZSc7XG4gICAgICBEQkhlbHBlci5zeW5jUmVzdGF1cmFudChuZXdfcmVzdGF1cmFudCk7XG4gICAgICByZXR1cm4gREJIZWxwZXIudXBkYXRlUmVzdGF1cmFudEluREIobmV3X3Jlc3RhdXJhbnQpO1xuICAgIH0pLnRoZW4oIG5ld19yZXN0YXVyYW50ID0+IHtcbiAgICAgIGNvbnN0IGZhdkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBmYXYtYnRuLSR7bmV3X3Jlc3RhdXJhbnQuaWR9YCk7XG4gICAgICBpZihuZXdfcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHx8IG5ld19yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSB7XG4gICAgICAgIGZhdkJ0bi5pbm5lckhUTUwgPSAnRmF2b3JpdGVkISc7XG4gICAgICAgIGZhdkJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJ2hvdHBpbmsnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmF2QnRuLmlubmVySFRNTCA9ICdBZGQgdG8gZmF2b3JpdGUnO1xuICAgICAgICBmYXZCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICdncmV5JztcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbn1cblxuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoYyA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTtcblxubGV0IGlkYlByb3h5YWJsZVR5cGVzO1xyXG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XHJcbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxyXG5mdW5jdGlvbiBnZXRJZGJQcm94eWFibGVUeXBlcygpIHtcclxuICAgIHJldHVybiBpZGJQcm94eWFibGVUeXBlcyB8fFxyXG4gICAgICAgIChpZGJQcm94eWFibGVUeXBlcyA9IFtJREJEYXRhYmFzZSwgSURCT2JqZWN0U3RvcmUsIElEQkluZGV4LCBJREJDdXJzb3IsIElEQlRyYW5zYWN0aW9uXSk7XHJcbn1cclxuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXHJcbmZ1bmN0aW9uIGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkge1xyXG4gICAgcmV0dXJuIGN1cnNvckFkdmFuY2VNZXRob2RzIHx8IChjdXJzb3JBZHZhbmNlTWV0aG9kcyA9IFtcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXHJcbiAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZSxcclxuICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlUHJpbWFyeUtleSxcclxuICAgIF0pO1xyXG59XHJcbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvbkRvbmVNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmNvbnN0IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xyXG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjb25zdCB1bmxpc3RlbiA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgICBwcm9taXNlLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxyXG4gICAgICAgIC8vIChzZWUgd3JhcEZ1bmN0aW9uKS5cclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJDdXJzb3IpIHtcclxuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gVGhpcyBtYXBwaW5nIGV4aXN0cyBpbiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYnV0IGRvZXNuJ3QgZG9lc24ndCBleGlzdCBpbiB0cmFuc2Zvcm1DYWNoZS4gVGhpc1xyXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXHJcbiAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KHByb21pc2UsIHJlcXVlc3QpO1xyXG4gICAgcmV0dXJuIHByb21pc2U7XHJcbn1cclxuZnVuY3Rpb24gY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHR4KSB7XHJcbiAgICAvLyBFYXJseSBiYWlsIGlmIHdlJ3ZlIGFscmVhZHkgY3JlYXRlZCBhIGRvbmUgcHJvbWlzZSBmb3IgdGhpcyB0cmFuc2FjdGlvbi5cclxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICBjb25zdCBkb25lID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcclxuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY29tcGxldGUgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgdW5saXN0ZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QodHguZXJyb3IpO1xyXG4gICAgICAgICAgICB1bmxpc3RlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICAgIC8vIENhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwuXHJcbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcclxufVxyXG5sZXQgaWRiUHJveHlUcmFwcyA9IHtcclxuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHRyYW5zYWN0aW9uLmRvbmUuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25Eb25lTWFwLmdldCh0YXJnZXQpO1xyXG4gICAgICAgICAgICAvLyBQb2x5ZmlsbCBmb3Igb2JqZWN0U3RvcmVOYW1lcyBiZWNhdXNlIG9mIEVkZ2UuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQub2JqZWN0U3RvcmVOYW1lcyB8fCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuZ2V0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnc3RvcmUnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1sxXSA/XHJcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXHJcbiAgICAgICAgcmV0dXJuIHdyYXAodGFyZ2V0W3Byb3BdKTtcclxuICAgIH0sXHJcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uICYmIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDtcclxuICAgIH0sXHJcbn07XHJcbmZ1bmN0aW9uIGFkZFRyYXBzKGNhbGxiYWNrKSB7XHJcbiAgICBpZGJQcm94eVRyYXBzID0gY2FsbGJhY2soaWRiUHJveHlUcmFwcyk7XHJcbn1cclxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcclxuICAgIC8vIER1ZSB0byBleHBlY3RlZCBvYmplY3QgZXF1YWxpdHkgKHdoaWNoIGlzIGVuZm9yY2VkIGJ5IHRoZSBjYWNoaW5nIGluIGB3cmFwYCksIHdlXHJcbiAgICAvLyBvbmx5IGNyZWF0ZSBvbmUgbmV3IGZ1bmMgcGVyIGZ1bmMuXHJcbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cclxuICAgIGlmIChmdW5jID09PSBJREJEYXRhYmFzZS5wcm90b3R5cGUudHJhbnNhY3Rpb24gJiZcclxuICAgICAgICAnb2JqZWN0U3RvcmVOYW1lcycgaW4gSURCVHJhbnNhY3Rpb24ucHJvdG90eXBlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZnVuYy5jYWxsKHVud3JhcCh0aGlzKSwgc3RvcmVOYW1lcywgLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5zZXQodHgsIHN0b3JlTmFtZXMuc29ydCA/IHN0b3JlTmFtZXMuc29ydCgpIDogW3N0b3JlTmFtZXNdKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXHJcbiAgICAvLyBJREIsIHlvdSBhZHZhbmNlIHRoZSBjdXJzb3IgYW5kIHdhaXQgZm9yIGEgbmV3ICdzdWNjZXNzJyBvbiB0aGUgSURCUmVxdWVzdCB0aGF0IGdhdmUgeW91IHRoZVxyXG4gICAgLy8gY3Vyc29yLiBJdCdzIGtpbmRhIGxpa2UgYSBwcm9taXNlIHRoYXQgY2FuIHJlc29sdmUgd2l0aCBtYW55IHZhbHVlcy4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2VcclxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcclxuICAgIC8vIHVuZGVmaW5lZCBpZiB0aGUgZW5kIG9mIHRoZSBjdXJzb3IgaGFzIGJlZW4gcmVhY2hlZC5cclxuICAgIGlmIChnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpLmluY2x1ZGVzKGZ1bmMpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cclxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JhcChjdXJzb3JSZXF1ZXN0TWFwLmdldCh0aGlzKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xyXG4gICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcclxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxyXG4gICAgICAgIHJldHVybiB3cmFwKGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXHJcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XHJcbiAgICAvLyBUaGlzIGRvZXNuJ3QgcmV0dXJuLCBpdCBqdXN0IGNyZWF0ZXMgYSAnZG9uZScgcHJvbWlzZSBmb3IgdGhlIHRyYW5zYWN0aW9uLFxyXG4gICAgLy8gd2hpY2ggaXMgbGF0ZXIgcmV0dXJuZWQgZm9yIHRyYW5zYWN0aW9uLmRvbmUgKHNlZSBpZGJPYmplY3RIYW5kbGVyKS5cclxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxyXG4gICAgICAgIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih2YWx1ZSk7XHJcbiAgICBpZiAoaW5zdGFuY2VPZkFueSh2YWx1ZSwgZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSkpXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XHJcbiAgICAvLyBSZXR1cm4gdGhlIHNhbWUgdmFsdWUgYmFjayBpZiB3ZSdyZSBub3QgZ29pbmcgdG8gdHJhbnNmb3JtIGl0LlxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXAodmFsdWUpIHtcclxuICAgIC8vIFdlIHNvbWV0aW1lcyBnZW5lcmF0ZSBtdWx0aXBsZSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QgKGVnIHdoZW4gY3Vyc29yaW5nKSwgYmVjYXVzZVxyXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCUmVxdWVzdClcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdCh2YWx1ZSk7XHJcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXHJcbiAgICAvLyBUaGlzIGlzIGZhc3RlciwgYnV0IGl0IGFsc28gcHJvdmlkZXMgb2JqZWN0IGVxdWFsaXR5LlxyXG4gICAgaWYgKHRyYW5zZm9ybUNhY2hlLmhhcyh2YWx1ZSkpXHJcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHRyYW5zZm9ybUNhY2hhYmxlVmFsdWUodmFsdWUpO1xyXG4gICAgLy8gTm90IGFsbCB0eXBlcyBhcmUgdHJhbnNmb3JtZWQuXHJcbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cclxuICAgIGlmIChuZXdWYWx1ZSAhPT0gdmFsdWUpIHtcclxuICAgICAgICB0cmFuc2Zvcm1DYWNoZS5zZXQodmFsdWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VmFsdWU7XHJcbn1cclxuY29uc3QgdW53cmFwID0gKHZhbHVlKSA9PiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuZ2V0KHZhbHVlKTtcblxuZXhwb3J0IHsgd3JhcCBhcyBhLCBhZGRUcmFwcyBhcyBiLCBpbnN0YW5jZU9mQW55IGFzIGMsIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBkLCB1bndyYXAgYXMgZSB9O1xuIiwiaW1wb3J0IHsgYSBhcyB3cmFwLCBiIGFzIGFkZFRyYXBzIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5leHBvcnQgeyBlIGFzIHVud3JhcCwgYSBhcyB3cmFwIH0gZnJvbSAnLi9jaHVuay5qcyc7XG5cbi8qKlxyXG4gKiBPcGVuIGEgZGF0YWJhc2UuXHJcbiAqXHJcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxyXG4gKiBAcGFyYW0gdmVyc2lvbiBTY2hlbWEgdmVyc2lvbi5cclxuICogQHBhcmFtIGNhbGxiYWNrcyBBZGRpdGlvbmFsIGNhbGxiYWNrcy5cclxuICovXHJcbmZ1bmN0aW9uIG9wZW5EQihuYW1lLCB2ZXJzaW9uLCB7IGJsb2NrZWQsIHVwZ3JhZGUsIGJsb2NraW5nIH0gPSB7fSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xyXG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xyXG4gICAgaWYgKHVwZ3JhZGUpIHtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgaWYgKGJsb2NraW5nKVxyXG4gICAgICAgIG9wZW5Qcm9taXNlLnRoZW4oZGIgPT4gZGIuYWRkRXZlbnRMaXN0ZW5lcigndmVyc2lvbmNoYW5nZScsIGJsb2NraW5nKSk7XHJcbiAgICByZXR1cm4gb3BlblByb21pc2U7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZSBhIGRhdGFiYXNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cclxuICovXHJcbmZ1bmN0aW9uIGRlbGV0ZURCKG5hbWUsIHsgYmxvY2tlZCB9ID0ge30pIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XHJcbiAgICBpZiAoYmxvY2tlZClcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Jsb2NrZWQnLCAoKSA9PiBibG9ja2VkKCkpO1xyXG4gICAgcmV0dXJuIHdyYXAocmVxdWVzdCkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xyXG59XG5cbmNvbnN0IHJlYWRNZXRob2RzID0gWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J107XHJcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcclxuY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTtcclxuZnVuY3Rpb24gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkge1xyXG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcclxuICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJlxyXG4gICAgICAgIHR5cGVvZiBwcm9wID09PSAnc3RyaW5nJykpXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgaWYgKGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApKVxyXG4gICAgICAgIHJldHVybiBjYWNoZWRNZXRob2RzLmdldChwcm9wKTtcclxuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xyXG4gICAgY29uc3QgdXNlSW5kZXggPSBwcm9wICE9PSB0YXJnZXRGdW5jTmFtZTtcclxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cclxuICAgIGlmICghKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgbWV0aG9kO1xyXG4gICAgaWYgKHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgbGV0IHRhcmdldCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lKS5zdG9yZTtcclxuICAgICAgICAgICAgaWYgKHVzZUluZGV4KVxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmluZGV4KGFyZ3Muc2hpZnQoKSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRbdGFyZ2V0RnVuY05hbWVdKC4uLmFyZ3MpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAod3JpdGVNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkge1xyXG4gICAgICAgIG1ldGhvZCA9IGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSB0aGlzLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICB0eC5zdG9yZVt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0eC5kb25lO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBpZiAobWV0aG9kKVxyXG4gICAgICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XHJcbiAgICByZXR1cm4gbWV0aG9kO1xyXG59XHJcbmFkZFRyYXBzKG9sZFRyYXBzID0+ICh7XHJcbiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksXHJcbiAgICBoYXM6ICh0YXJnZXQsIHByb3ApID0+ICEhZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuaGFzKHRhcmdldCwgcHJvcCksXHJcbn0pKTtcblxuZXhwb3J0IHsgb3BlbkRCLCBkZWxldGVEQiB9O1xuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge1xuXG4gIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4gICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcbiAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zZXJ2aWNld29ya2VyLmJ1bmRsZS5qcycpLnRoZW4ocmVnaXN0cmF0aW9uID0+IHtcbiAgICAgICBjb25zb2xlLmxvZygnU1cgcmVnaXN0ZXJlZDogJywgcmVnaXN0cmF0aW9uKTtcbiAgICAgfSkuY2F0Y2gocmVnaXN0cmF0aW9uRXJyb3IgPT4ge1xuICAgICAgIGNvbnNvbGUubG9nKCdTVyByZWdpc3RyYXRpb24gZmFpbGVkOiAnLCByZWdpc3RyYXRpb25FcnJvcik7XG4gICAgIH0pO1xuICAgfSk7XG4gIH1cblxufTtcblxuXG4iLCJpbXBvcnQgcmVnaXN0cmF0aW9uIGZyb20gJy4vcmVnaXN0cmF0aW9uJztcbmltcG9ydCBEQkhlbHBlciBmcm9tICcuL2RiaGVscGVyJztcblxubGV0IHJlc3RhdXJhbnRzLFxuICBuZWlnaGJvcmhvb2RzLFxuICBjdWlzaW5lc1xudmFyIG5ld01hcDtcbnZhciBtYXJrZXJzID0gW107XG5cbi8vIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdyci1kYicsIDEsIHVwZ3JhZGVEQiA9PiB7XG4vLyAgIHZhciByZXN0YXVyYW50c19zdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7IGtleVBhdGg6ICdpZCcgfSk7XG4vLyAgIHJlc3RhdXJhbnRzX3N0b3JlLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuXG4vLyAgIHZhciByZXZpZXdzX3N0b3JlID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywgeyBrZXlQYXRoOiAnaWQnIH0pO1xuLy8gICByZXZpZXdzX3N0b3JlLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuLy8gICByZXZpZXdzX3N0b3JlLmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcbi8vIH0pO1xuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBpbml0TWFwKCk7IC8vIGFkZGVkXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG4gIERCSGVscGVyLm5leHRQZW5kaW5nKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcbiAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZVJlc3RhdXJhbnRzKTtcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5jb25zdCBmZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG4gIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVSZXN0YXVyYW50cyk7XG5cbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xuY29uc3QgaW5pdE1hcCA9ICgpID0+IHtcbiAgbmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbNDAuNzIyMjE2LCAtNzMuOTg3NTAxXSxcbiAgICAgICAgem9vbTogMTIsXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcbiAgICAgIH0pO1xuICBzZWxmLm5ld01hcCA9IG5ld01hcDtcbiAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICBtYXBib3hUb2tlbjogJ3BrLmV5SjFJam9pZDJWdWRHbHVJaXdpWVNJNkltTnFhWEowTjI1aVpqRndkall6YTNBNE1HdDFhSFUyYmpFaWZRLkRuTkZVb041dXp3MDFsX1hLX2M3blEnLFxuICAgIG1heFpvb206IDE4LFxuICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgK1xuICAgICAgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJyArXG4gICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICBpZDogJ21hcGJveC5zdHJlZXRzJ1xuICB9KS5hZGRUbyhuZXdNYXApO1xuXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59XG4vKiB3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgbGV0IGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDFcbiAgfTtcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICB9KTtcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn0gKi9cblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICB9XG4gIH0pXG59XG5cbi8qKlxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxuICovXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHVsLmlubmVySFRNTCA9ICcnO1xuXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcbiAgaWYgKHNlbGYubWFya2Vycykge1xuICAgIHNlbGYubWFya2Vycy5mb3JFYWNoKG1hcmtlciA9PiBtYXJrZXIucmVtb3ZlKCkpO1xuICB9XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnQpO1xuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG4gIH0pO1xuICBhZGRNYXJrZXJzVG9NYXAoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5jb25zdCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCByZXN0YXVyYW50Lm5hbWUpO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGNvbnNvbGUubG9nKGltYWdlLnNyYyk7XG4gIGRpdi5hcHBlbmQoaW1hZ2UpO1xuICBsaS5hcHBlbmQoZGl2KTtcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGxpLmFwcGVuZChuYW1lKTtcblxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcblxuICBjb25zb2xlLmxvZyhcImlzX2Zhdm9yaXRlOiBcIiwgcmVzdGF1cmFudFtcImlzX2Zhdm9yaXRlXCJdKTtcblxuICBjb25zdCBmYXZCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgY29uc3QgaXNGYXZvcml0ZSA9IChyZXN0YXVyYW50W1wiaXNfZmF2b3JpdGVcIl0gJiYgcmVzdGF1cmFudFtcImlzX2Zhdm9yaXRlXCJdLnRvU3RyaW5nKCkgPT09IFwidHJ1ZVwiKSA/IHRydWUgOiBmYWxzZTtcbiAgaWYocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gXCJ0cnVlXCIgfHwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSkge1xuICAgIGZhdkJ0bi5pbm5lckhUTUwgPSAnRmF2b3JpdGVkISc7XG4gICAgZmF2QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnaG90cGluayc7XG4gIH0gZWxzZSB7XG4gICAgZmF2QnRuLmlubmVySFRNTCA9ICdBZGQgdG8gZmF2b3JpdGUnO1xuICAgIGZhdkJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJ2dyZXknO1xuICB9XG4gIGZhdkJ0bi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBgdG9nZ2xlIGZhdm9yaXRlcyBmb3I6ICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBmYXZCdG4uc2V0QXR0cmlidXRlKFwiaWRcIiwgYGZhdi1idG4tJHtyZXN0YXVyYW50LmlkfWApO1xuICBmYXZCdG4uc2V0QXR0cmlidXRlKFwiZGF0YS1yZXN0YXVyYW50LWlkXCIsIHJlc3RhdXJhbnQuaWQpO1xuXG4gIGZhdkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdjbGlja2VkIGZhdmJ0bicpO1xuICAgIERCSGVscGVyLnRvZ2dsZUZhdkJ0bihyZXN0YXVyYW50LmlkKTtcbiAgfSlcblxuXG4gIGxpLmFwcGVuZChmYXZCdG4pO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgbW9yZS5jbGFzc0xpc3QgPSBcImJ1dHRvbiBidXR0b24tLXN1Y2Nlc3NcIjtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHJlc3RhdXJhbnQubmFtZSArIHJlc3RhdXJhbnQubmVpZ2hib3Job29kICsgcmVzdGF1cmFudC5hZGRyZXNzICsgXCJWaWV3IERldGFpbHNcIik7XG4gIG1vcmUub25jbGljayA9ICgpID0+IHtcbiAgICBjb25zdCB1cmwgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICAgIHdpbmRvdy5sb2NhdGlvbiA9IHVybDtcbiAgfVxuICBsaS5hcHBlbmQobW9yZSk7XG5cbiAgcmV0dXJuIGxpXG59XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbmV3TWFwKTtcbiAgICBtYXJrZXIub24oXCJjbGlja1wiLCBvbkNsaWNrKTtcbiAgICBmdW5jdGlvbiBvbkNsaWNrKCkge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIub3B0aW9ucy51cmw7XG4gICAgfVxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufVxuXG4iXSwic291cmNlUm9vdCI6IiJ9